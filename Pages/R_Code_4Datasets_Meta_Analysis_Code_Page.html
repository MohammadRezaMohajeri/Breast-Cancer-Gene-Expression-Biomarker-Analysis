<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>R Code <br> For 4 Datasets (Meta-analysis)</title>
	<style>

		body {
			background-color: #12243d; /*  Cobalt color code */

		}
		
				
		/* CSS Styles  */
		/* To highlight different parts of the text in red<span style="color: #ebedf0; font-style: italic;">,</span> green<span style="color: #ebedf0; font-style: italic;">,</span> and blue<span style="color: #ebedf0; font-style: italic;">,</span> you can use the <span> element and apply CSS styles to it */ 
		
		.orange-text {
			color: orange;
			font-weight: bold;
		}
		.dark-yellow-text {
			color: hsl(50<span style="color: #ebedf0; font-style: italic;">,</span> 100%<span style="color: #ebedf0; font-style: italic;">,</span> 30%); /* Adjust the hue and saturation values as needed */
			font-weight: bold;
		}
		.brown-text {
			color: hsl(30<span style="color: #ebedf0; font-style: italic;">,</span> 100%<span style="color: #ebedf0; font-style: italic;">,</span> 30%); /* Adjust the hue and saturation values as needed */
			font-weight: bold;
		}
		.green-text {
			color: green;
			font-weight: bold;
		}
		.purple-text {
			color: purple;
			font-weight: bold;
		}
		.blue-text {
			color: blue;
			font-weight: bold;
		}


		/* Header Styles */
		header {
			background-color: #274f4f;
			color: white;
			text-align: center;
			padding: 5px;
		}

		h1 {
			color: white; /* Adjust the font color as desired */
			font-size: 30px; /* Adjust the font size as desired */
			font-weight: bold; /* Add font weight as desired */
			text-align: center; /* Center the header title */
			padding: 0px; /* Add padding around the header title */
			margin-bottom: 20px; /* Add margin below the header title */
		}
		
		hr {
			width: 100%; /* Adjust the width as desired */
		}
		
		/* Adjust font size for the code block */
		pre code {
		        font-size: 17px; /* Adjust the font size as desired */
	        }
		
		/* Footer Styles */
		.footer {
		        background-color: #333;
		        color: #fff;
		        padding: 10px;
		        text-align: center;
		        position: fixed;
		        left: 0;
		        bottom: 0;
		        width: 100%;
		}
	</style>
	
</head>
<body>
	<header>
		<h1>R Code <br> For 4 Datasets (Meta-analysis)</h1>
	</header>

	<section>
		
<pre><code>
	
<span style="color: #05c6e3; font-style: italic;">################################################################# "Package Installation" #################################################################</span>
<span style="color: #05c6e3; font-style: italic;">#################################### Uncomment the following lines if any of the packages are not already installed or need to be reinstalled.############</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager packages</span>
<span style="color: #05c6e3; font-style: italic;"># Install required Bioconductor packages</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("sva", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("GeneMeta", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("ComplexHeatmap", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("fgsea", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("clusterProfiler", force = TRUE)</span>
			
<span style="color: #05c6e3; font-style: italic;"># Other packages</span>
<span style="color: #05c6e3; font-style: italic;"># Install required CRAN packages:</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("RColorBrewer")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("msigdbr")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggpubr")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("reshape2")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("caret")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("rgl")</span>

<span style="color: #05c6e3; font-style: italic;"># sva package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "sva" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("sva")</span>

<span style="color: #05c6e3; font-style: italic;"># VSN package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "vsn" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("vsn")</span>

<span style="color: #05c6e3; font-style: italic;"># tidyverse package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("tidyverse")</span>

<span style="color: #05c6e3; font-style: italic;"># GEOquery package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "GEOquery" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("GEOquery")</span>

<span style="color: #05c6e3; font-style: italic;"># limma package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("limma")</span>

<span style="color: #05c6e3; font-style: italic;"># plotly package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("plotly")</span>

<span style="color: #05c6e3; font-style: italic;"># ggvenn package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggvenn")</span>

<span style="color: #05c6e3; font-style: italic;"># ggpubr package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggpubr")</span>

<span style="color: #05c6e3; font-style: italic;"># rgl package installation</span>
<span style="color: #05c6e3; font-style: italic;"># For rgl installation, require remotes package first</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("remotes")</span>
<span style="color: #05c6e3; font-style: italic;"># require(remotes)</span>
<span style="color: #05c6e3; font-style: italic;"># remotes::install_github("dmurdoch/rgl")</span>


<span style="color: #05c6e3; font-style: italic;"># Package Loading</span>
<span style="color: #05c6e3; font-style: italic;"># Load the required packages for data analysis and visualization.</span>
			
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">tidyverse</span><span style="color: #68affc; font-style: italic;">)</span>       <span style="color: #05c6e3; font-style: italic;"># Package for comprehensive data manipulation and visualization, including dplyr, ggplot2, and other useful packages</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOquery</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for accessing and retrieving gene expression data from the Gene Expression Omnibus (GEO) database</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">reshape2</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for reshaping data from wide to long format and vice versa, useful for data preprocessing</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">caret</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for machine learning and predictive modeling, providing a unified interface for various algorithms and performance evaluation</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GeneMeta</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for meta-analysis of gene expression data, allowing combining results from multiple studies</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">limma</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for analyzing microarray data using linear models, including differential expression analysis</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rgl</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for creating interactive 3D visualizations, useful for exploring complex data structures</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sva</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for surrogate variable analysis, used to identify and adjust for unwanted variation in high-dimensional datasets</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">plotly</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating interactive and dynamic plots, including scatter plots, bar plots, and more</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ggvenn</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating Venn diagrams using ggplot2, useful for visualizing set relationships</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ggpubr</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating publication-ready plots using ggplot2, providing additional customization options</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ComplexHeatmap</span><span style="color: #68affc; font-style: italic;">)</span>  <span style="color: #05c6e3; font-style: italic;"># Package for creating complex heatmaps, allowing visualization of multiple layers of data and annotations</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">RColorBrewer</span><span style="color: #68affc; font-style: italic;">)</span>    <span style="color: #05c6e3; font-style: italic;"># Package for providing color palettes suitable for data visualization</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">msigdbr</span><span style="color: #68affc; font-style: italic;">)</span>         <span style="color: #05c6e3; font-style: italic;"># Package for accessing and using the Molecular Signatures Database (MSigDB) for gene set enrichment analysis</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">fgsea</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for performing gene set enrichment analysis (GSEA) using fast gene set testing algorithms</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">locfit</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for local regression modeling, useful for fitting flexible curves to data</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">vsn</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for variance stabilization and normalization, specifically for microarray data analysis</span>


	
#################################### 1- DownloadGEO Function ####################################
# DownloadGEO: Downloads a Gene Expression Omnibus (GEO) dataset and prepares it for analysis

# Input (Arguments):
#   - GSEname: A character vector specifying the GEO dataset name (default: "GSE25065")

# Output:
#   - Extracted variables saved as separate files (matrix.csv, phenotype.tsv, annot.tsv)

# Function Description:
# This function downloads a specified GEO dataset from Gene Expression Omnibus (GEO) and prepares it for analysis. 
# It creates a folder to store the downloaded dataset, increases memory allocation for efficient processing, 
# and downloads the specified GEO dataset. It then extracts the gene expression matrix, phenotype information, 
# and annotation data from the downloaded dataset. The extracted variables are saved as separate files.
	
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Create a folder to store the downloaded dataset
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
	
  # Increase the memory allocation for efficient processing
  <span style="color: #ebedf0; font-style: italic;">Sys.setenv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"VROOM_CONNECTION_SIZE"</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #cf4275; font-style: italic;">131072</span> <span style="color: #68affc; font-style: italic;">*</span><span style="color: #cf4275; font-style: italic;">131072</span><span style="color: #68affc; font-style: italic;">)</span>
  
  #Download dataset
  <span style="color: #ebedf0; font-style: italic;">gset</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">getGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">GSE<span style="color: #ebedf0; font-style: italic;">matrix</span></span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">AnnotGPL</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">destdir</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">getwd</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
	
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">!</span><span style="color: #ebedf0; font-style: italic;">is.null</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    # Extract the gene expression matrix, phenotype information, and annotation data:
    # Extract the gene expression matrix from the downloaded dataset
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_matrix.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">assayData</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #2ad43b; font-style: italic;">"exprs"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
	
    # Check if the matrix has undergone log2 transformation
    <span style="color: #ebedf0; font-style: italic;">qx</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">quantile</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">0.</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">0.25</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">0.75</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">0.99</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">1.0</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">na.rm</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">LogC</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">qx</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">5</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">100</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">||</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">qx</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">6</span><span style="color: #68affc; font-style: italic;">]</span>-<span style="color: #ebedf0; font-style: italic;">qx</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;"><span style="color: #cf4275; font-style: italic;">1</span></span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">50</span> <span style="color: #68affc; font-style: italic;">&</span><span style="color: #68affc; font-style: italic;">&</span> <span style="color: #ebedf0; font-style: italic;">qx</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;"><span style="color: #cf4275; font-style: italic;">2</span></span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">!</span><span style="color: #ebedf0; font-style: italic;">LogC</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      # Reverse the log2 transformation if applied
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #cf4275; font-style: italic;"></span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">^</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>

    # Add row names to the matrix and set the column name for the identifier column
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>

    # Extract the phenotype information from the downloaded dataset
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_matrix.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">phenoData</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">data</span>
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>

    # Extract the annotation data from the downloaded dataset
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_matrix.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">featureData</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">data</span>
    
	
    # Write the extracted variables to separate files:
    # Write the gene expression matrix to a CSV file
    <span style="color: #ebedf0; font-style: italic;">write.csv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"matrix.csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">quote</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row.names</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>

    # Write the phenotype information to a tab-separated values (TSV) file
    <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"phenotype.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

    # Write the annotation data to a TSV file
    <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    
    # Remove unnecessary variables from memory
    <span style="color: #ebedf0; font-style: italic;">rm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span>

    # Display a message indicating that the dataset is ready for analysis
    <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Datatset is ready to analyse. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>


############################### 2- ReadGEO Function ############################### 
# ReadGEO: Reads the gene expression matrix file for a given project

# Input (Arguments):
#   - projname: A character vector specifying the project name

# Output:
#   - A data frame containing the gene expression matrix

# Function Description:
# This function reads the gene expression matrix file for a specified project. 
# It takes the argument `projname`, which is a character vector specifying the project name. 
# The function reads the matrix file in CSV format using the `read_csv` function and stores it in the variable `matrix`. 
# The gene expression matrix is assumed to be stored in a file named "matrix.csv" in the project folder.
# Finally, the matrix is converted to a data frame using the `data.frame` function before being returned as the output. 
# The function does not modify the original matrix file; it only reads the file and returns the matrix as a data frame.

<span style="color: #ebedf0; font-style: italic;">ReadGEO</span>  <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
 # Reading the gene expression matrix file
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"matrix.csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

  # Converting the matrix to a data frame	
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

	
	
##################################################################### 3- MakePhenotype Function #####################################################################
# MakePhenotype: Creates a phenotype file based on project-specific phenotype data

# Input (Arguments):
#   - projname: A character vector of project names
#   - compare: A string indicating whether to compare "subtype" or "grade"

# Output:
#   - A phenotype file containing the selected comparison (subtype or grade)

# Function Description:
# This function creates a phenotype file based on project-specific phenotype data. It takes the argument `projname`, 
# which is a character vector of project names. The function reads the phenotype file for each project, converts 
# the phenotype data to a data frame, and sets row names. Depending on the value of the `compare` argument, the function 
# either compares subtype or grade information. For subtype comparison, it extracts subtype data, formats it, and stores 
# it in a new list. For grade comparison, it extracts grade data, handles special cases (such as Greek symbols), and 
# formats it. The formatted phenotype data is stored in a new list for each project. The function then combines the 
# phenotype data from all projects into a single data frame. Finally, it writes the phenotype data to a CSV file and 
# displays a message indicating that the phenotype file is created.

	
<span style="color: #ebedf0; font-style: italic;">Makephenotype</span>  <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Create a folder to store the phenotype file
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>

  # Initialize an empty list to store the phenotype data for each project	
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>

  # Iterate over each project name	
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    # Read the phenotype file for the current project
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"phenotype.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

    # Convert the phenotype data to a data frame and set row names
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>

    # Add the phenotype data to the list using the project name as the key
    <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span>
  <span style="color: #68affc; font-style: italic;">}</span>
	
 # Choose either subtype or grade for comparison
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"subtype"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">pheno2</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>

    # Iterate over each project in the phenotype list
    <span style="color: #f79502; font-style: italic;">for</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      # Find columns related to subtype information (e.g., pam50)
      <span style="color: #ebedf0; font-style: italic;">phecoln</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"pam50"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>

     # Check if any subtype columns were found
     <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phecoln</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
	# Extract the subtype data and format it
        <span style="color: #ebedf0; font-style: italic;">pheno1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">phecoln</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"subtype"</span>
        <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">subtype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"pam50.+:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">subtype</span><span style="color: #68affc; font-style: italic;">)</span>

	# Prepare the final phenotype data by adding sample identifiers and column names
        <span style="color: #ebedf0; font-style: italic;">pheno1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;"> pheno1</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Sample"</span>

	# Store the formatted phenotype data in a new list using the project name as the key
        <span style="color: #ebedf0; font-style: italic;">pheno2</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno1</span>
      <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #68affc; font-style: italic;">}</span>

    # Combine the phenotype data from all projects into a single data frame
    <span style="color: #ebedf0; font-style: italic;">pheno3</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno2</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno3</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #cf4275; font-style: italic;">NULL</span> 

	
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span><span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">pheno2</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>

    # Iterate over each project in the phenotype list	
    <span style="color: #f79502; font-style: italic;">for</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      # Find columns related to grade information
      <span style="color: #ebedf0; font-style: italic;">gradecoln</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"grade:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>

     # Check if any grade columns were found
     <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gradecoln</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
	# Extract the grade data and format it
        <span style="color: #ebedf0; font-style: italic;">pheno1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">gradecoln</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span>
        <span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"grade:|grade: |B-R grade: "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"=.+"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>

	# Handle special cases where grades are represented as Greek symbols
        <span style="color: #ebedf0; font-style: italic;">greek</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"III"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">greek</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
          <span style="color: #ebedf0; font-style: italic;">one</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"I"</span><span style="color: #68affc; font-style: italic;">)</span>
          <span style="color: #ebedf0; font-style: italic;">two</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"II"</span><span style="color: #68affc; font-style: italic;">)</span>
          <span style="color: #ebedf0; font-style: italic;">three</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"III"</span><span style="color: #68affc; font-style: italic;">)</span>
          <span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">one</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"1"</span>
          <span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">two</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"2"</span>
          <span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">three</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"3"</span>
        <span style="color: #68affc; font-style: italic;">}</span>

	# Prepare the final phenotype data by adding sample identifiers and column names
        <span style="color: #ebedf0; font-style: italic;">pheno1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;"> pheno1</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Sample"</span>

	# Store the formatted phenotype data in a new list using the project name as the key
        <span style="color: #ebedf0; font-style: italic;">pheno2</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno1</span>
      <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #68affc; font-style: italic;">}</span>

    # Combine the phenotype data from all projects into a single data frame
    <span style="color: #ebedf0; font-style: italic;">pheno3</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno2</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno3</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #cf4275; font-style: italic;">NULL</span> 
  <span style="color: #68affc; font-style: italic;">}</span>
	
  # Write the phenotype data to a CSV file
  <span style="color: #ebedf0; font-style: italic;">write.csv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno3</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row.names</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">quote</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>

  # Display a message indicating that the phenotype file is created	
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype file is created into phenotype folder"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>


	
	########################################### 4- MakeBoxPlot Function ###########################################
# MakeBoxPlot: Creates a box plot to visualize gene expression values from a gene expression matrix

# Input (Arguments):
#   - GEOmatrix: A gene expression matrix in data frame format
#   - projname: A character vector specifying the project name

# Output:
#   - A box plot visualizing the gene expression values

# Function Description:
# This function creates a box plot to visualize the gene expression values from a gene expression matrix. 
# It takes two arguments: `GEOmatrix`, which is the gene expression matrix in data frame format, and `projname`, 
# which is a character vector specifying the project name. The function converts the gene expression matrix into 
# a long format data frame using the `melt` function. It then uses `ggplot2` to create the box plot, with the 
# x-axis representing the samples and the y-axis representing the gene expression values. The plot is customized 
# with color and fill options, axis labels, y-axis scale labels, and theme settings. The resulting box plot 
# is displayed, with the subtitle indicating the project name.
	
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Make a long format data frame
  <span style="color: #ebedf0; font-style: italic;">melted</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">melt</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">id.vars</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting 
  <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">melted</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">variable</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">value</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">geom_boxplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #45B39D; font-style: italic; padding: 2px;">#45B39D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #45B39D; font-style: italic; padding: 2px;">#45B39D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">outlier.alpha</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'SampleID'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Values'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_y_continuous</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">labels</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">scales</span><span style="color: #68affc; font-style: italic;">::</span><span style="color: #ebedf0; font-style: italic;">comma</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">6</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">12</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">00</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">legend.position</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"none"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Box plot - "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                    <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span>  <span style="color: #cf4275; font-style: italic;">NULL</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                    <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                    <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Plots"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix file
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">123</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Reading phenotype file
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">paired_pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paired_pheno</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # PCA analysis
  <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">t</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pca_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">scale</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pca</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">preProcess</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">method</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'pca'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pcaComp</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">3</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pca_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">predict</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pca_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">na_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">na_samp</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">na_colm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">na_samp</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">pca_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_colm</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Class</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # 2D plot for multi-studies
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">></span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">pca_rownames</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span>
    <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      l <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">pca_rownames</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">l</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">studies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">PC1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">PC2</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">geom_point</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">3</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span> <span style="color: #ebedf0; font-style: italic;">shape</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">00</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">legend.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">legend.title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">20</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"PCA plot- Merged studies"</span><span style="color: #68affc; font-style: italic;">)</span>
    
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    
    # Plotting
    <span style="color: #ebedf0; font-style: italic;">plot3d</span><span style="color: #68affc; font-style: italic;">(</span> 
      <span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">PC1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">PC2</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">z</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">PC3</span><span style="color: #ebedf0; font-style: italic;">,</span> 
      <span style="color: #ebedf0; font-style: italic;">col</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #ebedf0; font-style: italic;">type</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'s'</span><span style="color: #ebedf0; font-style: italic;">,</span> 
      <span style="color: #ebedf0; font-style: italic;">radius</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">4</span><span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">3</span><span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #ebedf0; font-style: italic;">xlab</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">ylab</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC2"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">zlab</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC3"</span><span style="color: #68affc; font-style: italic;">)</span>
    # Legend
    <span style="color: #ebedf0; font-style: italic;">legend3d</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"topright"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             <span style="color: #ebedf0; font-style: italic;">legend</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">levels</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span>
             <span style="color: #ebedf0; font-style: italic;">pch</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">16</span><span style="color: #ebedf0; font-style: italic;">,</span>
             <span style="color: #ebedf0; font-style: italic;">col</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             <span style="color: #ebedf0; font-style: italic;">cex</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #cf4275; font-style: italic;">1.2</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             <span style="color: #ebedf0; font-style: italic;">inset</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">0.02</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    
    # Saving the plot into Plots folder
    <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">collapse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"-"</span><span style="color: #68affc; font-style: italic;">)</span> 
    <span style="color: #ebedf0; font-style: italic;">htmlwidgets</span><span style="color: #68affc; font-style: italic;">::</span><span style="color: #ebedf0; font-style: italic;">saveWidget</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rglwidget</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">width</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">800</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">height</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">800</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                            <span style="color: #ebedf0; font-style: italic;">file</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Plots/PCA_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".html"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">libdir</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"libs"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"PCA - "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">selfcontained</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1234</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  # VSN normalization
  <span style="color: #ebedf0; font-style: italic;">vsnnorm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">normalizeVSN</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span>
  # quantile normalization
  <span style="color: #ebedf0; font-style: italic;">df_rank</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">apply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">vsnnorm</span><span style="color: #ebedf0; font-style: italic;">,</span>2<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">rank</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">ties.method</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"min"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">df_sorted</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">apply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">vsnnorm</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">2</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sort</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">df_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">apply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">df_sorted</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">mean</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">index_to_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_index</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">my_mean</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_mean</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">my_index</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">norm_final</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">apply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">df_rank</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">2</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">index_to_mean</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">my_mean</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">df_mean</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">norm_final</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">norm_final</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">norm_finall</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sapply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">norm_final</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">as.character</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                    <span style="color: #ebedf0; font-style: italic;">check.names</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">norm_finall</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">norm_finall</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">norm_finall</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">norm_finall</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">Mergestudies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Merging two or more matrix
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Reduce</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #ebedf0; font-style: italic;">merge</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">all</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">StudyBatchEffect</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Calculating the number of samples for each matrix
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ncol</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">-</span> <span style="color: #cf4275; font-style: italic;">1</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
  # Merging matrices
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Reduce</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #ebedf0; font-style: italic;">merge</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">all</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  # Batch correction
  <span style="color: #ebedf0; font-style: italic;">corrected_batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ComBat</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">dat</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">mod</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #cf4275; font-style: italic;">NULL</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">par.prior</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                            <span style="color: #ebedf0; font-style: italic;">prior.plots</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">corrected_batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">corrected_batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sapply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">as.character</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">check.names</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row.names</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">corrected_batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">MakeDensityPlot</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1234</span><span style="color: #68affc; font-style: italic;">)</span>
  # Make a long format data frame
  <span style="color: #ebedf0; font-style: italic;">melted</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">melt</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">id.vars</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the number of samples for each study 
  <span style="color: #ebedf0; font-style: italic;">st </span><span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">row_n</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">nrow</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">col_n</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ncol</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span>
    <span style="color: #ebedf0; font-style: italic;">st</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row_n</span><span style="color: #68affc; font-style: italic;">*</span><span style="color: #ebedf0; font-style: italic;">col_n</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">st </span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">st</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">melted</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">studies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">st</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">melted</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">value</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">geom_density</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1.5</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Density'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Value'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">12</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">00</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Density plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

<span style="color: #ebedf0; font-style: italic;">MakeMDSPlot</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">compare</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                        <span style="color: #ebedf0; font-style: italic;">nstudies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1234</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">t</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Cmpute MDS
  <span style="color: #ebedf0; font-style: italic;">mds</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">dist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>          
    <span style="color: #ebedf0; font-style: italic;">cmdscale</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Dim1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Dim2"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Clustering
  <span style="color: #ebedf0; font-style: italic;">clust</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">kmeans</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nstudies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">cluster</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">as.factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">mds</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">mds</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">clusters</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">clust</span><span style="color: #68affc; font-style: italic;">)</span>
  # Finding studies names
  <span style="color: #ebedf0; font-style: italic;">mds_rownames</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #cf4275; font-style: italic;">l</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">mds_rownames</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">l</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">studies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span> 
  
  # Plot and color by groups
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">g</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ggscatter</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Dim1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Dim2"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                 <span style="color: #ebedf0; font-style: italic;">label</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">shape</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Studies"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                 <span style="color: #ebedf0; font-style: italic;">ggtheme</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Clusters"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">palette</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1.5</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                 <span style="color: #ebedf0; font-style: italic;">ellipse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">ellipse.type</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"convex"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">repel</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">g</span> <span style="color: #68affc; font-style: italic;">+</span> <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">00</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"MDS plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">CochranQTest</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1234</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix and phenotype
  <span style="color: #ebedf0; font-style: italic;">d.adj.Split</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">var.d.adj.Split</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">paired_pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paired_pheno</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">na_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    # Matching phenotype with samples in matrix
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">></span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">na_samp</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">na_colm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">na_samp</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>  <span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_colm</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    # Calculating the number of each comparison mode (grade1 vs grade3)
    <span style="color: #ebedf0; font-style: italic;">g_list</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">j</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">g_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">s_id</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">s_id</span>
      <span style="color: #ebedf0; font-style: italic;">g_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">j</span> <span style="color: #68affc; font-style: italic;">-</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    # Applying those modes and calculating the mean and variance for Cochran' Q Test
    <span style="color: #ebedf0; font-style: italic;">spl</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">g_list</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">spsam</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">spsam</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">as.matrix</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">d.Split</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">getdF</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">spl</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">mean_d</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">dstar</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">d.Split</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">spl</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">d.adj.Split</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">mean_d</span>
    <span style="color: #ebedf0; font-style: italic;">var_d</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sigmad</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mean_d</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sum</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">spl</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sum</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">spl</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">var.d.adj.Split</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">var_d</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Output means and variances as a list
  <span style="color: #ebedf0; font-style: italic;">output</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">d.adj.Split</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">var.d.adj.Split</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">output</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Analysis has completed."</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">MakeQQPlot</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cohranq</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nstudies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Unpack the previous list into data frames
  <span style="color: #ebedf0; font-style: italic;">output1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cohranq</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> 
  <span style="color: #ebedf0; font-style: italic;">output2</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cohranq</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">mymns</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">output1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">myvars</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">output2</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating Cochran' Q Test
  <span style="color: #ebedf0; font-style: italic;">my.Q</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">f.Q</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mymns</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">myvars</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">nstudies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">nstudies</span>
  # quantiles of the chisq distribution
  <span style="color: #ebedf0; font-style: italic;">chisqq</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">qchisq</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">seq</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">0</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">.9999</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">.001</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">df</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">nstudies</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">tmp</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">quantile</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my.Q</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">seq</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">0</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">.9999</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">.001</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">qq</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">chisqq</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">chisqq</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">tmp</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">tmp</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting
  <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">qq</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">chisqq</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">tmp</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">geom_point</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">geom_abline</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'quantiles of Chi square'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'quantiles of Sample'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">00</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">legend.position</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"none"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"QQ Plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

<span style="color: #ebedf0; font-style: italic;">FEMREMAnalysis</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">model</span><span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">FDR</span><span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">nperm</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1234</span><span style="color: #68affc; font-style: italic;">)</span>
  # Creating folders
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading phenotype file
  <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading annotation file
  <span style="color: #ebedf0; font-style: italic;">annotations</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Chromosome.location"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GO.Function"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span> 
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">ID</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">annotations</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">an</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Reduce</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">intersect</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">annotations</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">annotations</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">an</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">matrices_list</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">Class</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">paired_pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paired_pheno</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">na_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    # Matching phenotype with samples in matrix
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">></span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">na_samp</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">na_colm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">na_samp</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>  <span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_colm</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    # Calculating the number of each comparison mode (grade1 vs grade3)
    <span style="color: #ebedf0; font-style: italic;">g_list</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">j</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">g_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">s_id</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">s_id</span>
      <span style="color: #ebedf0; font-style: italic;">g_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">j</span> <span style="color: #68affc; font-style: italic;">-</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    <span style="color: #ebedf0; font-style: italic;">spl</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">g_list</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">spl</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">as.character</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">spl</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">spl</span>
    <span style="color: #ebedf0; font-style: italic;">spsam</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">spsam</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">as.matrix</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ExpressionSet</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">assayData</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">matrices_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span>
  <span style="color: #68affc; font-style: italic;">}</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">model</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'FEM'</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">useREM</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #cf4275; font-style: italic;">FALSE</span>
  <span style="color: #68affc; font-style: italic;">}</span> 
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">model</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'REM'</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">useREM</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #cf4275; font-style: italic;">TRUE</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">ScoresFDR</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">zScoreFDR</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrices_list</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">useREM</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">useREM</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nperm</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">nperm</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">twosided</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ScoresFDR</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #2ad43b; font-style: italic;">"two.sided"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">twosided</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  # Adding annotation
  <span style="color: #ebedf0; font-style: italic;">anno_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annotations</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">ID</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">twosided</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #ebedf0; font-style: italic;">,</span>  <span style="color: #ebedf0; font-style: italic;">annotations</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">anno_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">3</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">4</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  # Removing missing gene symbols
  <span style="color: #ebedf0; font-style: italic;">genemissing</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">twosided</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">genemissing</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # All studies
  <span style="color: #ebedf0; font-style: italic;">combination</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"zSco"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Chromosome.location"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GO.Function"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">dupgene_freq</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">table</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">combination</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">only_dupgene</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">dupgene_freq</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">dupgene_freq</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Freq</span><span style="color: #68affc; font-style: italic;">></span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">combination</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">duplicat_deg</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">combination</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  
  <span style="color: #ebedf0; font-style: italic;">averaged_genes</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">b</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">d_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">b</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">col_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colMeans</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">d_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">col_all</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">col_mean</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">d_row</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">3</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">5</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">b</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">col_all</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">averaged_genes</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">unique_deg</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">combination</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">unique_deg</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #cf4275; font-style: italic;">NULL</span> 
  
  <span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">decreasing</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/combination.tsv"</span><span style="color: #68affc; font-style: italic;">)</span>
  # All studies with FDR filtering
  <span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><</span> <span style="color: #ebedf0; font-style: italic;">FDR</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes_combi</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered/combination.tsv"</span><span style="color: #68affc; font-style: italic;">)</span>
  
  # Seperating each study, averaging duplicated genes
  <span style="color: #ebedf0; font-style: italic;">sfdr</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"FDR_Ex_{0-9}"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sfdr</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">gs_col</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol|Chromosome.location|GO.Function"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">twosided</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sfdr</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sfdr</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">gs_col</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Ex_."</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">nrow</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">></span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">dupgene_freq</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">table</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">only_dupgene</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">dupgene_freq</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">dupgene_freq</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Freq</span><span style="color: #68affc; font-style: italic;">></span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">duplicat_deg</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      
      <span style="color: #ebedf0; font-style: italic;">averaged_genes</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">b</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
        <span style="color: #ebedf0; font-style: italic;">d_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">b</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">col_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colMeans</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">d_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;"><span style="color: #cf4275; font-style: italic;">1</span></span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">col_all</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">col_mean</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">d_row</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;"><span style="color: #cf4275; font-style: italic;">1</span></span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">3</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">5</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">b</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">col_all</span>
      <span style="color: #68affc; font-style: italic;">}</span>
      <span style="color: #ebedf0; font-style: italic;">averaged_genes</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">unique_deg</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">all_unique_genes</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">unique_deg</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #cf4275; font-style: italic;">NULL</span> 
      <span style="color: #ebedf0; font-style: italic;">all_unique_genes</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;"><span style="color: #cf4275; font-style: italic;">1</span></span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">decreasing</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">all_unique_genes</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><</span> <span style="color: #ebedf0; font-style: italic;">FDR</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    <span style="color: #ebedf0; font-style: italic;">eslash_genes</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"///"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"###################### Summary for: "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">" ############################"</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cat</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Number of missing gene symbols:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">genemissing</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nNumber of duplicated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nTotal number of genes after averaging duplicated genes and FDR filter:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">NROW</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nNumber of genes having ///:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">eslash_genes</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"##########################################################################"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++++++++++++++++++++ Analysis has completed. +++++++++++++++++++++++"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">Makevolcano</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">padjlevel</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">pSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">nSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading the DEGs table
  <span style="color: #ebedf0; font-style: italic;">volcano </span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">volcano </span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  
  <span style="color: #ebedf0; font-style: italic;">volcano </span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">volcano </span><span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">AdjustedPvalue</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">log10</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">FDR</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificant"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">AdjustedPvalue</span><span style="color: #68affc; font-style: italic;">></span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">log10</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">padjlevel</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">&</span> <span style="color: #ebedf0; font-style: italic;">zSco</span><span style="color: #68affc; font-style: italic;">></span> <span style="color: #ebedf0; font-style: italic;">pSE_thresh</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">AdjustedPvalue</span><span style="color: #68affc; font-style: italic;">></span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">log10</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">padjlevel</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">&</span> <span style="color: #ebedf0; font-style: italic;">zSco</span> <span style="color: #68affc; font-style: italic;"><</span> <span style="color: #ebedf0; font-style: italic;">nSE_thresh</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  
  <span style="color: #ebedf0; font-style: italic;">zero_fdr</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #ebedf0; font-style: italic;">m</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">log10</span><span style="color: #68affc; font-style: italic;">(</span>min<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">zero_fdr</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span> <span style="color: #cf4275; font-style: italic;">0.5</span>
  <span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">zero_fdr</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"AdjustedPvalue"</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">m</span>
  # Colors
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the number of each Upregulated, Downregulated, and NotSignificant probes
  <span style="color: #ebedf0; font-style: italic;">volcano_up</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">volcano_down</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">volcano_down</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">volcano_down</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano_down</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">zSco</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">decreasing</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">volcano_NA</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificant"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  # Combining all with together 
  <span style="color: #ebedf0; font-style: italic;">volcano_all</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano_up</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">volcano_down</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">volcano_NA</span><span style="color: #68affc; font-style: italic;">)</span>
  # Replacing the top probes with word Top
  <span style="color: #ebedf0; font-style: italic;">ntop_rep</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Top"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">ntop</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">volcano_all</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ntop_rep</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">volcano_up</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">ntop_rep</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">volcano_down</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">volcano_NA</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #68affc; font-style: italic;">)</span>
  # Label only top genes
  <span style="color: #ebedf0; font-style: italic;">volcano_all</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Top</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano_all</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Top"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">volcano_all</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting either with plotly or ggplot
  <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">p</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">volcano_all</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">zSco</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">AdjustedPvalue</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">label</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">Top</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span> 
      <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Effect size'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"-log10(FDR)"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">geom_point</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">shape</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">21</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">geom_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">check_overlap</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">vjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nudge_y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.1</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">00</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">legend.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">legend.title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">20</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">p</span>
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    # Creating ggplot object, adding layers and annotation to the plot
    <span style="color: #ebedf0; font-style: italic;">p</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">volcano_all</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">zSco</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">AdjustedPvalue</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">DEG</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span>
      <span style="color: #2ad43b; font-style: italic;">"&lt;br&gt;Gene: "</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #2ad43b; font-style: italic;">"&lt;br&gt;Chromosome: "</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">Chromosome.location</span><span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #2ad43b; font-style: italic;">"&lt;br&gt;GO function: "</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">GO.function</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Effect size'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;"></span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">geom_point</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">shape</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">21</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">00</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">p</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ggplotly</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">p</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">tooltip</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"text"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
      <span style="color: #ebedf0; font-style: italic;">layout</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
             <span style="color: #ebedf0; font-style: italic;">font</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
             <span style="color: #ebedf0; font-style: italic;">legend</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">20</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">itemclick</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"toggle"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Calculation the up and down regulated genes number
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano_up</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">volcano_down</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Creating the top table (up and down) based on the number specified (ntop)
  <span style="color: #ebedf0; font-style: italic;">Top</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano_up</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">volcano_down</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">Top</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Top</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">6</span><span style="color: #68affc; font-style: italic;">]</span>
  # Save top table into project folder
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">Top</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_top.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"################# Significance #################"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cat</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Up-regulated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nrow</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano_up</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
              <span style="color: #2ad43b; font-style: italic;">"\nDown-regulated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nrow</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">volcano_down</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"################################################"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">p</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">MakeVenna</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #ebedf0; font-style: italic;">,</span>
                      <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading all all_top_down files
  <span style="color: #ebedf0; font-style: italic;">com_table</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">DEG_table</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">6</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Calculating up and down regulated gens
  <span style="color: #ebedf0; font-style: italic;">DEGslist</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">3</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Common genes
  <span style="color: #ebedf0; font-style: italic;">com_prob</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Reduce</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">intersect</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">)</span>
  # Writing all common genes into separated files as well as the top files
  <span style="color: #ebedf0; font-style: italic;">all_com</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">comn</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">com_prob</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">com_final_DEG</span>  <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">comn</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_final_DEG</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sorted_com_final_DEG</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_final_DEG</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_final_DEG</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">all_com</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sorted_com_final_DEG</span>
    <span style="color: #ebedf0; font-style: italic;">com_final_up</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_final_DEG</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_final_DEG</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">com_final_up</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_final_up</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">com_final_down</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_final_DEG</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_final_DEG</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">com_final_down</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_final_down</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_final_up</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">com_final_down</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_top_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  <span style="color: #ebedf0; font-style: italic;">firstsecond_col</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">remaining</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_com</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">firstsecond_col</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_com</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">remaining</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_com</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">3</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">6</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  <span style="color: #ebedf0; font-style: italic;">firstsecond_col_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">firstsecond_col</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sz</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"zSco"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">firstsecond_col_df</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">fdr</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">firstsecond_col_df</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sz_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rowMeans</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">firstsecond_col_df</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">sz</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">fdr_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rowMeans</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">firstsecond_col_df</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">fdr</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sz_fdr_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">zSco</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">sz_mean</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">FDR</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">fdr_mean</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sz_fdr_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sz_fdr_df</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">remaining</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sz_fdr_df</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/all_mean_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Common genes between all datasets have saved into common folder. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Creating venn diagram
  <span style="color: #ebedf0; font-style: italic;">DEGslist</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">3</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">venlist</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">venlist</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1234</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">venaa</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ggvenn</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">venlist</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                  <span style="color: #ebedf0; font-style: italic;">fill_color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span>
                  <span style="color: #ebedf0; font-style: italic;">stroke_size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #ebedf0; font-style: italic;">,</span>
                  <span style="color: #ebedf0; font-style: italic;">set_name_size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">4</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">venaa</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Reading files
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/networkanalyst"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">paired_pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paired_pheno</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  # Finding matching grades or subtypes
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">g_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">round</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">identical</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  <span style="color: #ebedf0; font-style: italic;">genemissing</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">genemissing</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>

  <span style="color: #ebedf0; font-style: italic;">grouplis</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">name</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">collapse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownum</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">name</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">grouplis</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">rownum</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Renaming the matrix file according to the groups name specified by user 
  <span style="color: #ebedf0; font-style: italic;">updown_matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grouplis</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">matname</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grouplis</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">collapse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">matcoln</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">matcoln</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grouplis</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Adding col names and second row according to the file for networkanalyst
  <span style="color: #ebedf0; font-style: italic;">changedcol</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grouplis</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">collapse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">updown_matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">changedcol</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"#CLASS"</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"#NAME"</span>
  <span style="color: #ebedf0; font-style: italic;">write.table</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/networkanalyst/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_network_full.txt"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">quote</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row.names</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"\t"</span> <span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Your file has saved into networkanalyst folder. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                        <span style="color: #ebedf0; font-style: italic;">sorted</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">1234</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Reading phenotype
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading annotation  
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">ID</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">identical</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">ID</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Averaging duplicated genes
  <span style="color: #ebedf0; font-style: italic;">dupgene_freq</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">table</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">only_dupgene</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">dupgene_freq</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">dupgene_freq</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Freq</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">duplicat_deg</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  
  <span style="color: #ebedf0; font-style: italic;">averaged_genes</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span>i <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">d_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">only_dupgene</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">col_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colMeans</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">d_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">col_all</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">duplicat_deg</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">d_row</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">col_mean</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">col_all</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">averaged_genes</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  <span style="color: #ebedf0; font-style: italic;">unique_deg</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">only_dupgene_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">all_unique_genes</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">unique_deg</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">averaged_genes</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #cf4275; font-style: italic;">NULL</span> 
  # Reading DEG file
  <span style="color: #ebedf0; font-style: italic;">DEG_table</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Finding up and down regulated gene and make original matrix of them
  <span style="color: #ebedf0; font-style: italic;">up</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">up</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">up</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">3</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">down</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">DEG</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">down</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">down</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">:</span><span style="color: #cf4275; font-style: italic;">3</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">genelist</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">up</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">down</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">2</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">num</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">genelist</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">network_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all_unique_genes</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">num</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span>
  <span style="color: #ebedf0; font-style: italic;">network_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">network_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">as.matrix</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sapply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Gene.symbol</span>
  
  # Finding grades and matching with colnames
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">g_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid_n</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">sampleid_n</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Grade_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span> 
  <span style="color: #ebedf0; font-style: italic;">network_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> 
  # Grade info
  <span style="color: #ebedf0; font-style: italic;">type</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">ha</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">HeatmapAnnotation</span><span style="color: #68affc; font-style: italic;">(</span>
    <span style="color: #ebedf0; font-style: italic;">df</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">Grade</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> type</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
    <span style="color: #ebedf0; font-style: italic;">annotation_height</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">unit</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">4</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">)</span>
  # Heatmap plot
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">Heatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">row_names_gp</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">gpar</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">fontsize </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">7</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">bottom_annotation</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">ha</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">column_order</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">border_gp</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">gpar</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">col</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">row_title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"DEGs"</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">row_title_side</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"left"</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">show_column_names</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">heatmap_legend_param</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">legend_direction</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"vertical"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      <span style="color: #ebedf0; font-style: italic;">legend_height</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">unit</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">50</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      <span style="color: #ebedf0; font-style: italic;">grid_width</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">unit</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">6</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      <span style="color: #ebedf0; font-style: italic;">grid_height</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">unit</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">50</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"cm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Expression"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">Heatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">network_df</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">row_names_gp</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">gpar</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">fontsize </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">7</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">bottom_annotation</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">ha</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">border_gp</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">gpar</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">col</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">row_title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"DEGs"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">row_title_side</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"left"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">show_column_names</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">heatmap_legend_param</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">legend_direction</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"vertical"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        <span style="color: #ebedf0; font-style: italic;">legend_height</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">unit</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">50</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        <span style="color: #ebedf0; font-style: italic;">grid_width</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">unit</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">6</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        <span style="color: #ebedf0; font-style: italic;">grid_height</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">unit</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">50</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"cm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Expression"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">FDR</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Reading file 
  <span style="color: #ebedf0; font-style: italic;">DEG_table</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Removing /// from some genes
  <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"///.*"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span><span style="color: #68affc; font-style: italic;">)</span>
  # Extracting Halmark pathway with 50 gene sets 
  <span style="color: #ebedf0; font-style: italic;">H</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">msigdbr</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">species</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Homo sapiens"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">category</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"H"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">H.symbol.ls</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">H</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    <span style="color: #ebedf0; font-style: italic;">select</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gs_name</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">gene_symbol</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    <span style="color: #ebedf0; font-style: italic;">group_by</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gs_name</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    <span style="color: #ebedf0; font-style: italic;">summarise</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">all.genes</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">unique</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gene_symbol</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    <span style="color: #ebedf0; font-style: italic;">deframe</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  # Just gene names and logFC
  <span style="color: #ebedf0; font-style: italic;">FC</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #cf4275; font-style: italic;">3</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  
  ##format for gsea 
  <span style="color: #ebedf0; font-style: italic;">FC.vec</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">FC</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">zSco</span>
  <span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">FC.vec</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">FC</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Gene.symbol</span>
  #Run GSEA
  <span style="color: #ebedf0; font-style: italic;">gsea.H</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">fgseaSimple</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pathways</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">H.symbol.ls</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">stats</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">FC.vec</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">scoreType</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"std"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">nperm</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #cf4275; font-style: italic;">1000</span><span style="color: #68affc; font-style: italic;">)</span>

  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Remove prefixes
  <span style="color: #ebedf0; font-style: italic;">gsea.H</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">pathway</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"HALLMARK_"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">gsea.H</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">pathway</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">gsea.H</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">pathway</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"_"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">" "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">gsea.H</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">pathway</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the Significance based on FDR and NES
  <span style="color: #ebedf0; font-style: italic;">gsea.H</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsea.H</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">Significance</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificance"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">Significance</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">padj </span><span style="color: #68affc; font-style: italic;"><=</span> <span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">&</span> <span style="color: #2ad43b; font-style: italic;">NES</span><span style="color: #68affc; font-style: italic;"> ></span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">Significance</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">Significance</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">padj </span><span style="color: #68affc; font-style: italic;"><=</span> <span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">&</span> <span style="color: #2ad43b; font-style: italic;">NES</span> <span style="color: #68affc; font-style: italic;"><</span> <span style="color: #cf4275; font-style: italic;">0</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">Significance</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">gsea.H</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsea.H</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gsea.H</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Significance</span> <span style="color: #68affc; font-style: italic;">!</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificance"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # Plotting the result
  <span style="color: #ebedf0; font-style: italic;">gsea.H</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">reorder</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pathway</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">NES</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">NES</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">geom_col</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">width</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">color</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">Significance</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">Significance</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Gene set'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Gene set'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #0000FF; font-style: italic; padding: 2px;"><span style="color: #2ad43b; font-style: italic;">blue</span></span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #FF0000; font-style: italic; padding: 2px;"><span style="color: #2ad43b; font-style: italic;">red</span></span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #0000FF; font-style: italic; padding: 2px;"><span style="color: #2ad43b; font-style: italic;">blue</span></span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #FF0000; font-style: italic; padding: 2px;"><span style="color: #2ad43b; font-style: italic;">red</span></span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">coord_flip</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">9</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.5</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">90</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">24</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">00</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">legend.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
          <span style="color: #ebedf0; font-style: italic;">legend.title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">20</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSEA - "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #05c6e3; font-style: italic;">###################################################### Running all functions ###################################################### </span>

# Downloading GEO 
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
# Reading GEO matrix into R environment
<span style="color: #ebedf0; font-style: italic;">GSE11121</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ReadGEO</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSE25055</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ReadGEO</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSE25065</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ReadGEO</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSE7390</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ReadGEO</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
# Preparing phenotype for all 4 GEO 
<span style="color: #ebedf0; font-style: italic;">Makephenotype</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
              <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Box plot for each matrix
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA plot for each matrix
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Normalization for each matrix
<span style="color: #ebedf0; font-style: italic;">normalized_GSE11121</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE11121</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25055</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #68affc; font-style: italic;">)</span>

# Box and PCA after normalization for some matrix
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Merging studies without batch correction (just for comparison)
<span style="color: #ebedf0; font-style: italic;">merge_studies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Mergestudies</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA before batch effect 
# Important note : studies should match projname 
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Batch effect correction
<span style="color: #ebedf0; font-style: italic;">corbatch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">StudyBatchEffect</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA after batch effect 
# Important note : studies should match projname 
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">corbatch</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>




# Density plot before batch effect correction
<span style="color: #ebedf0; font-style: italic;">MakeDensityPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSE25055</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                              <span style="color: #ebedf0; font-style: italic;"> GSE11121</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                              <span style="color: #ebedf0; font-style: italic;"> GSE25065</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;"> GSE7390</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>


# Density plot after batch effect correction
<span style="color: #ebedf0; font-style: italic;">MakeDensityPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">corbatch</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSE25055</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                              <span style="color: #ebedf0; font-style: italic;"> GSE11121</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                              <span style="color: #ebedf0; font-style: italic;"> GSE25065</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;"> GSE7390</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# MDS plot before batch effect correction
# Important note : studies should match projname 
<span style="color: #ebedf0; font-style: italic;">MakeMDSPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">nstudies </span><span style="color: #68affc; font-style: italic;">=</span>  <span style="color: #cf4275; font-style: italic;">4</span><span style="color: #68affc; font-style: italic;">)</span>


# MDS plot after batch effect correction
# Important note : studies should match projname
<span style="color: #ebedf0; font-style: italic;">MakeMDSPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">corbatch</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">nstudies </span><span style="color: #68affc; font-style: italic;">=</span>  <span style="color: #cf4275; font-style: italic;">4</span><span style="color: #68affc; font-style: italic;">)</span>

# Cohran Q test 
<span style="color: #ebedf0; font-style: italic;">cohranqtest</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">CochranQTest</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
# QQ plot of Cohran Q test 
<span style="color: #ebedf0; font-style: italic;">MakeQQPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cohranq</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">cohranq</span>test</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nstudies </span><span style="color: #68affc; font-style: italic;">=</span>  <span style="color: #cf4275; font-style: italic;">4</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">FEMREMAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">model</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"REM"</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">nperm</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">50</span><span style="color: #68affc; font-style: italic;">)</span>


<span style="color: #ebedf0; font-style: italic;">volcano_GSE11121</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Makevolcano</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">padjlevel</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">pSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">nSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">volcano_GSE7390</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Makevolcano</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">padjlevel</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">pSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">nSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">volcano_GSE25065</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Makevolcano</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">padjlevel</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">pSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">nSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">volcano_GSE25055</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Makevolcano</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">padjlevel</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">pSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">nSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>
# Combination
<span style="color: #ebedf0; font-style: italic;">volcano_combination</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Makevolcano</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">padjlevel</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">pSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">nSE_thresh</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #68affc; font-style: italic;">-</span><span style="color: #cf4275; font-style: italic;">1</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeVenna</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">10</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">25</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">25</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">25</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">25</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>

# Combination 
<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">25</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">FALSE</span><span style="color: #68affc; font-style: italic;">)</span>
# Sorted grade
<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">25</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">TRUE</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #68affc; font-style: italic;">)</span>

# Combination
<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">FDR</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #cf4275; font-style: italic;">0.05</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span>
                   <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span>
                   <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span>
                   <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span>
                   <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>




	    </code></pre>
	</section>

	<footer class="footer">
	    <p>&copy; 2023 Mohammad Reza Mohajeri. All rights reserved.</p>
	</footer>
</body>
</html>
