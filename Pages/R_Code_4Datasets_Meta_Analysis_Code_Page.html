><!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>R Code <br> For 4 Datasets (Meta-analysis)</title>
	<style>

		body {
			background-color: #12243d; /*  Cobalt color code */

		}
		
				
		/* CSS Styles  */
		/* To highlight different parts of the text in red<span style="color: #ebedf0; font-style: italic;">,</span> green<span style="color: #ebedf0; font-style: italic;">,</span> and blue<span style="color: #ebedf0; font-style: italic;">,</span> you can use the <span> element and apply CSS styles to it */ 
		
		.orange-text {
			color: orange;
			font-weight: bold;
		}
		.dark-yellow-text {
			color: hsl(50<span style="color: #ebedf0; font-style: italic;">,</span> 100%<span style="color: #ebedf0; font-style: italic;">,</span> 30%); /* Adjust the hue and saturation values as needed */
			font-weight: bold;
		}
		.brown-text {
			color: hsl(30<span style="color: #ebedf0; font-style: italic;">,</span> 100%<span style="color: #ebedf0; font-style: italic;">,</span> 30%); /* Adjust the hue and saturation values as needed */
			font-weight: bold;
		}
		.green-text {
			color: green;
			font-weight: bold;
		}
		.purple-text {
			color: purple;
			font-weight: bold;
		}
		.blue-text {
			color: blue;
			font-weight: bold;
		}


		/* Header Styles */
		header {
			background-color: #274f4f;
			color: white;
			text-align: center;
			padding: 5px;
		}

		h1 {
			color: white; /* Adjust the font color as desired */
			font-size: 30px; /* Adjust the font size as desired */
			font-weight: bold; /* Add font weight as desired */
			text-align: center; /* Center the header title */
			padding: 0px; /* Add padding around the header title */
			margin-bottom: 20px; /* Add margin below the header title */
		}
		
		hr {
			width: 100%; /* Adjust the width as desired */
		}
		
		/* Adjust font size for the code block */
		pre code {
		        font-size: 17px; /* Adjust the font size as desired */
	        }
		
		/* Footer Styles */
		.footer {
		        background-color: #333;
		        color: #fff;
		        padding: 10px;
		        text-align: center;
		        position: fixed;
		        left: 0;
		        bottom: 0;
		        width: 100%;
		}
	</style>
	
</head>
<body>
	<header>
		<h1>R Code <br> For 4 Datasets (Meta-analysis)</h1>
	</header>

	<section>
		
<pre><code>
		
<span style="color: #05c6e3; font-style: italic;">################################################################# "Package Installation" #################################################################</span>
<span style="color: #05c6e3; font-style: italic;">#################################### Uncomment the following lines if any of the packages are not already installed or need to be reinstalled.############</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager packages</span>
<span style="color: #05c6e3; font-style: italic;"># Install required Bioconductor packages</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("sva", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("GeneMeta", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("ComplexHeatmap", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("fgsea", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("clusterProfiler", force = TRUE)</span>
			
<span style="color: #05c6e3; font-style: italic;"># Other packages</span>
<span style="color: #05c6e3; font-style: italic;"># Install required CRAN packages:</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("RColorBrewer")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("msigdbr")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggpubr")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("reshape2")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("caret")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("rgl")</span>

<span style="color: #05c6e3; font-style: italic;"># sva package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "sva" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("sva")</span>

<span style="color: #05c6e3; font-style: italic;"># VSN package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "vsn" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("vsn")</span>

<span style="color: #05c6e3; font-style: italic;"># tidyverse package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("tidyverse")</span>

<span style="color: #05c6e3; font-style: italic;"># GEOquery package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "GEOquery" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("GEOquery")</span>

<span style="color: #05c6e3; font-style: italic;"># limma package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("limma")</span>

<span style="color: #05c6e3; font-style: italic;"># plotly package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("plotly")</span>

<span style="color: #05c6e3; font-style: italic;"># ggvenn package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggvenn")</span>

<span style="color: #05c6e3; font-style: italic;"># ggpubr package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggpubr")</span>

<span style="color: #05c6e3; font-style: italic;"># rgl package installation</span>
<span style="color: #05c6e3; font-style: italic;"># For rgl installation, require remotes package first</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("remotes")</span>
<span style="color: #05c6e3; font-style: italic;"># require(remotes)</span>
<span style="color: #05c6e3; font-style: italic;"># remotes::install_github("dmurdoch/rgl")</span>


<span style="color: #05c6e3; font-style: italic;"># Package Loading</span>
<span style="color: #05c6e3; font-style: italic;"># Load the required packages for data analysis and visualization.</span>
			
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">tidyverse</span><span style="color: #68affc; font-style: italic;">)</span>       <span style="color: #05c6e3; font-style: italic;"># Package for comprehensive data manipulation and visualization, including dplyr, ggplot2, and other useful packages</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOquery</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for accessing and retrieving gene expression data from the Gene Expression Omnibus (GEO) database</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">reshape2</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for reshaping data from wide to long format and vice versa, useful for data preprocessing</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">caret</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for machine learning and predictive modeling, providing a unified interface for various algorithms and performance evaluation</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GeneMeta</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for meta-analysis of gene expression data, allowing combining results from multiple studies</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">limma</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for analyzing microarray data using linear models, including differential expression analysis</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rgl</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for creating interactive 3D visualizations, useful for exploring complex data structures</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sva</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for surrogate variable analysis, used to identify and adjust for unwanted variation in high-dimensional datasets</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">plotly</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating interactive and dynamic plots, including scatter plots, bar plots, and more</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ggvenn</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating Venn diagrams using ggplot2, useful for visualizing set relationships</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ggpubr</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating publication-ready plots using ggplot2, providing additional customization options</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ComplexHeatmap</span><span style="color: #68affc; font-style: italic;">)</span>  <span style="color: #05c6e3; font-style: italic;"># Package for creating complex heatmaps, allowing visualization of multiple layers of data and annotations</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">RColorBrewer</span><span style="color: #68affc; font-style: italic;">)</span>    <span style="color: #05c6e3; font-style: italic;"># Package for providing color palettes suitable for data visualization</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">msigdbr</span><span style="color: #68affc; font-style: italic;">)</span>         <span style="color: #05c6e3; font-style: italic;"># Package for accessing and using the Molecular Signatures Database (MSigDB) for gene set enrichment analysis</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">fgsea</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for performing gene set enrichment analysis (GSEA) using fast gene set testing algorithms</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">locfit</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for local regression modeling, useful for fitting flexible curves to data</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">vsn</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for variance stabilization and normalization, specifically for microarray data analysis</span>
 
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Create a folder
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Increase memory
  <span style="color: #ebedf0; font-style: italic;">Sys.setenv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"VROOM_CONNECTION_SIZE"</span><span style="color: #68affc; font-style: italic;">=</span>131072<span style="color: #68affc; font-style: italic;">*</span>10<span style="color: #68affc; font-style: italic;">)</span>
  #Download dataset
  <span style="color: #ebedf0; font-style: italic;">gset</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">getGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">GSE<span style="color: #ebedf0; font-style: italic;">matrix</span></span> <span style="color: #68affc; font-style: italic;">=</span>TRUE<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">AnnotGPL</span> <span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">destdir</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">getwd</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">!</span><span style="color: #ebedf0; font-style: italic;">is.null</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    # Extracting <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #ebedf0; font-style: italic;">,</span> and annotation
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_<span style="color: #ebedf0; font-style: italic;">matrix</span>.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">assayData</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>"exprs"<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
    # Reverse log2 transformation if the <span style="color: #ebedf0; font-style: italic;">matrix</span> is transformed
    <span style="color: #ebedf0; font-style: italic;">qx</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">quantile</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>0.<span style="color: #ebedf0; font-style: italic;">,</span> 0.25<span style="color: #ebedf0; font-style: italic;">,</span> 0.5<span style="color: #ebedf0; font-style: italic;">,</span> 0.75<span style="color: #ebedf0; font-style: italic;">,</span> 0.99<span style="color: #ebedf0; font-style: italic;">,</span> 1.0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> na.rm<span style="color: #68affc; font-style: italic;">=</span>T<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">LogC</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">qx</span><span style="color: #68affc; font-style: italic;">[</span>5<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;"> ></span> 100<span style="color: #68affc; font-style: italic;">)</span> || <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">qx</span><span style="color: #68affc; font-style: italic;">[</span>6<span style="color: #68affc; font-style: italic;">]</span>-<span style="color: #ebedf0; font-style: italic;">qx</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;"> ></span> 50 <span style="color: #68affc; font-style: italic;">&</span><span style="color: #68affc; font-style: italic;">&</span> <span style="color: #ebedf0; font-style: italic;">qx</span><span style="color: #68affc; font-style: italic;">[</span>2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;"> ></span> 0<span style="color: #68affc; font-style: italic;">)</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">!</span><span style="color: #ebedf0; font-style: italic;">LogC</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> 2^<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>

    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_<span style="color: #ebedf0; font-style: italic;">matrix</span>.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">phenoData</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">data</span>
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_<span style="color: #ebedf0; font-style: italic;">matrix</span>.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">featureData</span><span style="color: #68affc; font-style: italic;">@</span><span style="color: #ebedf0; font-style: italic;">data</span>
    # Writing the extracted variables
    <span style="color: #ebedf0; font-style: italic;">write.csv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"<span style="color: #ebedf0; font-style: italic;">matrix</span>.csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">quote</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row.names</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"<span style="color: #ebedf0; font-style: italic;">phenotype</span>.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    # Removing variables
    <span style="color: #ebedf0; font-style: italic;">rm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gset</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Datatset is ready to analyse. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">ReadGEO</span>  <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Reading matrix file
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"<span style="color: #ebedf0; font-style: italic;">matrix</span>.csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>


<span style="color: #ebedf0; font-style: italic;">Makephenotype</span>  <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Preparing the <span style="color: #ebedf0; font-style: italic;">phenotype</span> for all GSE files
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"<span style="color: #ebedf0; font-style: italic;">phenotype</span>"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"<span style="color: #ebedf0; font-style: italic;">phenotype</span>.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Choosing either subtype or grade
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"subtype"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">pheno2</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">for</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">phecoln</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"pam50"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
     <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phecoln</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;"> ></span> 0<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
        <span style="color: #ebedf0; font-style: italic;">pheno1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">phecoln</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"subtype"</span>
        <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">subtype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"pam50.+:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">subtype</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">pheno1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;"> pheno1</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Sample"</span>
        <span style="color: #ebedf0; font-style: italic;">pheno2</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno1</span>
      <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">pheno3</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno2</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno3</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
    
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span><span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">pheno2</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">for</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">gradecoln</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"grade:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
     <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">gradecoln</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;"> ></span> 0<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
        <span style="color: #ebedf0; font-style: italic;">pheno1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">gradecoln</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span>
        <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"grade:|grade: |B-R grade: "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"=.+"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">greek</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"III"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
       <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">greek</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;"> ></span> 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
          <span style="color: #ebedf0; font-style: italic;">one</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"I"</span><span style="color: #68affc; font-style: italic;">)</span>
          <span style="color: #ebedf0; font-style: italic;">two</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"II"</span><span style="color: #68affc; font-style: italic;">)</span>
          <span style="color: #ebedf0; font-style: italic;">three</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;"><span style="color: #ebedf0; font-style: italic;">pheno1</span></span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"III"</span><span style="color: #68affc; font-style: italic;">)</span>
          <span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">one</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"1"</span>
          <span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">two</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"2"</span>
          <span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">three</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"3"</span>
        <span style="color: #68affc; font-style: italic;">}</span>
        <span style="color: #ebedf0; font-style: italic;">pheno1</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;"> pheno1</span><span style="color: #68affc; font-style: italic;">)</span>
        <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno1</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Sample"</span>
        <span style="color: #ebedf0; font-style: italic;">pheno2</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno1</span>
      <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">pheno3</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno2</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno3</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
  <span style="color: #68affc; font-style: italic;">}</span>
  # Writing <span style="color: #ebedf0; font-style: italic;">phenotype</span> file
  <span style="color: #ebedf0; font-style: italic;">write.csv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno3</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"<span style="color: #ebedf0; font-style: italic;">phenotype</span>"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"<span style="color: #ebedf0; font-style: italic;">phenotype</span>_"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row.names</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">quote</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype file is created into phenotype folder"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>
	
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Make a long format data frame
  <span style="color: #ebedf0; font-style: italic;">melted</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">melt</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">id.vars</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting 
  <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">melted</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">variable</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">value</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">geom_boxplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #45B39D; font-style: italic; padding: 2px;">#45B39D</span><span style="color: #ebedf0; font-style: italic;">,</span> fill<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #45B39D; font-style: italic; padding: 2px;">#45B39D</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">outlier.alpha</span> <span style="color: #68affc; font-style: italic;">=</span> 0.1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'SampleID'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Values'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_y_continuous</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">labels</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">scales</span><span style="color: #68affc; font-style: italic;">::</span><span style="color: #ebedf0; font-style: italic;">comma</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 6<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 12<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">legend.position</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"none"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Box plot - "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                    <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span>  NULL<span style="color: #ebedf0; font-style: italic;">,</span>
                    <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                    <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Plots"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix file
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span>123<span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Reading phenotype file
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">paired_pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paired_pheno</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # PCA analysis
  <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">t</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pca_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">scale</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pca</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">preProcess</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">method</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'pca'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pcaComp</span> <span style="color: #68affc; font-style: italic;">=</span> 3<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pca_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">predict</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pca_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">na_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;"> ></span> 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">na_samp</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">na_colm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">na_samp</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">pca_df</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_colm</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Class</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # 2D plot for multi-studies
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">></span> 1<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">pca_rownames</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span>
    <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
      l <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">pca_rownames</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">l</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">studies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">PC1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">PC2</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">geom_point</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 3<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span> <span style="color: #ebedf0; font-style: italic;">shape</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">legend.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">legend.title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 20<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"PCA plot- Merged studies"</span><span style="color: #68affc; font-style: italic;">)</span>
    
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    
    # Plotting
    <span style="color: #ebedf0; font-style: italic;">plot3d</span><span style="color: #68affc; font-style: italic;">(</span> 
      <span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">PC1</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">PC2</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">z</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">PC3</span><span style="color: #ebedf0; font-style: italic;">,</span> 
      <span style="color: #ebedf0; font-style: italic;">col</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #ebedf0; font-style: italic;">type</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'s'</span><span style="color: #ebedf0; font-style: italic;">,</span> 
      <span style="color: #ebedf0; font-style: italic;">radius</span> <span style="color: #68affc; font-style: italic;">=</span> 4<span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 3<span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #ebedf0; font-style: italic;">xlab</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">ylab</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC2"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">zlab</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC3"</span><span style="color: #68affc; font-style: italic;">)</span>
    # Legend
    <span style="color: #ebedf0; font-style: italic;">legend3d</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"topright"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             <span style="color: #ebedf0; font-style: italic;">legend</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">levels</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pca_df</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span>
             <span style="color: #ebedf0; font-style: italic;">pch</span> <span style="color: #68affc; font-style: italic;">=</span> 16<span style="color: #ebedf0; font-style: italic;">,</span>
             <span style="color: #ebedf0; font-style: italic;">col</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             <span style="color: #ebedf0; font-style: italic;">cex</span><span style="color: #68affc; font-style: italic;">=</span>1.2<span style="color: #ebedf0; font-style: italic;">,</span> 
             <span style="color: #ebedf0; font-style: italic;">inset</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>0.02<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    
    # Saving the plot into Plots folder
    <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">collapse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"-"</span><span style="color: #68affc; font-style: italic;">)</span> 
    <span style="color: #ebedf0; font-style: italic;">htmlwidgets</span><span style="color: #68affc; font-style: italic;">::</span><span style="color: #ebedf0; font-style: italic;">saveWidget</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rglwidget</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">width</span> <span style="color: #68affc; font-style: italic;">=</span> 800<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">height</span> <span style="color: #68affc; font-style: italic;">=</span> 800<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                            <span style="color: #ebedf0; font-style: italic;">file</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Plots/PCA_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".html"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">libdir</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"libs"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"PCA - "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">selfcontained</span> <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
  # VSN normalization
  <span style="color: #ebedf0; font-style: italic;">vsnnorm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">normalizeVSN</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span>
  # quantile normalization
  <span style="color: #ebedf0; font-style: italic;">df_rank</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">apply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">vsnnorm</span><span style="color: #ebedf0; font-style: italic;">,</span>2<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">rank</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">ties.method</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"min"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">df_sorted</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">apply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">vsnnorm</span><span style="color: #ebedf0; font-style: italic;">,</span> 2<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sort</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">df_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">apply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">df_sorted</span><span style="color: #ebedf0; font-style: italic;">,</span> 1<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">mean</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">index_to_mean</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_index</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">my_mean</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_mean</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">my_index</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">norm_final</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">apply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">df_rank</span><span style="color: #ebedf0; font-style: italic;">,</span> 2<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">index_to_mean</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">my_mean</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">df_mean</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">norm_final</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">norm_final</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">norm_finall</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sapply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">norm_final</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">as.character</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                    <span style="color: #ebedf0; font-style: italic;">check.names</span><span style="color: #68affc; font-style: italic;">=</span>F<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">norm_finall</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">norm_finall</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">norm_finall</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">norm_finall</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">Mergestudies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Merging two or more matrix
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Reduce</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #ebedf0; font-style: italic;">merge</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">all</span><span style="color: #68affc; font-style: italic;">=</span>TRUE<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">StudyBatchEffect</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Calculating the number of samples for each matrix
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ncol</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">-</span> 1
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
  # Merging matrices
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Reduce</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #ebedf0; font-style: italic;">merge</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">all</span><span style="color: #68affc; font-style: italic;">=</span>TRUE<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
  # Batch correction
  <span style="color: #ebedf0; font-style: italic;">corrected_batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ComBat</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">dat</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">mod</span><span style="color: #68affc; font-style: italic;">=</span>NULL<span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">par.prior</span><span style="color: #68affc; font-style: italic;">=</span>TRUE<span style="color: #ebedf0; font-style: italic;">,</span> 
                            <span style="color: #ebedf0; font-style: italic;">prior.plots</span><span style="color: #68affc; font-style: italic;">=</span>FALSE<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">corrected_batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">corrected_batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sapply</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">as.character</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">check.names</span><span style="color: #68affc; font-style: italic;">=</span>F<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row.names</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">corrected_batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">corrected_batch</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">MakeDensityPlot</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  # Make a long format data frame
  <span style="color: #ebedf0; font-style: italic;">melted</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">melt</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">id.vars</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the number of samples for each study 
  <span style="color: #ebedf0; font-style: italic;">st </span><span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">row_n</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">nrow</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">col_n</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ncol</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> -1
    <span style="color: #ebedf0; font-style: italic;">st</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row_n</span><span style="color: #68affc; font-style: italic;">*</span><span style="color: #ebedf0; font-style: italic;">col_n</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">st </span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">st</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">melted</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">studies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">st</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">melted</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">value</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">geom_density</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 1.5<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Density'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Value'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 12<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Density plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

<span style="color: #ebedf0; font-style: italic;">MakeMDSPlot</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">projname</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">compare</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                        <span style="color: #ebedf0; font-style: italic;">nstudies</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">t</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Cmpute MDS
  <span style="color: #ebedf0; font-style: italic;">mds</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">dist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>          
    <span style="color: #ebedf0; font-style: italic;">cmdscale</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Dim1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Dim2"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Clustering
  <span style="color: #ebedf0; font-style: italic;">clust</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">kmeans</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nstudies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">cluster</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">as.factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">mds</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">mds</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">clusters</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">clust</span><span style="color: #68affc; font-style: italic;">)</span>
  # Finding studies names
  <span style="color: #ebedf0; font-style: italic;">mds_rownames</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">study_list</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    l <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">study_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">mds_rownames</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">l</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">batch</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">studies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">batch</span><span style="color: #68affc; font-style: italic;">)</span> 
  
  # Plot and color by groups
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">g</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ggscatter</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Dim1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Dim2"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                 <span style="color: #ebedf0; font-style: italic;">label</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">mds</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">shape</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Studies"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                 <span style="color: #ebedf0; font-style: italic;">ggtheme</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Clusters"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">palette</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 1.5<span style="color: #ebedf0; font-style: italic;">,</span> 
                 <span style="color: #ebedf0; font-style: italic;">ellipse</span> <span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">ellipse.type</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"convex"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 <span style="color: #ebedf0; font-style: italic;">repel</span> <span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">g</span> <span style="color: #68affc; font-style: italic;">+</span> <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"MDS plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">CochranQTest</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix and phenotype
  <span style="color: #ebedf0; font-style: italic;">d.adj.Split</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">var.d.adj.Split</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">paired_pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paired_pheno</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">na_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    # Matching phenotype with samples in matrix
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">></span> 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">na_samp</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">na_colm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">na_samp</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>  <span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_colm</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    # Calculating the number of each comparison mode <span style="color: #68affc; font-style: italic;">(</span>grade1 vs grade3<span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">g_list</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">j</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">g_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">s_id</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">s_id</span>
      <span style="color: #ebedf0; font-style: italic;">g_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rep</span><span style="color: #68affc; font-style: italic;">(</span>j <span style="color: #68affc; font-style: italic;">-</span> 1<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    # Applying those modes and calculating the mean and variance for Cochran' Q Test
    spl <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span>g_list<span style="color: #68affc; font-style: italic;">)</span>
    spsam <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>spsam<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> as.<span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    d.Split <span style="color: #68affc; font-style: italic;"><-</span> getdF<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> spl<span style="color: #68affc; font-style: italic;">)</span>
    mean_d <span style="color: #68affc; font-style: italic;"><-</span> dstar<span style="color: #68affc; font-style: italic;">(</span>d.Split<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span>spl<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">d.adj.Split</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> mean_d
    var_d <span style="color: #68affc; font-style: italic;"><-</span> sigmad<span style="color: #68affc; font-style: italic;">(</span>mean_d<span style="color: #ebedf0; font-style: italic;">,</span> sum<span style="color: #68affc; font-style: italic;">(</span>spl<span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span>0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> sum<span style="color: #68affc; font-style: italic;">(</span>spl<span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span>1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">var.d.adj.Split</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> var_d
  <span style="color: #68affc; font-style: italic;">}</span>
  # Output means and variances as a list
  output <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">d.adj.Split</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">var.d.adj.Split</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span>output<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Analysis has completed."</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

MakeQQPlot <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>cohranq<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nstudies</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Unpack the previous list into data frames
  output1 <span style="color: #68affc; font-style: italic;"><-</span> cohranq<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> 
  output2 <span style="color: #68affc; font-style: italic;"><-</span> cohranq<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  mymns <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #ebedf0; font-style: italic;">,</span> output1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  myvars <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #ebedf0; font-style: italic;">,</span> output2<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating Cochran' Q Test
  my.Q <span style="color: #68affc; font-style: italic;"><-</span> f.Q<span style="color: #68affc; font-style: italic;">(</span>mymns<span style="color: #ebedf0; font-style: italic;">,</span> myvars<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">nstudies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">nstudies</span>
  #<span style="color: #ebedf0; font-style: italic;">quantile</span>s of the chisq distribution
  chisqq <span style="color: #68affc; font-style: italic;"><-</span> qchisq<span style="color: #68affc; font-style: italic;">(</span>seq<span style="color: #68affc; font-style: italic;">(</span>0<span style="color: #ebedf0; font-style: italic;">,</span> .9999<span style="color: #ebedf0; font-style: italic;">,</span> .001<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> df <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">nstudies</span>-1<span style="color: #68affc; font-style: italic;">)</span>
  tmp <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">quantile</span><span style="color: #68affc; font-style: italic;">(</span>my.Q<span style="color: #ebedf0; font-style: italic;">,</span> seq<span style="color: #68affc; font-style: italic;">(</span>0<span style="color: #ebedf0; font-style: italic;">,</span> .9999<span style="color: #ebedf0; font-style: italic;">,</span> .001<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  qq <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>chisqq <span style="color: #68affc; font-style: italic;">=</span> chisqq<span style="color: #ebedf0; font-style: italic;">,</span> tmp <span style="color: #68affc; font-style: italic;">=</span> tmp<span style="color: #68affc; font-style: italic;">)</span>
  # Plotting
  <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> qq<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> chisqq<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span> <span style="color: #68affc; font-style: italic;">=</span> tmp<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> "<span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span>"<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">geom_point</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    geom_abline<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'quantiles of Chi square'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'quantiles of Sample'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          legend.position<span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"none"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"QQ Plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

<span style="color: #ebedf0; font-style: italic;">FEMREMAnalysis</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                           <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #ebedf0; font-style: italic;">,</span>
                           model<span style="color: #ebedf0; font-style: italic;">,</span>
                           FDR<span style="color: #ebedf0; font-style: italic;">,</span>
                           nperm<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  # Creating folders
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Reading <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #ebedf0; font-style: italic;">file</span>
  <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">phenotype</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading annotation file
  annotations <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Chromosome.location"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GO.Function"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span> 
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">$</span>ID<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    annotations<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> annot
  <span style="color: #68affc; font-style: italic;">}</span>
  an <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Reduce</span><span style="color: #68affc; font-style: italic;">(</span>intersect<span style="color: #ebedf0; font-style: italic;">,</span> annotations<span style="color: #68affc; font-style: italic;">)</span>
  annotations <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #ebedf0; font-style: italic;">,</span> an<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  matrices_list <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">Class</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">studies</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #ebedf0; font-style: italic;">paired_pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">phenotype</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paired_pheno</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">na_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    # Matching <span style="color: #ebedf0; font-style: italic;">phenotype</span> with samples in <span style="color: #ebedf0; font-style: italic;">matrix</span> 
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">></span> 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">na_samp</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">na_colm</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">na_samp</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>  <span style="color: #68affc; font-style: italic;">-</span><span style="color: #ebedf0; font-style: italic;">na_colm</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    # Calculating the number of each comparison mode <span style="color: #68affc; font-style: italic;">(</span>grade1 vs grade3<span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">g_list</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">j</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      <span style="color: #ebedf0; font-style: italic;">g_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">s_id</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">s_id</span>
      <span style="color: #ebedf0; font-style: italic;">g_list</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">j</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">factor</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rep</span><span style="color: #68affc; font-style: italic;">(</span>j <span style="color: #68affc; font-style: italic;">-</span> 1<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    spl <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">g_list</span><span style="color: #68affc; font-style: italic;">)</span>
    spl <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">as.character</span><span style="color: #68affc; font-style: italic;">(</span>spl<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> spl
    spsam <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">unlist</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>spsam<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> as.<span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> ExpressionSet<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">assayData</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    matrices_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span>
  <span style="color: #68affc; font-style: italic;">}</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>model <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'FEM'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    useREM <span style="color: #68affc; font-style: italic;"><-</span> FALSE
  <span style="color: #68affc; font-style: italic;">}</span> 
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>model <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'REM'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    useREM <span style="color: #68affc; font-style: italic;"><-</span> TRUE
  <span style="color: #68affc; font-style: italic;">}</span>
  ScoresFDR <span style="color: #68affc; font-style: italic;"><-</span> zScoreFDR<span style="color: #68affc; font-style: italic;">(</span>matrices_list<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">Class</span><span style="color: #ebedf0; font-style: italic;">,</span> useREM <span style="color: #68affc; font-style: italic;">=</span> useREM<span style="color: #ebedf0; font-style: italic;">,</span> nperm <span style="color: #68affc; font-style: italic;">=</span> nperm<span style="color: #68affc; font-style: italic;">)</span>
  twosided <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>ScoresFDR<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #2ad43b; font-style: italic;">"two.sided"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  twosided <span style="color: #68affc; font-style: italic;"><-</span> twosided<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  # Adding annotation
  anno_row <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>annotations<span style="color: #68affc; font-style: italic;">$</span>ID <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  twosided <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #ebedf0; font-style: italic;">,</span>  annotations<span style="color: #68affc; font-style: italic;">[</span>anno_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>2<span style="color: #ebedf0; font-style: italic;">,</span> 3<span style="color: #ebedf0; font-style: italic;">,</span> 4<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  # Removing missing gene symbols
  genemissing <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span>
  twosided <span style="color: #68affc; font-style: italic;"><-</span> twosided<span style="color: #68affc; font-style: italic;">[</span>-genemissing<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # All studies
  combination <span style="color: #68affc; font-style: italic;"><-</span> twosided<span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"zSco"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Chromosome.location"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GO.Function"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  dupgene_freq <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>table<span style="color: #68affc; font-style: italic;">(</span>combination<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  only_dupgene <span style="color: #68affc; font-style: italic;"><-</span> dupgene_freq<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>dupgene_freq<span style="color: #68affc; font-style: italic;">$</span>Freq<span style="color: #68affc; font-style: italic;">></span> 1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 1<span style="color: #68affc; font-style: italic;">]</span>
  only_dupgene_row <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>combination<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">)</span>
  duplicat_deg <span style="color: #68affc; font-style: italic;"><-</span> combination<span style="color: #68affc; font-style: italic;">[</span>only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  
  averaged_genes <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span>b in 1:<span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span>only_dupgene<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    d_row <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">[</span>b<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    col_mean <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>colMeans<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #ebedf0; font-style: italic;">,</span> 1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    col_all <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span>col_mean<span style="color: #ebedf0; font-style: italic;">,</span> duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>3:5<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    averaged_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>b<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> col_all
  <span style="color: #68affc; font-style: italic;">}</span>
  averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
  unique_deg <span style="color: #68affc; font-style: italic;"><-</span> combination<span style="color: #68affc; font-style: italic;">[</span>-only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  all_unique_genes_combi <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>unique_deg<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
  
  all_unique_genes_combi <span style="color: #68affc; font-style: italic;"><-</span> all_unique_genes_combi<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> decreasing <span style="color: #68affc; font-style: italic;">=</span> T<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/combination.tsv"</span><span style="color: #68affc; font-style: italic;">)</span>
  # All studies with FDR filtering
  all_unique_genes_combi <span style="color: #68affc; font-style: italic;"><-</span> all_unique_genes_combi<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #68affc; font-style: italic;">]</span> < FDR<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered/combination.tsv"</span><span style="color: #68affc; font-style: italic;">)</span>
  
  # Seperating each study<span style="color: #ebedf0; font-style: italic;">,</span> averaging duplicated genes
  sfdr <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"FDR_Ex_{0-9}"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>sfdr<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    gs_col <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol|Chromosome.location|GO.Function"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    common <span style="color: #68affc; font-style: italic;"><-</span> twosided<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>sfdr<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span>-1<span style="color: #ebedf0; font-style: italic;">,</span> sfdr<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> gs_col<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1:2<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Ex_."</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">nrow</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">></span> 1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      dupgene_freq <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>table<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      only_dupgene <span style="color: #68affc; font-style: italic;"><-</span> dupgene_freq<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>dupgene_freq<span style="color: #68affc; font-style: italic;">$</span>Freq<span style="color: #68affc; font-style: italic;">></span> 1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 1<span style="color: #68affc; font-style: italic;">]</span>
      only_dupgene_row <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">)</span>
      duplicat_deg <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span>only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      
      averaged_genes <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span>b in 1:<span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span>only_dupgene<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
        d_row <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">[</span>b<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        col_mean <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>colMeans<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #ebedf0; font-style: italic;">,</span> 1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
        col_all <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span>col_mean<span style="color: #ebedf0; font-style: italic;">,</span> duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>3:5<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        averaged_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>b<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> col_all
      <span style="color: #68affc; font-style: italic;">}</span>
      averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
      unique_deg <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span>-only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      all_unique_genes <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>unique_deg<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
      <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
      all_unique_genes <span style="color: #68affc; font-style: italic;"><-</span> all_unique_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> decreasing <span style="color: #68affc; font-style: italic;">=</span> T<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      all_unique_genes <span style="color: #68affc; font-style: italic;"><-</span> all_unique_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>2<span style="color: #68affc; font-style: italic;">]</span> < FDR<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    eslash_genes <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"///"</span><span style="color: #ebedf0; font-style: italic;">,</span> all_unique_genes<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"###################### Summary for: "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">" ############################"</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span>cat<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Number of missing gene symbols:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span>genemissing<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nNumber of duplicated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span>only_dupgene<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nTotal number of genes after averaging duplicated genes and FDR filter:"</span><span style="color: #ebedf0; font-style: italic;">,</span> NROW<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nNumber of genes having ///:"</span><span style="color: #ebedf0; font-style: italic;">,</span> eslash_genes<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"##########################################################################"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++++++++++++++++++++ Analysis has completed. +++++++++++++++++++++++"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

Makevolcano <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                        pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                        nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Reading the DEGs table
  volcano <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  volcano <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1:2<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  #volcano <span style="color: #68affc; font-style: italic;"><-</span> volcano<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>FDR <span style="color: #68affc; font-style: italic;">!</span><span style="color: #68affc; font-style: italic;">=</span> 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  volcano <span style="color: #68affc; font-style: italic;"><-</span> volcano <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span>AdjustedPvalue <span style="color: #68affc; font-style: italic;">=</span> -log10<span style="color: #68affc; font-style: italic;">(</span>FDR<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span>DEG <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificant"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span>DEG <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>AdjustedPvalue<span style="color: #68affc; font-style: italic;">></span> -log10<span style="color: #68affc; font-style: italic;">(</span>padjlevel<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">&</span> zSco<span style="color: #68affc; font-style: italic;">></span> pSE_thresh<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> DEG<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span>DEG <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>AdjustedPvalue<span style="color: #68affc; font-style: italic;">></span> -log10<span style="color: #68affc; font-style: italic;">(</span>padjlevel<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">&</span> zSco < nSE_thresh<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> DEG<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  
  zero_fdr <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>FDR <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> 0<span style="color: #68affc; font-style: italic;">)</span>
  m <span style="color: #68affc; font-style: italic;"><-</span> -log10<span style="color: #68affc; font-style: italic;">(</span>min<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">[</span>-zero_fdr<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span> 0.5
  volcano<span style="color: #68affc; font-style: italic;">[</span>zero_fdr<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"AdjustedPvalue"</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> m
  # Colors
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the number of each Upregulated<span style="color: #ebedf0; font-style: italic;">,</span> Downregulated<span style="color: #ebedf0; font-style: italic;">,</span> and NotSignificant probes
  volcano_up <span style="color: #68affc; font-style: italic;"><-</span> volcano<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  volcano_down <span style="color: #68affc; font-style: italic;"><-</span> volcano<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  volcano_down <span style="color: #68affc; font-style: italic;"><-</span> volcano_down<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span>volcano_down<span style="color: #68affc; font-style: italic;">$</span>zSco<span style="color: #ebedf0; font-style: italic;">,</span> decreasing <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  volcano_NA <span style="color: #68affc; font-style: italic;"><-</span> volcano<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificant"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  # Combining all with together 
  volcano_all <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>volcano_up<span style="color: #ebedf0; font-style: italic;">,</span> volcano_down<span style="color: #ebedf0; font-style: italic;">,</span> volcano_NA<span style="color: #68affc; font-style: italic;">)</span>
  # Replacing the top probes with word Top
  ntop_rep <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;"> rep</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Top"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">ntop</span><span style="color: #68affc; font-style: italic;">)</span>
  volcano_all<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>ntop_rep<span style="color: #ebedf0; font-style: italic;">,</span> volcano_up<span style="color: #68affc; font-style: italic;">$</span>DEG<span style="color: #68affc; font-style: italic;">[</span>-<span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> ntop_rep<span style="color: #ebedf0; font-style: italic;">,</span> volcano_down<span style="color: #68affc; font-style: italic;">$</span>DEG<span style="color: #68affc; font-style: italic;">[</span>-<span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> volcano_NA<span style="color: #68affc; font-style: italic;">$</span>DEG<span style="color: #68affc; font-style: italic;">)</span>
  # Label only top genes
  volcano_all<span style="color: #68affc; font-style: italic;">$</span>Top <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>volcano_all<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Top"</span><span style="color: #ebedf0; font-style: italic;">,</span> volcano_all<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting either with plotly or ggplot
  if<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    p <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> volcano_all<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> zSco<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> AdjustedPvalue<span style="color: #ebedf0; font-style: italic;">,</span> color<span style="color: #68affc; font-style: italic;">=</span> DEG<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span> <span style="color: #68affc; font-style: italic;">=</span> DEG<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">label</span><span style="color: #68affc; font-style: italic;">=</span> Top<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span> 
      <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Effect size'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;"></span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">geom_point</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">shape</span> <span style="color: #68affc; font-style: italic;">=</span> 21<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">geom_text</span><span style="color: #68affc; font-style: italic;">(</span>check_overlap <span style="color: #68affc; font-style: italic;">=</span> T<span style="color: #ebedf0; font-style: italic;">,</span>vjust <span style="color: #68affc; font-style: italic;">=</span> 0.1<span style="color: #ebedf0; font-style: italic;">,</span> nudge_y <span style="color: #68affc; font-style: italic;">=</span> 0.1<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">legend.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">legend.title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 20<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    p
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    # Creating ggplot object<span style="color: #ebedf0; font-style: italic;">,</span> adding layers and annotation to the plot
    p <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ggplot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">data</span> <span style="color: #68affc; font-style: italic;">=</span> volcano_all<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span> <span style="color: #68affc; font-style: italic;">=</span> zSco<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> AdjustedPvalue<span style="color: #ebedf0; font-style: italic;">,</span> color<span style="color: #68affc; font-style: italic;">=</span> DEG<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span> <span style="color: #68affc; font-style: italic;">=</span> DEG<span style="color: #ebedf0; font-style: italic;">,</span> text <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span>
      <span style="color: #2ad43b; font-style: italic;">"<br>Gene: "</span><span style="color: #ebedf0; font-style: italic;">,</span> Gene.symbol<span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #2ad43b; font-style: italic;">"<br>Chromosome: "</span><span style="color: #ebedf0; font-style: italic;">,</span> Chromosome.location<span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #2ad43b; font-style: italic;">"<br>GO function: "</span><span style="color: #ebedf0; font-style: italic;">,</span> GO.function <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Effect size'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;"></span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">geom_point</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">shape</span> <span style="color: #68affc; font-style: italic;">=</span> 21<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
      <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    p <span style="color: #68affc; font-style: italic;"><-</span> ggplotly<span style="color: #68affc; font-style: italic;">(</span>p<span style="color: #ebedf0; font-style: italic;">,</span> tooltip <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"text"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
      layout<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
             font <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
             <span style="color: #ebedf0; font-style: italic;">legend</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 20<span style="color: #ebedf0; font-style: italic;">,</span> itemclick <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"toggle"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Calculation the up and down regulated genes number
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>volcano_up<span style="color: #ebedf0; font-style: italic;">,</span> volcano_down<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Creating the top table <span style="color: #68affc; font-style: italic;">(</span>up and down<span style="color: #68affc; font-style: italic;">)</span> based on the number specified <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ntop</span><span style="color: #68affc; font-style: italic;">)</span>
  top <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>volcano_up<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> volcano_down<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  top <span style="color: #68affc; font-style: italic;"><-</span> top<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-6<span style="color: #68affc; font-style: italic;">]</span>
  # Save top table into project folder
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span>top<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_top.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"################# Significance #################"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span>cat<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Up-regulated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nrow</span><span style="color: #68affc; font-style: italic;">(</span>volcano_up<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
              <span style="color: #2ad43b; font-style: italic;">"\nDown-regulated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">nrow</span><span style="color: #68affc; font-style: italic;">(</span>volcano_down<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"################################################"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span>p<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">MakeVenna</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #ebedf0; font-style: italic;">,</span>
                      <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Reading all all_top_down files
  <span style="color: #ebedf0; font-style: italic;">com_table</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">DEG_table</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-6<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Calculating up and down regulated gens
  <span style="color: #ebedf0; font-style: italic;">DEGslist</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>3<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Common genes
  com_prob <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Reduce</span><span style="color: #68affc; font-style: italic;">(</span>intersect<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">)</span>
  # Writing all common genes into separated files as well as the top files
  all_com <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    comn <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">%in%</span> com_prob<span style="color: #68affc; font-style: italic;">)</span>
    com_final_DEG  <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span>comn<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span>com_final_DEG<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    sorted_com_final_DEG <span style="color: #68affc; font-style: italic;"><-</span> com_final_DEG<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span>com_final_DEG<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
    all_com<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> sorted_com_final_DEG
    com_final_up <span style="color: #68affc; font-style: italic;"><-</span> com_final_DEG<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>com_final_DEG<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    com_final_up <span style="color: #68affc; font-style: italic;"><-</span> com_final_up<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    com_final_down <span style="color: #68affc; font-style: italic;"><-</span> com_final_DEG<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>com_final_DEG<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    com_final_down <span style="color: #68affc; font-style: italic;"><-</span> com_final_down<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>com_final_up<span style="color: #ebedf0; font-style: italic;">,</span> com_final_down<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_top_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  firstsecond_col <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  remaining <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>all_com<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    firstsecond_col<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>all_com<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    remaining<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>all_com<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>3:6<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  firstsecond_col_df <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #ebedf0; font-style: italic;">,</span> firstsecond_col<span style="color: #68affc; font-style: italic;">)</span>
  sz <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"zSco"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>firstsecond_col_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  fdr <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>firstsecond_col_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  sz_mean <span style="color: #68affc; font-style: italic;"><-</span> rowMeans<span style="color: #68affc; font-style: italic;">(</span>firstsecond_col_df<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>sz<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  fdr_mean <span style="color: #68affc; font-style: italic;"><-</span> rowMeans<span style="color: #68affc; font-style: italic;">(</span>firstsecond_col_df<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>fdr<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  sz_fdr_df <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>zSco <span style="color: #68affc; font-style: italic;">=</span> sz_mean<span style="color: #ebedf0; font-style: italic;">,</span> FDR<span style="color: #68affc; font-style: italic;">=</span> fdr_mean<span style="color: #68affc; font-style: italic;">)</span>
  sz_fdr_df <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span>sz_fdr_df<span style="color: #ebedf0; font-style: italic;">,</span> remaining<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">write_tsv</span><span style="color: #68affc; font-style: italic;">(</span>sz_fdr_df<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/all_mean_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Common genes between all datasets have saved into common folder. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Creating venn diagram
  <span style="color: #ebedf0; font-style: italic;">DEGslist</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">com_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span>3<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  venlist <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    venlist<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEGslist</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  venaa <span style="color: #68affc; font-style: italic;"><-</span> ggvenn<span style="color: #68affc; font-style: italic;">(</span>venlist<span style="color: #ebedf0; font-style: italic;">,</span> 
                  <span style="color: #ebedf0; font-style: italic;">fill_color</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">my_pal</span><span style="color: #ebedf0; font-style: italic;">,</span>
                  stroke_<span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #ebedf0; font-style: italic;">,</span>
                  set_name_<span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 4<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">return</span><span style="color: #68affc; font-style: italic;">(</span>venaa<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Reading files
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/networkanalyst"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">showWarnings</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">paired_pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">paired_pheno</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
  # Finding matching grades or subtypes
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">g_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> round<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> 2<span style="color: #68affc; font-style: italic;">)</span>
  identical<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  genemissing <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">is.na</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span>-genemissing<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>

  grouplis <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    name <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">collapse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span>
    rownum <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span>name<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span>
    grouplis<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">[</span>rownum<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Renaming the <span style="color: #ebedf0; font-style: italic;">matrix</span> file according to the <span style="color: #ebedf0; font-style: italic;">groups</span> name specified by user 
  <span style="color: #ebedf0; font-style: italic;">updown_matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>grouplis<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    matname <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span>grouplis<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">collapse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span>
    matcoln <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span>matname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">,</span>matcoln<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span>grouplis<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Adding col names and second row according to the file for networkanalyst
  changedcol <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">grep</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span>grouplis<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">collapse</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">updown_matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>1<span style="color: #ebedf0; font-style: italic;">,</span> changedcol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"#CLASS"</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"#NAME"</span>
  <span style="color: #ebedf0; font-style: italic;">write.table</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">updown_matrix</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/networkanalyst/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_network_full.txt"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">quote</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">row.names</span> <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sep</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"\t"</span> <span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">message</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Your file has saved into networkanalyst folder. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        <span style="color: #ebedf0; font-style: italic;">ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                        <span style="color: #ebedf0; font-style: italic;">sorted</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">set.seed</span><span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Reading <span style="color: #ebedf0; font-style: italic;">phenotype</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">read_csv</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">)</span>
  # Reading annotation  
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">annot</span><span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">$</span>ID<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>identical<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> annot<span style="color: #68affc; font-style: italic;">$</span>ID<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Averaging duplicated genes
  dupgene_freq <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>table<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  only_dupgene <span style="color: #68affc; font-style: italic;"><-</span> dupgene_freq<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>dupgene_freq<span style="color: #68affc; font-style: italic;">$</span>Freq<span style="color: #68affc; font-style: italic;"> ></span> 1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 1<span style="color: #68affc; font-style: italic;">]</span>
  only_dupgene_row <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">)</span>
  duplicat_deg <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span>only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  
  averaged_genes <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span>i in 1:<span style="color: #ebedf0; font-style: italic;">length</span><span style="color: #68affc; font-style: italic;">(</span>only_dupgene<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    d_row <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    col_mean <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>colMeans<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #ebedf0; font-style: italic;">,</span> -1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    col_all <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">cbind</span><span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> col_mean<span style="color: #68affc; font-style: italic;">)</span>
    averaged_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> col_all
  <span style="color: #68affc; font-style: italic;">}</span>
  averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>averaged_genes<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  unique_deg <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">[</span>-only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  all_unique_genes <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>unique_deg<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
  # Reading DEG file
  <span style="color: #ebedf0; font-style: italic;">DEG_table</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Finding up and down regulated gene and make original <span style="color: #ebedf0; font-style: italic;">matrix</span> of them
  up <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  up <span style="color: #68affc; font-style: italic;"><-</span> up<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span>2:3<span style="color: #68affc; font-style: italic;">]</span>
  down <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  down <span style="color: #68affc; font-style: italic;"><-</span> down<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">:ntop</span><span style="color: #ebedf0; font-style: italic;">,</span> 2:3<span style="color: #68affc; font-style: italic;">]</span>
  genelist <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #68affc; font-style: italic;">(</span>up<span style="color: #ebedf0; font-style: italic;">,</span> down<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>2<span style="color: #68affc; font-style: italic;">]</span>
  num <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> genelist<span style="color: #68affc; font-style: italic;">)</span>
  network_df <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">[</span>num<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  Gene.symbol <span style="color: #68affc; font-style: italic;"><-</span> network_df<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol
  network_df <span style="color: #68affc; font-style: italic;"><-</span> network_df<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">-</span>1<span style="color: #68affc; font-style: italic;">]</span>
  network_df <span style="color: #68affc; font-style: italic;"><-</span> as.<span style="color: #ebedf0; font-style: italic;">matrix</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sapply</span><span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">as.numeric</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">rownames</span><span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> Gene.symbol
  
  # Finding grades and matching with <span style="color: #ebedf0; font-style: italic;">colnames</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #f79502; font-style: italic;">for</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    <span style="color: #ebedf0; font-style: italic;">g_row</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">pheno</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">groups</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">i</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">pheno</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">g_row</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">do.call</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rbind</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">)</span>
  sampleid_n <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span> <span style="color: #68affc; font-style: italic;">%in%</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span>sampleid_n<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">order</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Grade_"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span><span style="color: #68affc; font-style: italic;">)</span> 
  network_df <span style="color: #68affc; font-style: italic;"><-</span> network_df<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span><span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">Sample</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">sampleid</span> <span style="color: #68affc; font-style: italic;">$</span><span style="color: #ebedf0; font-style: italic;">grade</span> 
  # Grade info
  type <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span>
  ha <span style="color: #68affc; font-style: italic;">=</span> HeatmapAnnotation<span style="color: #68affc; font-style: italic;">(</span>
    df <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span>Grade <span style="color: #68affc; font-style: italic;">=</span> type<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
    annotation_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>4<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">)</span>
  # Heatmap plot
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  Heatmap<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #ebedf0; font-style: italic;">,</span>
          row_names_gp <span style="color: #68affc; font-style: italic;">=</span> gpar<span style="color: #68affc; font-style: italic;">(</span>font<span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 7<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          bottom_annotation<span style="color: #68affc; font-style: italic;">=</span> ha<span style="color: #ebedf0; font-style: italic;">,</span>
          column_order <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">colnames</span><span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          border_gp <span style="color: #68affc; font-style: italic;">=</span> gpar<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">col</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">row_title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"DEGs"</span><span style="color: #ebedf0; font-style: italic;">,</span>
          row_title_side <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"left"</span><span style="color: #ebedf0; font-style: italic;">,</span>
          show_column_names <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #ebedf0; font-style: italic;">,</span>
          heatmap_legend_param <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span>legend_direction <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"vertical"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      legend_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>50<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      grid_width <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>6<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      grid_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>50<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"cm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Expression"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    Heatmap<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #ebedf0; font-style: italic;">,</span>
            row_names_gp <span style="color: #68affc; font-style: italic;">=</span> gpar<span style="color: #68affc; font-style: italic;">(</span>font<span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 7<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            bottom_annotation<span style="color: #68affc; font-style: italic;">=</span> ha<span style="color: #ebedf0; font-style: italic;">,</span>
            border_gp <span style="color: #68affc; font-style: italic;">=</span> gpar<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">col</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">row_title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"DEGs"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            row_title_side <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"left"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            show_column_names <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #ebedf0; font-style: italic;">,</span>
            heatmap_legend_param <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span>legend_direction <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"vertical"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        legend_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>50<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        grid_width <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>6<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        grid_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>50<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"cm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        <span style="color: #ebedf0; font-style: italic;">title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Expression"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>

<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> FDR<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Reading file 
  <span style="color: #ebedf0; font-style: italic;">DEG_table</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">data.frame</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">read_tsv</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Removing /// from some genes
  <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"///.*"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span>
  # Extracting Halmark pathway with 50 gene sets 
  H <span style="color: #68affc; font-style: italic;"><-</span> msigdbr<span style="color: #68affc; font-style: italic;">(</span>species <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Homo sapiens"</span><span style="color: #ebedf0; font-style: italic;">,</span> category <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"H"</span><span style="color: #68affc; font-style: italic;">)</span>
  H.symbol.ls <span style="color: #68affc; font-style: italic;"><-</span> H <span style="color: #68affc; font-style: italic;">%>%</span> 
    select<span style="color: #68affc; font-style: italic;">(</span>gs_name<span style="color: #ebedf0; font-style: italic;">,</span> gene_symbol<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    group_by<span style="color: #68affc; font-style: italic;">(</span>gs_name<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    summarise<span style="color: #68affc; font-style: italic;">(</span>all.genes <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span>unique<span style="color: #68affc; font-style: italic;">(</span>gene_symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    deframe<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  # Just gene names and logFC
  FC <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">DEG_table</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>3<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  
  ##format for gsea 
  FC.vec <span style="color: #68affc; font-style: italic;"><-</span> FC<span style="color: #68affc; font-style: italic;">$</span>zSco
  <span style="color: #ebedf0; font-style: italic;">names</span><span style="color: #68affc; font-style: italic;">(</span>FC.vec<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> FC<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol
  #Run GSEA
  gsea.H <span style="color: #68affc; font-style: italic;"><-</span> fgseaSimple<span style="color: #68affc; font-style: italic;">(</span>pathways <span style="color: #68affc; font-style: italic;">=</span> H.symbol.ls<span style="color: #ebedf0; font-style: italic;">,</span>
                        stats <span style="color: #68affc; font-style: italic;">=</span> FC.vec<span style="color: #ebedf0; font-style: italic;">,</span>
                        scoreType <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"std"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        nperm<span style="color: #68affc; font-style: italic;">=</span>1000<span style="color: #68affc; font-style: italic;">)</span>

  <span style="color: #ebedf0; font-style: italic;">my_pal</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #1B9E77; font-style: italic; padding: 2px;">#1B9E77</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #7570B3; font-style: italic; padding: 2px;">#7570B3</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E7298A; font-style: italic; padding: 2px;">#E7298A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #66A61E; font-style: italic; padding: 2px;">#66A61E</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #E6AB02; font-style: italic; padding: 2px;">#E6AB02</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #A6761D; font-style: italic; padding: 2px;">#A6761D</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #666666; font-style: italic; padding: 2px;">#666666</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span><span style="background-color: #9A7D0A; font-style: italic; padding: 2px;">#9A7D0A</span><span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Remove prefixes
  gsea.H<span style="color: #68affc; font-style: italic;">$</span>pathway <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"HALLMARK_"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> gsea.H<span style="color: #68affc; font-style: italic;">$</span>pathway<span style="color: #68affc; font-style: italic;">)</span>
  gsea.H<span style="color: #68affc; font-style: italic;">$</span>pathway <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">gsub</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"_"</span><span style="color: #ebedf0; font-style: italic;">,</span>" "<span style="color: #ebedf0; font-style: italic;">,</span> gsea.H<span style="color: #68affc; font-style: italic;">$</span>pathway<span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the Significance based on FDR and NES
  gsea.H <span style="color: #68affc; font-style: italic;"><-</span> gsea.H <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span>Significance <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificance"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span>Significance <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>padj <<span style="color: #68affc; font-style: italic;">=</span> FDR <span style="color: #68affc; font-style: italic;">&</span> NES<span style="color: #68affc; font-style: italic;"> ></span> 0<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> Significance<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    <span style="color: #ebedf0; font-style: italic;">mutate</span><span style="color: #68affc; font-style: italic;">(</span>Significance <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>padj <<span style="color: #68affc; font-style: italic;">=</span> FDR <span style="color: #68affc; font-style: italic;">&</span> NES < 0<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> Significance<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  gsea.H <span style="color: #68affc; font-style: italic;"><-</span> gsea.H<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">which</span><span style="color: #68affc; font-style: italic;">(</span>gsea.H<span style="color: #68affc; font-style: italic;">$</span>Significance <span style="color: #68affc; font-style: italic;">!</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificance"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # Plotting the result
  gsea.H <span style="color: #68affc; font-style: italic;">%>%</span> 
    ggplot<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">reorder</span><span style="color: #68affc; font-style: italic;">(</span>pathway<span style="color: #ebedf0; font-style: italic;">,</span> NES<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               y<span style="color: #68affc; font-style: italic;">=</span>NES<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    geom_col<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">width</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">aes</span><span style="color: #68affc; font-style: italic;">(</span>color<span style="color: #68affc; font-style: italic;">=</span> Significance<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">fill</span> <span style="color: #68affc; font-style: italic;">=</span> Significance<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">x</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Gene set'</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">y</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Gene set'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme_classic</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_color_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>"blue"<span style="color: #ebedf0; font-style: italic;">,</span> "red"<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">scale_fill_manual</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">values</span><span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span>"blue"<span style="color: #ebedf0; font-style: italic;">,</span> "red"<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    coord_flip<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">theme</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">axis.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.text.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 9<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">plot.subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">colour</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">hjust</span> <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.y</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">axis.title.x</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">angle</span> <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          <span style="color: #ebedf0; font-style: italic;">legend.text</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
          <span style="color: #ebedf0; font-style: italic;">legend.title</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">element_text</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">size </span><span style="color: #68affc; font-style: italic;">=</span> 20<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">family</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">+</span>
    <span style="color: #ebedf0; font-style: italic;">labs</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">subtitle</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">paste0</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSEA - "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span> <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

####################################### Running all functions ###############################################

# Downloading GEO 
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
# Reading GEO <span style="color: #ebedf0; font-style: italic;">matrix</span> into R environment
<span style="color: #ebedf0; font-style: italic;">GSE11121</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ReadGEO</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSE25055</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ReadGEO</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
GSE25065 <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ReadGEO</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
GSE7390 <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">ReadGEO</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
# Preparing <span style="color: #ebedf0; font-style: italic;">phenotype</span> for all 4 GEO 
<span style="color: #ebedf0; font-style: italic;">Makephenotype</span> <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
              <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Box plot for each <span style="color: #ebedf0; font-style: italic;">matrix</span>
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA plot for each <span style="color: #ebedf0; font-style: italic;">matrix</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Normalization for each <span style="color: #ebedf0; font-style: italic;">matrix</span>
<span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE11121</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25055</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">VSNQuantilNorm</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #68affc; font-style: italic;">)</span>

# Box and PCA after normalization for some <span style="color: #ebedf0; font-style: italic;">matrix</span>
<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeBoxPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Merging studies without batch correction <span style="color: #68affc; font-style: italic;">(</span>just for comparison<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">merge_studies</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">Mergestudies</span><span style="color: #68affc; font-style: italic;">(</span>list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA before batch effect 
# Important note : studies should match <span style="color: #ebedf0; font-style: italic;">projname</span>  
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Batch effect correction
corbatch <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">StudyBatchEffect</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA after batch effect 
# Important note : studies should match <span style="color: #ebedf0; font-style: italic;">projname</span>  
<span style="color: #ebedf0; font-style: italic;">MakePCA</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOmatrix</span> <span style="color: #68affc; font-style: italic;">=</span> corbatch<span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>




# Density plot before batch effect correction
<span style="color: #ebedf0; font-style: italic;">MakeDensityPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSE25055</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                              <span style="color: #ebedf0; font-style: italic;"> GSE11121</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                              <span style="color: #ebedf0; font-style: italic;"> GSE25065</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;"> GSE7390</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>


# Density plot after batch effect correction
<span style="color: #ebedf0; font-style: italic;">MakeDensityPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> corbatch<span style="color: #ebedf0; font-style: italic;">,</span> 
                <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSE25055</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                              <span style="color: #ebedf0; font-style: italic;"> GSE11121</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                              <span style="color: #ebedf0; font-style: italic;"> GSE25065</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;"> GSE7390</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# MDS plot before batch effect correction
# Important note : studies should match <span style="color: #ebedf0; font-style: italic;">projname</span>  
<span style="color: #ebedf0; font-style: italic;">MakeMDSPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            n<span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span>  4<span style="color: #68affc; font-style: italic;">)</span>


# MDS plot after batch effect correction
# Important note : studies should match <span style="color: #ebedf0; font-style: italic;">projname</span>  
<span style="color: #ebedf0; font-style: italic;">MakeMDSPlot</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> corbatch<span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            n<span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span>  4<span style="color: #68affc; font-style: italic;">)</span>

# Cohran Q test 
<span style="color: #ebedf0; font-style: italic;">cohranqtest</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #ebedf0; font-style: italic;">CochranQTest</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span>GSE11121<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;">GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
# QQ plot of Cohran Q test 
MakeQQPlot<span style="color: #68affc; font-style: italic;">(</span>cohranq <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">cohranqtest</span><span style="color: #ebedf0; font-style: italic;">,</span> n<span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span>  4<span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">FEMREMAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">studies </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
               model <span style="color: #68affc; font-style: italic;">=</span> "REM"<span style="color: #ebedf0; font-style: italic;">,</span>
               <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
               nperm <span style="color: #68affc; font-style: italic;">=</span> 50<span style="color: #68affc; font-style: italic;">)</span>


volcano_GSE11121 <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                                pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                                nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

volcano_GSE7390 <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                               pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                               nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                               <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

volcano_GSE25065 <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                                pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                                nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

volcano_GSE25055 <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                                pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                                nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>
# Combination
volcano_combination <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                                pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                                nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                                <span style="color: #ebedf0; font-style: italic;">voltype</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeVenna</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">common</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">c</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;"> normalized_GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">normalized_GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>

# Combination 
<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>
# Sorted grade
<span style="color: #ebedf0; font-style: italic;">MakeHeatmap</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #ebedf0; font-style: italic;">merge_studies</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">ntop </span><span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            <span style="color: #ebedf0; font-style: italic;">sorted </span><span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>

# Combination
<span style="color: #ebedf0; font-style: italic;">GSEAAnalysis</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE11121</span><span style="color: #ebedf0; font-style: italic;">,</span>
                   <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">GSE25055</span><span style="color: #ebedf0; font-style: italic;">,</span>
                   <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE25065</span><span style="color: #ebedf0; font-style: italic;">,</span>
                   <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

<span style="color: #ebedf0; font-style: italic;">Makenetworkanalyst</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">matrix</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;"> GSE7390</span><span style="color: #ebedf0; font-style: italic;">,</span>
                   <span style="color: #ebedf0; font-style: italic;">projname</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">compare</span>  <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   <span style="color: #ebedf0; font-style: italic;">groups</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #ebedf0; font-style: italic;">list</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">grade1 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">grade3 </span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>




	    </code></pre>
	</section>

	<footer class="footer">
	    <p>&copy; 2023 Mohammad Reza Mohajeri. All rights reserved.</p>
	</footer>
</body>
</html>
