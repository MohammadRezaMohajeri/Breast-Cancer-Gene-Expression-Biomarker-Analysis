<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>R Code <br> For 4 Datasets (Meta-analysis)</title>
	<style>

		body {
			background-color: #12243d; /* Cobalt color code */

		}
		
				
		/* CSS Styles */
		/* To highlight different parts of the text in red<span style="color: #ebedf0; font-style: italic;">,</span> green<span style="color: #ebedf0; font-style: italic;">,</span> and blue<span style="color: #ebedf0; font-style: italic;">,</span> you can use the <span> element and apply CSS styles to it */ 
		
		.orange-text {
			color: orange;
			font-weight: bold;
		}
		.dark-yellow-text {
			color: hsl(50<span style="color: #ebedf0; font-style: italic;">,</span> 100%<span style="color: #ebedf0; font-style: italic;">,</span> 30%); /* Adjust the hue and saturation values as needed */
			font-weight: bold;
		}
		.brown-text {
			color: hsl(30<span style="color: #ebedf0; font-style: italic;">,</span> 100%<span style="color: #ebedf0; font-style: italic;">,</span> 30%); /* Adjust the hue and saturation values as needed */
			font-weight: bold;
		}
		.green-text {
			color: green;
			font-weight: bold;
		}
		.purple-text {
			color: purple;
			font-weight: bold;
		}
		.blue-text {
			color: blue;
			font-weight: bold;
		}


		/* Header Styles */
		header {
			background-color: #274f4f;
			color: white;
			text-align: center;
			padding: 5px;
		}

		h1 {
			color: white; /* Adjust the font color as desired */
			font-size: 30px; /* Adjust the font size as desired */
			font-weight: bold; /* Add font weight as desired */
			text-align: center; /* Center the header title */
			padding: 0px; /* Add padding around the header title */
			margin-bottom: 20px; /* Add margin below the header title */
		}
		
		hr {
			width: 100%; /* Adjust the width as desired */
		}
		
		/* Adjust font size for the code block */
		pre code {
		        font-size: 17px; /* Adjust the font size as desired */
	        }
		
		/* Footer Styles */
		.footer {
		        background-color: #333;
		        color: #fff;
		        padding: 10px;
		        text-align: center;
		        position: fixed;
		        left: 0;
		        bottom: 0;
		        width: 100%;
		}
	</style>
	
</head>
<body>
	<header>
		<h1>R Code <br> For 4 Datasets (Meta-analysis)</h1>
	</header>

	<section>
		
<pre><code>
		
<span style="color: #05c6e3; font-style: italic;">################################################################# "Package Installation" #################################################################</span>
<span style="color: #05c6e3; font-style: italic;">#################################### Uncomment the following lines if any of the packages are not already installed or need to be reinstalled.############</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager packages</span>
<span style="color: #05c6e3; font-style: italic;"># Install required Bioconductor packages</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("sva", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("GeneMeta", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("ComplexHeatmap", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("fgsea", force = TRUE)</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("clusterProfiler", force = TRUE)</span>
			
<span style="color: #05c6e3; font-style: italic;"># Other packages</span>
<span style="color: #05c6e3; font-style: italic;"># Install required CRAN packages:</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("RColorBrewer")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("msigdbr")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggpubr")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("reshape2")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("caret")</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("rgl")</span>

<span style="color: #05c6e3; font-style: italic;"># sva package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "sva" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("sva")</span>

<span style="color: #05c6e3; font-style: italic;"># VSN package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "vsn" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("vsn")</span>

<span style="color: #05c6e3; font-style: italic;"># tidyverse package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("tidyverse")</span>

<span style="color: #05c6e3; font-style: italic;"># GEOquery package installation</span>
<span style="color: #05c6e3; font-style: italic;"># Install "GEOquery" package using BiocManager</span>
<span style="color: #05c6e3; font-style: italic;"># if (!require("BiocManager", quietly = TRUE))</span>
<span style="color: #05c6e3; font-style: italic;">#   install.packages("BiocManager")</span>
<span style="color: #05c6e3; font-style: italic;"># BiocManager::install("GEOquery")</span>

<span style="color: #05c6e3; font-style: italic;"># limma package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("limma")</span>

<span style="color: #05c6e3; font-style: italic;"># plotly package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("plotly")</span>

<span style="color: #05c6e3; font-style: italic;"># ggvenn package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggvenn")</span>

<span style="color: #05c6e3; font-style: italic;"># ggpubr package installation</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("ggpubr")</span>

<span style="color: #05c6e3; font-style: italic;"># rgl package installation</span>
<span style="color: #05c6e3; font-style: italic;"># For rgl installation, require remotes package first</span>
<span style="color: #05c6e3; font-style: italic;"># install.packages("remotes")</span>
<span style="color: #05c6e3; font-style: italic;"># require(remotes)</span>
<span style="color: #05c6e3; font-style: italic;"># remotes::install_github("dmurdoch/rgl")</span>


<span style="color: #05c6e3; font-style: italic;"># Package Loading</span>
<span style="color: #05c6e3; font-style: italic;"># Load the required packages for data analysis and visualization.</span>
			
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">tidyverse</span><span style="color: #68affc; font-style: italic;">)</span>       <span style="color: #05c6e3; font-style: italic;"># Package for comprehensive data manipulation and visualization, including dplyr, ggplot2, and other useful packages</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GEOquery</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for accessing and retrieving gene expression data from the Gene Expression Omnibus (GEO) database</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">reshape2</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for reshaping data from wide to long format and vice versa, useful for data preprocessing</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">caret</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for machine learning and predictive modeling, providing a unified interface for various algorithms and performance evaluation</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GeneMeta</span><span style="color: #68affc; font-style: italic;">)</span>        <span style="color: #05c6e3; font-style: italic;"># Package for meta-analysis of gene expression data, allowing combining results from multiple studies</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">limma</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for analyzing microarray data using linear models, including differential expression analysis</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">rgl</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for creating interactive 3D visualizations, useful for exploring complex data structures</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">sva</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for surrogate variable analysis, used to identify and adjust for unwanted variation in high-dimensional datasets</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">plotly</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating interactive and dynamic plots, including scatter plots, bar plots, and more</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ggvenn</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating Venn diagrams using ggplot2, useful for visualizing set relationships</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ggpubr</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for creating publication-ready plots using ggplot2, providing additional customization options</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">ComplexHeatmap</span><span style="color: #68affc; font-style: italic;">)</span>  <span style="color: #05c6e3; font-style: italic;"># Package for creating complex heatmaps, allowing visualization of multiple layers of data and annotations</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">RColorBrewer</span><span style="color: #68affc; font-style: italic;">)</span>    <span style="color: #05c6e3; font-style: italic;"># Package for providing color palettes suitable for data visualization</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">msigdbr</span><span style="color: #68affc; font-style: italic;">)</span>         <span style="color: #05c6e3; font-style: italic;"># Package for accessing and using the Molecular Signatures Database (MSigDB) for gene set enrichment analysis</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">fgsea</span><span style="color: #68affc; font-style: italic;">)</span>           <span style="color: #05c6e3; font-style: italic;"># Package for performing gene set enrichment analysis (GSEA) using fast gene set testing algorithms</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">locfit</span><span style="color: #68affc; font-style: italic;">)</span>          <span style="color: #05c6e3; font-style: italic;"># Package for local regression modeling, useful for fitting flexible curves to data</span>
<span style="color: #f79502; font-style: italic;">require</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">vsn</span><span style="color: #68affc; font-style: italic;">)</span>             <span style="color: #05c6e3; font-style: italic;"># Package for variance stabilization and normalization, specifically for microarray data analysis</span>
 
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span> <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Create a folder
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Increase memory
  Sys.setenv<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"VROOM_CONNECTION_SIZE"</span><span style="color: #68affc; font-style: italic;">=</span>131072<span style="color: #68affc; font-style: italic;">*</span>10<span style="color: #68affc; font-style: italic;">)</span>
  #Download dataset
  gset <span style="color: #68affc; font-style: italic;"><-</span> getGEO<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> GSEMatrix <span style="color: #68affc; font-style: italic;">=</span>TRUE<span style="color: #ebedf0; font-style: italic;">,</span> AnnotGPL <span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #ebedf0; font-style: italic;">,</span>
                 destdir <span style="color: #68affc; font-style: italic;">=</span> paste0<span style="color: #68affc; font-style: italic;">(</span>getwd<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">!</span>is.null<span style="color: #68affc; font-style: italic;">(</span>gset<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    # Extracting matrix<span style="color: #ebedf0; font-style: italic;">,</span> phenotype<span style="color: #ebedf0; font-style: italic;">,</span> and annotation
    matrix <span style="color: #68affc; font-style: italic;"><-</span> gset<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_matrix.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span>assayData<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>"exprs"<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
    # Reverse log2 transformation if the matrix is transformed
    qx <span style="color: #68affc; font-style: italic;"><-</span> as.numeric<span style="color: #68affc; font-style: italic;">(</span>quantile<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span> c<span style="color: #68affc; font-style: italic;">(</span>0.<span style="color: #ebedf0; font-style: italic;">,</span> 0.25<span style="color: #ebedf0; font-style: italic;">,</span> 0.5<span style="color: #ebedf0; font-style: italic;">,</span> 0.75<span style="color: #ebedf0; font-style: italic;">,</span> 0.99<span style="color: #ebedf0; font-style: italic;">,</span> 1.0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> na.rm<span style="color: #68affc; font-style: italic;">=</span>T<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    LogC <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #68affc; font-style: italic;">(</span>qx<span style="color: #68affc; font-style: italic;">[</span>5<span style="color: #68affc; font-style: italic;">]</span> > 100<span style="color: #68affc; font-style: italic;">)</span> || <span style="color: #68affc; font-style: italic;">(</span>qx<span style="color: #68affc; font-style: italic;">[</span>6<span style="color: #68affc; font-style: italic;">]</span>-qx<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> > 50 <span style="color: #68affc; font-style: italic;">&</span><span style="color: #68affc; font-style: italic;">&</span> qx<span style="color: #68affc; font-style: italic;">[</span>2<span style="color: #68affc; font-style: italic;">]</span> > 0<span style="color: #68affc; font-style: italic;">)</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">!</span>LogC<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      matrix <span style="color: #68affc; font-style: italic;"><-</span> 2^<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> matrix<span style="color: #68affc; font-style: italic;">)</span>
    colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>

    phenotype <span style="color: #68affc; font-style: italic;"><-</span> gset<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_matrix.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span>phenoData<span style="color: #68affc; font-style: italic;">@</span>data
    phenotype <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>phenotype<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> phenotype<span style="color: #68affc; font-style: italic;">)</span>
    colnames<span style="color: #68affc; font-style: italic;">(</span>phenotype<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>
    annot <span style="color: #68affc; font-style: italic;"><-</span> gset<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_series_matrix.txt.gz"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">@</span>featureData<span style="color: #68affc; font-style: italic;">@</span>data
    # Writing the extracted variables
    write.csv<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"matrix.csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> quote <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #ebedf0; font-style: italic;">,</span> row.names <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
    write_tsv<span style="color: #68affc; font-style: italic;">(</span>phenotype<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"phenotype.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    write_tsv<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">GSEname</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    # Removing variables
    rm<span style="color: #68affc; font-style: italic;">(</span>gset<span style="color: #ebedf0; font-style: italic;">,</span> matrix<span style="color: #ebedf0; font-style: italic;">,</span> phenotype<span style="color: #ebedf0; font-style: italic;">,</span> annot<span style="color: #68affc; font-style: italic;">)</span>
    message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Datatset is ready to analyse. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>

ReadGEO <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Reading matrix file
  matrix <span style="color: #68affc; font-style: italic;"><-</span> read_csv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"matrix.csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  matrix <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>


MakePhenotype <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Preparing the phenotype for all GSE files
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Phenotype"</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  pheno <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    phenotype <span style="color: #68affc; font-style: italic;"><-</span> read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"phenotype.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    phenotype <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>phenotype<span style="color: #68affc; font-style: italic;">)</span>
    rownames<span style="color: #68affc; font-style: italic;">(</span>phenotype<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> phenotype<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    phenotype <span style="color: #68affc; font-style: italic;"><-</span> phenotype<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
    pheno<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> phenotype
  <span style="color: #68affc; font-style: italic;">}</span>
  # Choosing either subtype or grade
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>compare <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"subtype"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    pheno2 <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    for <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
      phecoln <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"pam50"</span><span style="color: #ebedf0; font-style: italic;">,</span> pheno<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
     <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>length<span style="color: #68affc; font-style: italic;">(</span>phecoln<span style="color: #68affc; font-style: italic;">)</span> > 0<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
        pheno1 <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span>phecoln<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        colnames<span style="color: #68affc; font-style: italic;">(</span>pheno1<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"subtype"</span>
        pheno1<span style="color: #68affc; font-style: italic;">$</span>subtype <span style="color: #68affc; font-style: italic;"><-</span> gsub<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"pam50.+:"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> pheno1<span style="color: #68affc; font-style: italic;">$</span>subtype<span style="color: #68affc; font-style: italic;">)</span>
        pheno1 <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> pheno1<span style="color: #68affc; font-style: italic;">)</span>
        colnames<span style="color: #68affc; font-style: italic;">(</span>pheno1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Sample"</span>
        pheno2<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>names<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> pheno1
      <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    pheno3 <span style="color: #68affc; font-style: italic;"><-</span> do.call<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #ebedf0; font-style: italic;">,</span> pheno2<span style="color: #68affc; font-style: italic;">)</span>
    rownames<span style="color: #68affc; font-style: italic;">(</span>pheno3<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
    
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span><span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>compare <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    pheno2 <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    for <span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
      gradecoln <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"grade:"</span><span style="color: #ebedf0; font-style: italic;">,</span> pheno<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
     <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>length<span style="color: #68affc; font-style: italic;">(</span>gradecoln<span style="color: #68affc; font-style: italic;">)</span> > 0<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
        pheno1 <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span>gradecoln<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        colnames<span style="color: #68affc; font-style: italic;">(</span>pheno1<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span>
        pheno1<span style="color: #68affc; font-style: italic;">$</span>grade <span style="color: #68affc; font-style: italic;"><-</span> gsub<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"grade:|grade: |B-R grade: "</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> pheno1<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span>
        pheno1<span style="color: #68affc; font-style: italic;">$</span>grade <span style="color: #68affc; font-style: italic;"><-</span> gsub<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"=.+"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> pheno1<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span>
        greek <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"III"</span><span style="color: #ebedf0; font-style: italic;">,</span> pheno1<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span>
       <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>length<span style="color: #68affc; font-style: italic;">(</span>greek<span style="color: #68affc; font-style: italic;">)</span> > 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
          one <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>factor<span style="color: #68affc; font-style: italic;">(</span>pheno1<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"I"</span><span style="color: #68affc; font-style: italic;">)</span>
          two <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>factor<span style="color: #68affc; font-style: italic;">(</span>pheno1<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"II"</span><span style="color: #68affc; font-style: italic;">)</span>
          three <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>factor<span style="color: #68affc; font-style: italic;">(</span>pheno1<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"III"</span><span style="color: #68affc; font-style: italic;">)</span>
          pheno1<span style="color: #68affc; font-style: italic;">[</span>one<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"1"</span>
          pheno1<span style="color: #68affc; font-style: italic;">[</span>two<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"2"</span>
          pheno1<span style="color: #68affc; font-style: italic;">[</span>three<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"3"</span>
        <span style="color: #68affc; font-style: italic;">}</span>
        pheno1 <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> pheno1<span style="color: #68affc; font-style: italic;">)</span>
        colnames<span style="color: #68affc; font-style: italic;">(</span>pheno1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Sample"</span>
        pheno2<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>names<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> pheno1
      <span style="color: #68affc; font-style: italic;">}</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    pheno3 <span style="color: #68affc; font-style: italic;"><-</span> do.call<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #ebedf0; font-style: italic;">,</span> pheno2<span style="color: #68affc; font-style: italic;">)</span>
    rownames<span style="color: #68affc; font-style: italic;">(</span>pheno3<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
  <span style="color: #68affc; font-style: italic;">}</span>
  # Writing phenotype file
  write.csv<span style="color: #68affc; font-style: italic;">(</span>pheno3<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Phenotype"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span>compare<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> row.names <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #ebedf0; font-style: italic;">,</span> quote <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Phenotype file is created into Phenotype folder"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>
------ <span style="color: #1B9E77; font-style: italic;">#1B9E77</span>
MakeBoxPlot <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #ebedf0; font-style: italic;">,</span>
                        projname<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Make a long format data frame
  melted <span style="color: #68affc; font-style: italic;"><-</span> melt<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #ebedf0; font-style: italic;">,</span> id.vars<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span>
  my_pal <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span>#1B9E77<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting 
  ggplot<span style="color: #68affc; font-style: italic;">(</span>data <span style="color: #68affc; font-style: italic;">=</span> melted<span style="color: #ebedf0; font-style: italic;">,</span> aes<span style="color: #68affc; font-style: italic;">(</span>x <span style="color: #68affc; font-style: italic;">=</span> variable<span style="color: #ebedf0; font-style: italic;">,</span> y <span style="color: #68affc; font-style: italic;">=</span> value<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    geom_boxplot<span style="color: #68affc; font-style: italic;">(</span>aes<span style="color: #68affc; font-style: italic;">(</span>color <span style="color: #68affc; font-style: italic;">=</span> "#45B39D"<span style="color: #ebedf0; font-style: italic;">,</span> fill<span style="color: #68affc; font-style: italic;">=</span> "#45B39D"<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> outlier.alpha <span style="color: #68affc; font-style: italic;">=</span> 0.1<span style="color: #68affc; font-style: italic;">)</span>+
    labs<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'SampleID'</span><span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Values'</span><span style="color: #68affc; font-style: italic;">)</span> +
    scale_y_continuous<span style="color: #68affc; font-style: italic;">(</span>labels <span style="color: #68affc; font-style: italic;">=</span> scales<span style="color: #68affc; font-style: italic;">::</span>comma<span style="color: #68affc; font-style: italic;">)</span> +
    theme_classic<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
    scale_color_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    scale_fill_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>paste<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> sep <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    theme<span style="color: #68affc; font-style: italic;">(</span>axis.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.text.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 6<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.text.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 12<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          plot.subtitle <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> hjust <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.title.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.title.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          legend.position<span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"none"</span><span style="color: #68affc; font-style: italic;">)</span> +
    labs<span style="color: #68affc; font-style: italic;">(</span>subtitle <span style="color: #68affc; font-style: italic;">=</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Box plot - "</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

MakePCA <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #ebedf0; font-style: italic;">,</span>
                    studies <span style="color: #68affc; font-style: italic;">=</span> NULL<span style="color: #ebedf0; font-style: italic;">,</span>
                    projname<span style="color: #ebedf0; font-style: italic;">,</span>
                    compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Plots"</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix file
  set.seed<span style="color: #68affc; font-style: italic;">(</span>123<span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    rownames<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> GEOmatrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    GEOmatrix <span style="color: #68affc; font-style: italic;"><-</span> GEOmatrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Reading phenotype file
  pheno <span style="color: #68affc; font-style: italic;"><-</span> read_csv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  pheno <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">)</span>
  paired_pheno <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>Sample <span style="color: #68affc; font-style: italic;">%in%</span> colnames<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  pheno <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>paired_pheno<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # PCA analysis
  GEOmatrix <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>t<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  pca_df <span style="color: #68affc; font-style: italic;"><-</span> scale<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span>
  pca <span style="color: #68affc; font-style: italic;"><-</span> preProcess<span style="color: #68affc; font-style: italic;">(</span>x <span style="color: #68affc; font-style: italic;">=</span> pca_df<span style="color: #ebedf0; font-style: italic;">,</span> method <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'pca'</span><span style="color: #ebedf0; font-style: italic;">,</span> pcaComp <span style="color: #68affc; font-style: italic;">=</span> 3<span style="color: #68affc; font-style: italic;">)</span>
  pca_df <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>predict<span style="color: #68affc; font-style: italic;">(</span>pca<span style="color: #ebedf0; font-style: italic;">,</span> pca_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  pca_df <span style="color: #68affc; font-style: italic;"><-</span> pca_df<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>pca_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  pheno <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>Sample<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  na_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>is.na<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>length<span style="color: #68affc; font-style: italic;">(</span>na_row<span style="color: #68affc; font-style: italic;">)</span> > 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    na_samp <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>na_row<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    na_colm <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>pca_df<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> na_samp<span style="color: #68affc; font-style: italic;">)</span>
    pheno <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>-na_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    pca_df <span style="color: #68affc; font-style: italic;"><-</span> pca_df<span style="color: #68affc; font-style: italic;">[</span>-na_colm<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  pca_df<span style="color: #68affc; font-style: italic;">$</span>Class <span style="color: #68affc; font-style: italic;"><-</span> factor<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span>
  my_pal <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span>#7570B3<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E7298A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#66A61E<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E6AB02<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#A6761D<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#666666<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#9A7D0A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # 2D plot for multi-studies
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>length<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #68affc; font-style: italic;">)</span> > 1<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    pca_rownames <span style="color: #68affc; font-style: italic;"><-</span> rownames<span style="color: #68affc; font-style: italic;">(</span>pca_df<span style="color: #68affc; font-style: italic;">)</span>
    study_list <span style="color: #68affc; font-style: italic;"><-</span> studies
    batch <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
      l <span style="color: #68affc; font-style: italic;"><-</span> length<span style="color: #68affc; font-style: italic;">(</span>which<span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> pca_rownames<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      batch<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> rep<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> l<span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    batch <span style="color: #68affc; font-style: italic;"><-</span> unlist<span style="color: #68affc; font-style: italic;">(</span>batch<span style="color: #68affc; font-style: italic;">)</span>
    pca_df<span style="color: #68affc; font-style: italic;">$</span>Studies <span style="color: #68affc; font-style: italic;"><-</span> factor<span style="color: #68affc; font-style: italic;">(</span>batch<span style="color: #68affc; font-style: italic;">)</span>
    ggplot<span style="color: #68affc; font-style: italic;">(</span>data <span style="color: #68affc; font-style: italic;">=</span> pca_df<span style="color: #ebedf0; font-style: italic;">,</span> aes<span style="color: #68affc; font-style: italic;">(</span>x <span style="color: #68affc; font-style: italic;">=</span> PC1<span style="color: #ebedf0; font-style: italic;">,</span> y <span style="color: #68affc; font-style: italic;">=</span> PC2<span style="color: #ebedf0; font-style: italic;">,</span> color <span style="color: #68affc; font-style: italic;">=</span> Class<span style="color: #ebedf0; font-style: italic;">,</span> fill <span style="color: #68affc; font-style: italic;">=</span> Class<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      geom_point<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 3<span style="color: #ebedf0; font-style: italic;">,</span> aes<span style="color: #68affc; font-style: italic;">(</span> shape<span style="color: #68affc; font-style: italic;">=</span> Studies<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      scale_color_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      scale_fill_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>paste<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> sep <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      theme_classic<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
      theme<span style="color: #68affc; font-style: italic;">(</span>axis.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.text.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.text.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            plot.subtitle <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> hjust <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.title.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.title.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            legend.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span> family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            legend.title <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 20<span style="color: #ebedf0; font-style: italic;">,</span> family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      labs<span style="color: #68affc; font-style: italic;">(</span>subtitle <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"PCA plot- Merged studies"</span><span style="color: #68affc; font-style: italic;">)</span>
    
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    
    # Plotting
    plot3d<span style="color: #68affc; font-style: italic;">(</span> 
      x<span style="color: #68affc; font-style: italic;">=</span>pca_df<span style="color: #68affc; font-style: italic;">$</span>PC1<span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">=</span>pca_df<span style="color: #68affc; font-style: italic;">$</span>PC2<span style="color: #ebedf0; font-style: italic;">,</span> z<span style="color: #68affc; font-style: italic;">=</span>pca_df<span style="color: #68affc; font-style: italic;">$</span>PC3<span style="color: #ebedf0; font-style: italic;">,</span> 
      col <span style="color: #68affc; font-style: italic;">=</span> my_pal<span style="color: #68affc; font-style: italic;">[</span>pca_df<span style="color: #68affc; font-style: italic;">$</span>Class<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>
      type <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'s'</span><span style="color: #ebedf0; font-style: italic;">,</span> 
      radius <span style="color: #68affc; font-style: italic;">=</span> 4<span style="color: #ebedf0; font-style: italic;">,</span>
      size <span style="color: #68affc; font-style: italic;">=</span> 3<span style="color: #ebedf0; font-style: italic;">,</span>
      xlab<span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC1"</span><span style="color: #ebedf0; font-style: italic;">,</span> ylab<span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC2"</span><span style="color: #ebedf0; font-style: italic;">,</span> zlab<span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"PC3"</span><span style="color: #68affc; font-style: italic;">)</span>
    # Legend
    legend3d<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"topright"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             legend <span style="color: #68affc; font-style: italic;">=</span> levels<span style="color: #68affc; font-style: italic;">(</span>factor<span style="color: #68affc; font-style: italic;">(</span>pca_df<span style="color: #68affc; font-style: italic;">$</span>Class<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
             title <span style="color: #68affc; font-style: italic;">=</span> compare<span style="color: #ebedf0; font-style: italic;">,</span>
             pch <span style="color: #68affc; font-style: italic;">=</span> 16<span style="color: #ebedf0; font-style: italic;">,</span>
             col <span style="color: #68affc; font-style: italic;">=</span> my_pal<span style="color: #ebedf0; font-style: italic;">,</span> 
             cex<span style="color: #68affc; font-style: italic;">=</span>1.2<span style="color: #ebedf0; font-style: italic;">,</span> 
             inset<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>0.02<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    
    # Saving the plot into Plots folder
    projname <span style="color: #68affc; font-style: italic;"><-</span> paste0<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #ebedf0; font-style: italic;">,</span> collapse <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"-"</span><span style="color: #68affc; font-style: italic;">)</span> 
    htmlwidgets<span style="color: #68affc; font-style: italic;">::</span>saveWidget<span style="color: #68affc; font-style: italic;">(</span>rglwidget<span style="color: #68affc; font-style: italic;">(</span>width <span style="color: #68affc; font-style: italic;">=</span> 800<span style="color: #ebedf0; font-style: italic;">,</span> height <span style="color: #68affc; font-style: italic;">=</span> 800<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                            file <span style="color: #68affc; font-style: italic;">=</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Plots/PCA_"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".html"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            libdir <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"libs"</span><span style="color: #ebedf0; font-style: italic;">,</span> title <span style="color: #68affc; font-style: italic;">=</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"PCA - "</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            selfcontained <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>

VSNQuantilNorm <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  set.seed<span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix
  rownames<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> GEOmatrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
  GEOmatrix <span style="color: #68affc; font-style: italic;"><-</span> GEOmatrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
  # VSN normalization
  vsnnorm <span style="color: #68affc; font-style: italic;"><-</span> normalizeVSN<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span>
  # Quantile normalization
  df_rank <span style="color: #68affc; font-style: italic;"><-</span> apply<span style="color: #68affc; font-style: italic;">(</span>vsnnorm<span style="color: #ebedf0; font-style: italic;">,</span>2<span style="color: #ebedf0; font-style: italic;">,</span>rank<span style="color: #ebedf0; font-style: italic;">,</span>ties.method<span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"min"</span><span style="color: #68affc; font-style: italic;">)</span>
  df_sorted <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>apply<span style="color: #68affc; font-style: italic;">(</span>vsnnorm<span style="color: #ebedf0; font-style: italic;">,</span> 2<span style="color: #ebedf0; font-style: italic;">,</span> sort<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  df_mean <span style="color: #68affc; font-style: italic;"><-</span> apply<span style="color: #68affc; font-style: italic;">(</span>df_sorted<span style="color: #ebedf0; font-style: italic;">,</span> 1<span style="color: #ebedf0; font-style: italic;">,</span> mean<span style="color: #68affc; font-style: italic;">)</span>
  index_to_mean <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>my_index<span style="color: #ebedf0; font-style: italic;">,</span> my_mean<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    return<span style="color: #68affc; font-style: italic;">(</span>my_mean<span style="color: #68affc; font-style: italic;">[</span>my_index<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  norm_final <span style="color: #68affc; font-style: italic;"><-</span> apply<span style="color: #68affc; font-style: italic;">(</span>df_rank<span style="color: #ebedf0; font-style: italic;">,</span> 2<span style="color: #ebedf0; font-style: italic;">,</span> index_to_mean<span style="color: #ebedf0; font-style: italic;">,</span> my_mean<span style="color: #68affc; font-style: italic;">=</span>df_mean<span style="color: #68affc; font-style: italic;">)</span>
  norm_final <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>norm_final<span style="color: #68affc; font-style: italic;">)</span>
  norm_finall <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>sapply<span style="color: #68affc; font-style: italic;">(</span>norm_final<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">)</span> as.numeric<span style="color: #68affc; font-style: italic;">(</span>as.character<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                    check.names<span style="color: #68affc; font-style: italic;">=</span>F<span style="color: #68affc; font-style: italic;">)</span>
  norm_finall <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> norm_finall<span style="color: #68affc; font-style: italic;">)</span>
  colnames<span style="color: #68affc; font-style: italic;">(</span>norm_finall<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>
  return<span style="color: #68affc; font-style: italic;">(</span>norm_finall<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

MergeStudies <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Merging two or more matrix
  study_list <span style="color: #68affc; font-style: italic;"><-</span> Reduce<span style="color: #68affc; font-style: italic;">(</span><span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">)</span> merge<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #ebedf0; font-style: italic;">,</span> all<span style="color: #68affc; font-style: italic;">=</span>TRUE<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> studies<span style="color: #68affc; font-style: italic;">)</span>
  return<span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

StudyBatchEffect <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Calculating the number of samples for each matrix
  study_list <span style="color: #68affc; font-style: italic;"><-</span> studies
  batch <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    batch<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> ncol<span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> - 1
  <span style="color: #68affc; font-style: italic;">}</span>
  batch <span style="color: #68affc; font-style: italic;"><-</span> unlist<span style="color: #68affc; font-style: italic;">(</span>batch<span style="color: #68affc; font-style: italic;">)</span>
  batch <span style="color: #68affc; font-style: italic;"><-</span> rep<span style="color: #68affc; font-style: italic;">(</span>seq_along<span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> batch<span style="color: #68affc; font-style: italic;">)</span>
  # Merging matrices
  study_list <span style="color: #68affc; font-style: italic;"><-</span> Reduce<span style="color: #68affc; font-style: italic;">(</span><span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">)</span> merge<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #ebedf0; font-style: italic;">,</span> all<span style="color: #68affc; font-style: italic;">=</span>TRUE<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> study_list<span style="color: #68affc; font-style: italic;">)</span>
  rownames<span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> study_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
  study_list <span style="color: #68affc; font-style: italic;"><-</span> study_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
  # Batch correction
  corrected_batch <span style="color: #68affc; font-style: italic;"><-</span> ComBat<span style="color: #68affc; font-style: italic;">(</span>dat<span style="color: #68affc; font-style: italic;">=</span>study_list<span style="color: #ebedf0; font-style: italic;">,</span>
                            batch<span style="color: #68affc; font-style: italic;">=</span>batch<span style="color: #ebedf0; font-style: italic;">,</span>
                            mod<span style="color: #68affc; font-style: italic;">=</span>NULL<span style="color: #ebedf0; font-style: italic;">,</span>
                            par.prior<span style="color: #68affc; font-style: italic;">=</span>TRUE<span style="color: #ebedf0; font-style: italic;">,</span> 
                            prior.plots<span style="color: #68affc; font-style: italic;">=</span>FALSE<span style="color: #68affc; font-style: italic;">)</span>
  corrected_batch <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>corrected_batch<span style="color: #68affc; font-style: italic;">)</span>
  corrected_batch <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>sapply<span style="color: #68affc; font-style: italic;">(</span>corrected_batch<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">)</span> as.numeric<span style="color: #68affc; font-style: italic;">(</span>as.character<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            check.names<span style="color: #68affc; font-style: italic;">=</span>F<span style="color: #ebedf0; font-style: italic;">,</span> row.names <span style="color: #68affc; font-style: italic;">=</span> rownames<span style="color: #68affc; font-style: italic;">(</span>corrected_batch<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  corrected_batch <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>corrected_batch<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> corrected_batch<span style="color: #68affc; font-style: italic;">)</span>
  colnames<span style="color: #68affc; font-style: italic;">(</span>corrected_batch<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span>
  return<span style="color: #68affc; font-style: italic;">(</span>corrected_batch<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

MakeDensityPlot <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span> studies<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  set.seed<span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  # Make a long format data frame
  melted <span style="color: #68affc; font-style: italic;"><-</span> melt<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span> id.vars <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the number of samples for each study 
  st <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    row_n <span style="color: #68affc; font-style: italic;"><-</span> nrow<span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    col_n <span style="color: #68affc; font-style: italic;"><-</span> ncol<span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> -1
    st<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> rep<span style="color: #68affc; font-style: italic;">(</span>names<span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> row_n<span style="color: #68affc; font-style: italic;">*</span>col_n<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  st <span style="color: #68affc; font-style: italic;"><-</span> unlist<span style="color: #68affc; font-style: italic;">(</span>st<span style="color: #68affc; font-style: italic;">)</span>
  melted<span style="color: #68affc; font-style: italic;">$</span>Studies <span style="color: #68affc; font-style: italic;"><-</span> factor<span style="color: #68affc; font-style: italic;">(</span>st<span style="color: #68affc; font-style: italic;">)</span>
  # Plotting
  my_pal <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span>#7570B3<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E7298A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#66A61E<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E6AB02<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#A6761D<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#666666<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#9A7D0A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  ggplot<span style="color: #68affc; font-style: italic;">(</span>data <span style="color: #68affc; font-style: italic;">=</span> melted<span style="color: #ebedf0; font-style: italic;">,</span> aes<span style="color: #68affc; font-style: italic;">(</span>x <span style="color: #68affc; font-style: italic;">=</span> value<span style="color: #ebedf0; font-style: italic;">,</span> color <span style="color: #68affc; font-style: italic;">=</span> Studies<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    geom_density<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 1.5<span style="color: #68affc; font-style: italic;">)</span> +
    labs<span style="color: #68affc; font-style: italic;">(</span>y<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Density'</span><span style="color: #ebedf0; font-style: italic;">,</span> x<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Value'</span><span style="color: #68affc; font-style: italic;">)</span> +
    theme_classic<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
    scale_color_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    scale_fill_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>paste<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> sep <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    theme<span style="color: #68affc; font-style: italic;">(</span>axis.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.text.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 12<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.text.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          plot.subtitle <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> hjust <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.title.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.title.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    labs<span style="color: #68affc; font-style: italic;">(</span>subtitle <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Density plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

MakeMDSPlot <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span>
                        studies<span style="color: #ebedf0; font-style: italic;">,</span>
                        projname<span style="color: #ebedf0; font-style: italic;">,</span>
                        compare<span style="color: #ebedf0; font-style: italic;">,</span> 
                        nstudies<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  set.seed<span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  matrix <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>t<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Cmpute MDS
  mds <span style="color: #68affc; font-style: italic;"><-</span> matrix <span style="color: #68affc; font-style: italic;">%>%</span>
    dist<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>          
    cmdscale<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    data.frame<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  colnames<span style="color: #68affc; font-style: italic;">(</span>mds<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Dim1"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Dim2"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Clustering
  clust <span style="color: #68affc; font-style: italic;"><-</span> kmeans<span style="color: #68affc; font-style: italic;">(</span>mds<span style="color: #ebedf0; font-style: italic;">,</span> nstudies<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">$</span>cluster <span style="color: #68affc; font-style: italic;">%>%</span>
    as.factor<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  mds <span style="color: #68affc; font-style: italic;"><-</span> mds <span style="color: #68affc; font-style: italic;">%>%</span>
    mutate<span style="color: #68affc; font-style: italic;">(</span>Clusters <span style="color: #68affc; font-style: italic;">=</span> clust<span style="color: #68affc; font-style: italic;">)</span>
  # Finding studies names
  mds_rownames <span style="color: #68affc; font-style: italic;"><-</span> rownames<span style="color: #68affc; font-style: italic;">(</span>mds<span style="color: #68affc; font-style: italic;">)</span>
  study_list <span style="color: #68affc; font-style: italic;"><-</span> studies
  batch <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    l <span style="color: #68affc; font-style: italic;"><-</span> length<span style="color: #68affc; font-style: italic;">(</span>which<span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>study_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> mds_rownames<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    batch<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> rep<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> l<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  batch <span style="color: #68affc; font-style: italic;"><-</span> unlist<span style="color: #68affc; font-style: italic;">(</span>batch<span style="color: #68affc; font-style: italic;">)</span>
  mds<span style="color: #68affc; font-style: italic;">$</span>Studies <span style="color: #68affc; font-style: italic;"><-</span> factor<span style="color: #68affc; font-style: italic;">(</span>batch<span style="color: #68affc; font-style: italic;">)</span> 
  
  # Plot and color by groups
  my_pal <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span>#7570B3<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E7298A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#66A61E<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E6AB02<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#A6761D<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#666666<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#9A7D0A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  g <span style="color: #68affc; font-style: italic;"><-</span> ggscatter<span style="color: #68affc; font-style: italic;">(</span>mds<span style="color: #ebedf0; font-style: italic;">,</span> x <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Dim1"</span><span style="color: #ebedf0; font-style: italic;">,</span> y <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Dim2"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                 label <span style="color: #68affc; font-style: italic;">=</span> rownames<span style="color: #68affc; font-style: italic;">(</span>mds<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>shape <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Studies"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                 ggtheme <span style="color: #68affc; font-style: italic;">=</span> theme_classic<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 color <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Clusters"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 palette <span style="color: #68affc; font-style: italic;">=</span> my_pal<span style="color: #ebedf0; font-style: italic;">,</span>
                 size <span style="color: #68affc; font-style: italic;">=</span> 1.5<span style="color: #ebedf0; font-style: italic;">,</span> 
                 ellipse <span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #ebedf0; font-style: italic;">,</span>
                 ellipse.type <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"convex"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                 repel <span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span>
  g + theme<span style="color: #68affc; font-style: italic;">(</span>axis.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.text.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.text.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            plot.subtitle <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> hjust <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.title.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.title.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    labs<span style="color: #68affc; font-style: italic;">(</span>subtitle <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"MDS plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

CochranQTest <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #ebedf0; font-style: italic;">,</span> groups<span style="color: #ebedf0; font-style: italic;">,</span> compare<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  set.seed<span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  # Reading matrix and phenotype
  d.adj.Split <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  var.d.adj.Split <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> studies<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    pheno <span style="color: #68affc; font-style: italic;"><-</span> read_csv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    pheno <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">)</span>
    paired_pheno <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>Sample <span style="color: #68affc; font-style: italic;">%in%</span> colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    pheno <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>paired_pheno<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    na_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>is.na<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    # Matching phenotype with samples in matrix 
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>length<span style="color: #68affc; font-style: italic;">(</span>na_row<span style="color: #68affc; font-style: italic;">)</span> > 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      na_samp <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>na_row<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      na_colm <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> na_samp<span style="color: #68affc; font-style: italic;">)</span>
      pheno <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>-na_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>  -na_colm<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    # Calculating the number of each comparison mode <span style="color: #68affc; font-style: italic;">(</span>grade1 vs grade3<span style="color: #68affc; font-style: italic;">)</span>
    g_list <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    sampleid <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">j</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>groups<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      g_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>grade <span style="color: #68affc; font-style: italic;">%in%</span> groups<span style="color: #68affc; font-style: italic;">[</span>j<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
      s_id <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>g_row<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      sampleid<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>j<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> s_id
      g_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>j<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> factor<span style="color: #68affc; font-style: italic;">(</span>rep<span style="color: #68affc; font-style: italic;">(</span>j - 1<span style="color: #ebedf0; font-style: italic;">,</span> length<span style="color: #68affc; font-style: italic;">(</span>g_row<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    # Applying those modes and calculating the mean and variance for Cochran' Q Test
    spl <span style="color: #68affc; font-style: italic;"><-</span> unlist<span style="color: #68affc; font-style: italic;">(</span>g_list<span style="color: #68affc; font-style: italic;">)</span>
    spsam <span style="color: #68affc; font-style: italic;"><-</span> unlist<span style="color: #68affc; font-style: italic;">(</span>sampleid<span style="color: #68affc; font-style: italic;">)</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>spsam<span style="color: #68affc; font-style: italic;">]</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> as.matrix<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span>
    d.Split <span style="color: #68affc; font-style: italic;"><-</span> getdF<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span> spl<span style="color: #68affc; font-style: italic;">)</span>
    mean_d <span style="color: #68affc; font-style: italic;"><-</span> dstar<span style="color: #68affc; font-style: italic;">(</span>d.Split<span style="color: #ebedf0; font-style: italic;">,</span> length<span style="color: #68affc; font-style: italic;">(</span>spl<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    d.adj.Split<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> mean_d
    var_d <span style="color: #68affc; font-style: italic;"><-</span> sigmad<span style="color: #68affc; font-style: italic;">(</span>mean_d<span style="color: #ebedf0; font-style: italic;">,</span> sum<span style="color: #68affc; font-style: italic;">(</span>spl<span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span>0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> sum<span style="color: #68affc; font-style: italic;">(</span>spl<span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span>1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    var.d.adj.Split<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> var_d
  <span style="color: #68affc; font-style: italic;">}</span>
  # Output means and variances as a list
  output <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span>d.adj.Split<span style="color: #ebedf0; font-style: italic;">,</span> var.d.adj.Split<span style="color: #68affc; font-style: italic;">)</span>
  return<span style="color: #68affc; font-style: italic;">(</span>output<span style="color: #68affc; font-style: italic;">)</span>
  message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Analysis has completed."</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

MakeQQPlot <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>cohranq<span style="color: #ebedf0; font-style: italic;">,</span> nstudies<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Unpack the previous list into data frames
  output1 <span style="color: #68affc; font-style: italic;"><-</span> cohranq<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> 
  output2 <span style="color: #68affc; font-style: italic;"><-</span> cohranq<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  mymns <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>do.call<span style="color: #68affc; font-style: italic;">(</span>cbind<span style="color: #ebedf0; font-style: italic;">,</span> output1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  myvars <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>do.call<span style="color: #68affc; font-style: italic;">(</span>cbind<span style="color: #ebedf0; font-style: italic;">,</span> output2<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating Cochran' Q Test
  my.Q <span style="color: #68affc; font-style: italic;"><-</span> f.Q<span style="color: #68affc; font-style: italic;">(</span>mymns<span style="color: #ebedf0; font-style: italic;">,</span> myvars<span style="color: #68affc; font-style: italic;">)</span>
  nstudies <span style="color: #68affc; font-style: italic;"><-</span> nstudies
  #quantiles of the chisq distribution
  chisqq <span style="color: #68affc; font-style: italic;"><-</span> qchisq<span style="color: #68affc; font-style: italic;">(</span>seq<span style="color: #68affc; font-style: italic;">(</span>0<span style="color: #ebedf0; font-style: italic;">,</span> .9999<span style="color: #ebedf0; font-style: italic;">,</span> .001<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> df <span style="color: #68affc; font-style: italic;">=</span> nstudies-1<span style="color: #68affc; font-style: italic;">)</span>
  tmp <span style="color: #68affc; font-style: italic;"><-</span> quantile<span style="color: #68affc; font-style: italic;">(</span>my.Q<span style="color: #ebedf0; font-style: italic;">,</span> seq<span style="color: #68affc; font-style: italic;">(</span>0<span style="color: #ebedf0; font-style: italic;">,</span> .9999<span style="color: #ebedf0; font-style: italic;">,</span> .001<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  qq <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>chisqq <span style="color: #68affc; font-style: italic;">=</span> chisqq<span style="color: #ebedf0; font-style: italic;">,</span> tmp <span style="color: #68affc; font-style: italic;">=</span> tmp<span style="color: #68affc; font-style: italic;">)</span>
  # Plotting
  ggplot<span style="color: #68affc; font-style: italic;">(</span>data <span style="color: #68affc; font-style: italic;">=</span> qq<span style="color: #ebedf0; font-style: italic;">,</span> aes<span style="color: #68affc; font-style: italic;">(</span>x <span style="color: #68affc; font-style: italic;">=</span> chisqq<span style="color: #ebedf0; font-style: italic;">,</span> y <span style="color: #68affc; font-style: italic;">=</span> tmp<span style="color: #ebedf0; font-style: italic;">,</span> color <span style="color: #68affc; font-style: italic;">=</span> "#1B9E77"<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    geom_point<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
    geom_abline<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
    theme_classic<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
    labs<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Quantiles of Chi square'</span><span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Quantiles of Sample'</span><span style="color: #68affc; font-style: italic;">)</span> +
    theme<span style="color: #68affc; font-style: italic;">(</span>axis.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.text.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.text.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          plot.subtitle <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> hjust <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.title.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.title.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          legend.position<span style="color: #68affc; font-style: italic;">=</span><span style="color: #2ad43b; font-style: italic;">"none"</span><span style="color: #68affc; font-style: italic;">)</span> +
    labs<span style="color: #68affc; font-style: italic;">(</span>subtitle <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"QQ Plot"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

FEMREMAnalysis <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #ebedf0; font-style: italic;">,</span>
                           projname<span style="color: #ebedf0; font-style: italic;">,</span>
                           compare<span style="color: #ebedf0; font-style: italic;">,</span>
                           groups<span style="color: #ebedf0; font-style: italic;">,</span>
                           model<span style="color: #ebedf0; font-style: italic;">,</span>
                           FDR<span style="color: #ebedf0; font-style: italic;">,</span>
                           nperm<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  set.seed<span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  # Creating folders
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis"</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered"</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano"</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Reading phenotype file
  phenotype <span style="color: #68affc; font-style: italic;"><-</span> read_csv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  phenotype <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>phenotype<span style="color: #68affc; font-style: italic;">)</span>
  # Reading annotation file
  annotations <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    annot <span style="color: #68affc; font-style: italic;"><-</span> read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    annot <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">)</span>
    rownames<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    annot <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
    annot <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Chromosome.location"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GO.Function"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
    annot <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> annot<span style="color: #68affc; font-style: italic;">)</span>
    colnames<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span> 
    annot <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">$</span>ID<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    annotations<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> annot
  <span style="color: #68affc; font-style: italic;">}</span>
  an <span style="color: #68affc; font-style: italic;"><-</span> Reduce<span style="color: #68affc; font-style: italic;">(</span>intersect<span style="color: #ebedf0; font-style: italic;">,</span> annotations<span style="color: #68affc; font-style: italic;">)</span>
  annotations <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>do.call<span style="color: #68affc; font-style: italic;">(</span>cbind<span style="color: #ebedf0; font-style: italic;">,</span> an<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  matrices_list <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  class <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>studies<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> studies<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    paired_pheno <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>phenotype<span style="color: #68affc; font-style: italic;">$</span>Sample <span style="color: #68affc; font-style: italic;">%in%</span> colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    pheno <span style="color: #68affc; font-style: italic;"><-</span> phenotype<span style="color: #68affc; font-style: italic;">[</span>paired_pheno<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    na_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>is.na<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    # Matching phenotype with samples in matrix 
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>length<span style="color: #68affc; font-style: italic;">(</span>na_row<span style="color: #68affc; font-style: italic;">)</span> > 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      na_samp <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>na_row<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      na_colm <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%in%</span> na_samp<span style="color: #68affc; font-style: italic;">)</span>
      pheno <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>-na_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>  -na_colm<span style="color: #68affc; font-style: italic;">]</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    # Calculating the number of each comparison mode <span style="color: #68affc; font-style: italic;">(</span>grade1 vs grade3<span style="color: #68affc; font-style: italic;">)</span>
    g_list <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    sampleid <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
    for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">j</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>groups<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      g_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>grade <span style="color: #68affc; font-style: italic;">%in%</span> groups<span style="color: #68affc; font-style: italic;">[</span>j<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
      s_id <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>g_row<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
      sampleid<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>j<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> s_id
      g_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>j<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> factor<span style="color: #68affc; font-style: italic;">(</span>rep<span style="color: #68affc; font-style: italic;">(</span>j - 1<span style="color: #ebedf0; font-style: italic;">,</span> length<span style="color: #68affc; font-style: italic;">(</span>g_row<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    spl <span style="color: #68affc; font-style: italic;"><-</span> unlist<span style="color: #68affc; font-style: italic;">(</span>g_list<span style="color: #68affc; font-style: italic;">)</span>
    spl <span style="color: #68affc; font-style: italic;"><-</span> as.numeric<span style="color: #68affc; font-style: italic;">(</span>as.character<span style="color: #68affc; font-style: italic;">(</span>spl<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    class<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> spl
    spsam <span style="color: #68affc; font-style: italic;"><-</span> unlist<span style="color: #68affc; font-style: italic;">(</span>sampleid<span style="color: #68affc; font-style: italic;">)</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>spsam<span style="color: #68affc; font-style: italic;">]</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> as.matrix<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> ExpressionSet<span style="color: #68affc; font-style: italic;">(</span>assayData<span style="color: #68affc; font-style: italic;">=</span>matrix<span style="color: #68affc; font-style: italic;">)</span>
    matrices_list<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> matrix
  <span style="color: #68affc; font-style: italic;">}</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>model <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'FEM'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    useREM <span style="color: #68affc; font-style: italic;"><-</span> FALSE
  <span style="color: #68affc; font-style: italic;">}</span> 
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>model <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'REM'</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
    useREM <span style="color: #68affc; font-style: italic;"><-</span> TRUE
  <span style="color: #68affc; font-style: italic;">}</span>
  ScoresFDR <span style="color: #68affc; font-style: italic;"><-</span> zScoreFDR<span style="color: #68affc; font-style: italic;">(</span>matrices_list<span style="color: #ebedf0; font-style: italic;">,</span> class<span style="color: #ebedf0; font-style: italic;">,</span> useREM <span style="color: #68affc; font-style: italic;">=</span> useREM<span style="color: #ebedf0; font-style: italic;">,</span> nperm <span style="color: #68affc; font-style: italic;">=</span> nperm<span style="color: #68affc; font-style: italic;">)</span>
  twosided <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>ScoresFDR<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #2ad43b; font-style: italic;">"two.sided"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  twosided <span style="color: #68affc; font-style: italic;"><-</span> twosided<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  # Adding annotation
  anno_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>annotations<span style="color: #68affc; font-style: italic;">$</span>ID <span style="color: #68affc; font-style: italic;">%in%</span> rownames<span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  twosided <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #ebedf0; font-style: italic;">,</span>  annotations<span style="color: #68affc; font-style: italic;">[</span>anno_row<span style="color: #ebedf0; font-style: italic;">,</span> c<span style="color: #68affc; font-style: italic;">(</span>2<span style="color: #ebedf0; font-style: italic;">,</span> 3<span style="color: #ebedf0; font-style: italic;">,</span> 4<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  # Removing missing gene symbols
  genemissing <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>is.na<span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span>
  twosided <span style="color: #68affc; font-style: italic;"><-</span> twosided<span style="color: #68affc; font-style: italic;">[</span>-genemissing<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # All studies
  combination <span style="color: #68affc; font-style: italic;"><-</span> twosided<span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span>c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"zSco"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Chromosome.location"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GO.Function"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  dupgene_freq <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>table<span style="color: #68affc; font-style: italic;">(</span>combination<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  only_dupgene <span style="color: #68affc; font-style: italic;"><-</span> dupgene_freq<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>dupgene_freq<span style="color: #68affc; font-style: italic;">$</span>Freq > 1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 1<span style="color: #68affc; font-style: italic;">]</span>
  only_dupgene_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>combination<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">)</span>
  duplicat_deg <span style="color: #68affc; font-style: italic;"><-</span> combination<span style="color: #68affc; font-style: italic;">[</span>only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  
  averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span>b in 1:length<span style="color: #68affc; font-style: italic;">(</span>only_dupgene<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    d_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">[</span>b<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    col_mean <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>colMeans<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #ebedf0; font-style: italic;">,</span> 1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    col_all <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>col_mean<span style="color: #ebedf0; font-style: italic;">,</span> duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>3:5<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    averaged_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>b<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> col_all
  <span style="color: #68affc; font-style: italic;">}</span>
  averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> do.call<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
  unique_deg <span style="color: #68affc; font-style: italic;"><-</span> combination<span style="color: #68affc; font-style: italic;">[</span>-only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  all_unique_genes_combi <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>unique_deg<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
  rownames<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
  
  all_unique_genes_combi <span style="color: #68affc; font-style: italic;"><-</span> all_unique_genes_combi<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> decreasing <span style="color: #68affc; font-style: italic;">=</span> T<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  write_tsv<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/combination.tsv"</span><span style="color: #68affc; font-style: italic;">)</span>
  # All studies with FDR filtering
  all_unique_genes_combi <span style="color: #68affc; font-style: italic;"><-</span> all_unique_genes_combi<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #68affc; font-style: italic;">]</span> < FDR<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  write_tsv<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes_combi<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered/combination.tsv"</span><span style="color: #68affc; font-style: italic;">)</span>
  
  # Seperating each study<span style="color: #ebedf0; font-style: italic;">,</span> averaging duplicated genes
  sfdr <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"FDR_Ex_{0-9}"</span><span style="color: #ebedf0; font-style: italic;">,</span> colnames<span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>sfdr<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    gs_col <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol|Chromosome.location|GO.Function"</span><span style="color: #ebedf0; font-style: italic;">,</span> colnames<span style="color: #68affc; font-style: italic;">(</span>twosided<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    common <span style="color: #68affc; font-style: italic;"><-</span> twosided<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>c<span style="color: #68affc; font-style: italic;">(</span>sfdr<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span>-1<span style="color: #ebedf0; font-style: italic;">,</span> sfdr<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> gs_col<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
    colnames<span style="color: #68affc; font-style: italic;">(</span>common<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1:2<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> gsub<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Ex_."</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>colnames<span style="color: #68affc; font-style: italic;">(</span>common<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
   <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>nrow<span style="color: #68affc; font-style: italic;">(</span>common<span style="color: #68affc; font-style: italic;">)</span> > 1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
      dupgene_freq <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>table<span style="color: #68affc; font-style: italic;">(</span>common<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      only_dupgene <span style="color: #68affc; font-style: italic;"><-</span> dupgene_freq<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>dupgene_freq<span style="color: #68affc; font-style: italic;">$</span>Freq > 1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 1<span style="color: #68affc; font-style: italic;">]</span>
      only_dupgene_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>common<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">)</span>
      duplicat_deg <span style="color: #68affc; font-style: italic;"><-</span> common<span style="color: #68affc; font-style: italic;">[</span>only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      
      averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
      for<span style="color: #68affc; font-style: italic;">(</span>b in 1:length<span style="color: #68affc; font-style: italic;">(</span>only_dupgene<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
        d_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">[</span>b<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        col_mean <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>colMeans<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #ebedf0; font-style: italic;">,</span> 1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
        col_all <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>col_mean<span style="color: #ebedf0; font-style: italic;">,</span> duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>3:5<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
        averaged_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>b<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> col_all
      <span style="color: #68affc; font-style: italic;">}</span>
      averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> do.call<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
      unique_deg <span style="color: #68affc; font-style: italic;"><-</span> common<span style="color: #68affc; font-style: italic;">[</span>-only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
      all_unique_genes <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>unique_deg<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
      rownames<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
      all_unique_genes <span style="color: #68affc; font-style: italic;"><-</span> all_unique_genes<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> decreasing <span style="color: #68affc; font-style: italic;">=</span> T<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      write_tsv<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
      all_unique_genes <span style="color: #68affc; font-style: italic;"><-</span> all_unique_genes<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>2<span style="color: #68affc; font-style: italic;">]</span> < FDR<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
      write_tsv<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/filtered/"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    <span style="color: #68affc; font-style: italic;">}</span>
    
    eslash_genes <span style="color: #68affc; font-style: italic;"><-</span> length<span style="color: #68affc; font-style: italic;">(</span>grep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"///"</span><span style="color: #ebedf0; font-style: italic;">,</span> all_unique_genes<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"###################### Summary for: "</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">" ############################"</span><span style="color: #68affc; font-style: italic;">)</span>
    message<span style="color: #68affc; font-style: italic;">(</span>cat<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Number of missing gene symbols:"</span><span style="color: #ebedf0; font-style: italic;">,</span> length<span style="color: #68affc; font-style: italic;">(</span>genemissing<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nNumber of duplicated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> length<span style="color: #68affc; font-style: italic;">(</span>only_dupgene<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nTotal number of genes after averaging duplicated genes and FDR filter:"</span><span style="color: #ebedf0; font-style: italic;">,</span> NROW<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                <span style="color: #2ad43b; font-style: italic;">"\nNumber of genes having ///:"</span><span style="color: #ebedf0; font-style: italic;">,</span> eslash_genes<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"##########################################################################"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++++++++++++++++++++ Analysis has completed. +++++++++++++++++++++++"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

Makevolcano <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                        pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                        nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                        ntop <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                        voltype <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG"</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Reading the DEGs table
  volcano <span style="color: #68affc; font-style: italic;"><-</span> read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/volcano/"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  volcano <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">)</span>
  colnames<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1:2<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> gsub<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"_"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> colnames<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  #volcano <span style="color: #68affc; font-style: italic;"><-</span> volcano<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>FDR <span style="color: #68affc; font-style: italic;">!</span><span style="color: #68affc; font-style: italic;">=</span> 0<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  volcano <span style="color: #68affc; font-style: italic;"><-</span> volcano <span style="color: #68affc; font-style: italic;">%>%</span>
    mutate<span style="color: #68affc; font-style: italic;">(</span>AdjustedPvalue <span style="color: #68affc; font-style: italic;">=</span> -log10<span style="color: #68affc; font-style: italic;">(</span>FDR<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    mutate<span style="color: #68affc; font-style: italic;">(</span>DEG <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificant"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    mutate<span style="color: #68affc; font-style: italic;">(</span>DEG <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>AdjustedPvalue > -log10<span style="color: #68affc; font-style: italic;">(</span>padjlevel<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">&</span> zSco > pSE_thresh<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> DEG<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    mutate<span style="color: #68affc; font-style: italic;">(</span>DEG <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>AdjustedPvalue > -log10<span style="color: #68affc; font-style: italic;">(</span>padjlevel<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">&</span> zSco < nSE_thresh<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> DEG<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  
  zero_fdr <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>FDR <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> 0<span style="color: #68affc; font-style: italic;">)</span>
  m <span style="color: #68affc; font-style: italic;"><-</span> -log10<span style="color: #68affc; font-style: italic;">(</span>min<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">[</span>-zero_fdr<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> + 0.5
  volcano<span style="color: #68affc; font-style: italic;">[</span>zero_fdr<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"AdjustedPvalue"</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> m
  # Colors
  my_pal <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span>#1B9E77<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span>#7570B3<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E7298A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#66A61E<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E6AB02<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#A6761D<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#666666<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#9A7D0A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the number of each Upregulated<span style="color: #ebedf0; font-style: italic;">,</span> Downregulated<span style="color: #ebedf0; font-style: italic;">,</span> and NotSignificant probes
  volcano_up <span style="color: #68affc; font-style: italic;"><-</span> volcano<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  volcano_down <span style="color: #68affc; font-style: italic;"><-</span> volcano<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  volcano_down <span style="color: #68affc; font-style: italic;"><-</span> volcano_down<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>volcano_down<span style="color: #68affc; font-style: italic;">$</span>zSco<span style="color: #ebedf0; font-style: italic;">,</span> decreasing <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  volcano_NA <span style="color: #68affc; font-style: italic;"><-</span> volcano<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>volcano<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificant"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  # Combining all with together 
  volcano_all <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>volcano_up<span style="color: #ebedf0; font-style: italic;">,</span> volcano_down<span style="color: #ebedf0; font-style: italic;">,</span> volcano_NA<span style="color: #68affc; font-style: italic;">)</span>
  # Replacing the top probes with word Top
  ntop_rep <span style="color: #68affc; font-style: italic;"><-</span> rep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Top"</span><span style="color: #ebedf0; font-style: italic;">,</span> ntop<span style="color: #68affc; font-style: italic;">)</span>
  volcano_all<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span>ntop_rep<span style="color: #ebedf0; font-style: italic;">,</span> volcano_up<span style="color: #68affc; font-style: italic;">$</span>DEG<span style="color: #68affc; font-style: italic;">[</span>-c<span style="color: #68affc; font-style: italic;">(</span>1:ntop<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> ntop_rep<span style="color: #ebedf0; font-style: italic;">,</span> volcano_down<span style="color: #68affc; font-style: italic;">$</span>DEG<span style="color: #68affc; font-style: italic;">[</span>-c<span style="color: #68affc; font-style: italic;">(</span>1:ntop<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> volcano_NA<span style="color: #68affc; font-style: italic;">$</span>DEG<span style="color: #68affc; font-style: italic;">)</span>
  # Label only top genes
  volcano_all<span style="color: #68affc; font-style: italic;">$</span>Top <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>volcano_all<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Top"</span><span style="color: #ebedf0; font-style: italic;">,</span> volcano_all<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span>
  # Plotting either with plotly or ggplot
  if<span style="color: #68affc; font-style: italic;">(</span>voltype <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    p <span style="color: #68affc; font-style: italic;"><-</span> ggplot<span style="color: #68affc; font-style: italic;">(</span>data <span style="color: #68affc; font-style: italic;">=</span> volcano_all<span style="color: #ebedf0; font-style: italic;">,</span> aes<span style="color: #68affc; font-style: italic;">(</span>x <span style="color: #68affc; font-style: italic;">=</span> zSco<span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">=</span> AdjustedPvalue<span style="color: #ebedf0; font-style: italic;">,</span> color<span style="color: #68affc; font-style: italic;">=</span> DEG<span style="color: #ebedf0; font-style: italic;">,</span> fill <span style="color: #68affc; font-style: italic;">=</span> DEG<span style="color: #ebedf0; font-style: italic;">,</span> label<span style="color: #68affc; font-style: italic;">=</span> Top<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> + 
      labs<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Effect size'</span><span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;"></span><span style="color: #68affc; font-style: italic;">)</span> +
      geom_point<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span> shape <span style="color: #68affc; font-style: italic;">=</span> 21<span style="color: #68affc; font-style: italic;">)</span> +
      geom_text<span style="color: #68affc; font-style: italic;">(</span>check_overlap <span style="color: #68affc; font-style: italic;">=</span> T<span style="color: #ebedf0; font-style: italic;">,</span>vjust <span style="color: #68affc; font-style: italic;">=</span> 0.1<span style="color: #ebedf0; font-style: italic;">,</span> nudge_y <span style="color: #68affc; font-style: italic;">=</span> 0.1<span style="color: #68affc; font-style: italic;">)</span> +
      scale_color_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      scale_fill_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>paste<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> sep <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      theme_classic<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
      theme<span style="color: #68affc; font-style: italic;">(</span>axis.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.text.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.text.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            plot.subtitle <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> hjust <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.title.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.title.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            legend.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span> family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            legend.title <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 20<span style="color: #ebedf0; font-style: italic;">,</span> family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      labs<span style="color: #68affc; font-style: italic;">(</span>subtitle <span style="color: #68affc; font-style: italic;">=</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    p
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    # Creating ggplot object<span style="color: #ebedf0; font-style: italic;">,</span> adding layers and annotation to the plot
    p <span style="color: #68affc; font-style: italic;"><-</span> ggplot<span style="color: #68affc; font-style: italic;">(</span>data <span style="color: #68affc; font-style: italic;">=</span> volcano_all<span style="color: #ebedf0; font-style: italic;">,</span> aes<span style="color: #68affc; font-style: italic;">(</span>x <span style="color: #68affc; font-style: italic;">=</span> zSco<span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">=</span> AdjustedPvalue<span style="color: #ebedf0; font-style: italic;">,</span> color<span style="color: #68affc; font-style: italic;">=</span> DEG<span style="color: #ebedf0; font-style: italic;">,</span> fill <span style="color: #68affc; font-style: italic;">=</span> DEG<span style="color: #ebedf0; font-style: italic;">,</span> text <span style="color: #68affc; font-style: italic;">=</span> paste<span style="color: #68affc; font-style: italic;">(</span>
      <span style="color: #2ad43b; font-style: italic;">"<br>Gene: "</span><span style="color: #ebedf0; font-style: italic;">,</span> Gene.symbol<span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #2ad43b; font-style: italic;">"<br>Chromosome: "</span><span style="color: #ebedf0; font-style: italic;">,</span> Chromosome.location<span style="color: #ebedf0; font-style: italic;">,</span>
      <span style="color: #2ad43b; font-style: italic;">"<br>GO function: "</span><span style="color: #ebedf0; font-style: italic;">,</span> GO.function <span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      labs<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Effect size'</span><span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;"></span><span style="color: #ebedf0; font-style: italic;">,</span> title <span style="color: #68affc; font-style: italic;">=</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      geom_point<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span> shape <span style="color: #68affc; font-style: italic;">=</span> 21<span style="color: #68affc; font-style: italic;">)</span> +
      scale_color_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      scale_fill_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>paste<span style="color: #68affc; font-style: italic;">(</span>my_pal<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"66"</span><span style="color: #ebedf0; font-style: italic;">,</span> sep <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
      theme_classic<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
      theme<span style="color: #68affc; font-style: italic;">(</span>axis.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.text.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.text.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            plot.subtitle <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> hjust <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.title.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            axis.title.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    p <span style="color: #68affc; font-style: italic;"><-</span> ggplotly<span style="color: #68affc; font-style: italic;">(</span>p<span style="color: #ebedf0; font-style: italic;">,</span> tooltip <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"text"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
      layout<span style="color: #68affc; font-style: italic;">(</span>title <span style="color: #68affc; font-style: italic;">=</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Volcano plot-"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
             font <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> color <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
             legend <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> color <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 20<span style="color: #ebedf0; font-style: italic;">,</span> itemclick <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"toggle"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Calculation the up and down regulated genes number
  write_tsv<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #68affc; font-style: italic;">(</span>volcano_up<span style="color: #ebedf0; font-style: italic;">,</span> volcano_down<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Creating the top table <span style="color: #68affc; font-style: italic;">(</span>up and down<span style="color: #68affc; font-style: italic;">)</span> based on the number specified <span style="color: #68affc; font-style: italic;">(</span>ntop<span style="color: #68affc; font-style: italic;">)</span>
  top <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>volcano_up<span style="color: #68affc; font-style: italic;">[</span>1:ntop<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> volcano_down<span style="color: #68affc; font-style: italic;">[</span>1:ntop<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  top <span style="color: #68affc; font-style: italic;"><-</span> top<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-6<span style="color: #68affc; font-style: italic;">]</span>
  # Save top table into project folder
  write_tsv<span style="color: #68affc; font-style: italic;">(</span>top<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_top.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"################# Significance #################"</span><span style="color: #68affc; font-style: italic;">)</span>
  message<span style="color: #68affc; font-style: italic;">(</span>cat<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Up-regulated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> nrow<span style="color: #68affc; font-style: italic;">(</span>volcano_up<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
              <span style="color: #2ad43b; font-style: italic;">"\nDown-regulated genes:"</span><span style="color: #ebedf0; font-style: italic;">,</span> nrow<span style="color: #68affc; font-style: italic;">(</span>volcano_down<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"################################################"</span><span style="color: #68affc; font-style: italic;">)</span>
  return<span style="color: #68affc; font-style: italic;">(</span>p<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

MakeVenna <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>common<span style="color: #ebedf0; font-style: italic;">,</span>
                      ntop <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common"</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
  # Reading all all_top_down files
  com_table <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>common<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    DEG_table <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> common<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    com_table<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>common<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> DEG_table<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-6<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Calculating up and down regulated gens
  DEGslist <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    DEGslist<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>common<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> com_table<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>3<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Common genes
  com_prob <span style="color: #68affc; font-style: italic;"><-</span> Reduce<span style="color: #68affc; font-style: italic;">(</span>intersect<span style="color: #ebedf0; font-style: italic;">,</span> DEGslist<span style="color: #68affc; font-style: italic;">)</span>
  # Writing all common genes into separated files as well as the top files
  all_com <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    comn <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>names<span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">%in%</span> com_prob<span style="color: #68affc; font-style: italic;">)</span>
    com_final_DEG  <span style="color: #68affc; font-style: italic;"><-</span> com_table<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>names<span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span>comn<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    write_tsv<span style="color: #68affc; font-style: italic;">(</span>com_final_DEG<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/"</span><span style="color: #ebedf0; font-style: italic;">,</span>names<span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    sorted_com_final_DEG <span style="color: #68affc; font-style: italic;"><-</span> com_final_DEG<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>com_final_DEG<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
    all_com<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>names<span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> sorted_com_final_DEG
    com_final_up <span style="color: #68affc; font-style: italic;"><-</span> com_final_DEG<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>com_final_DEG<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    com_final_up <span style="color: #68affc; font-style: italic;"><-</span> com_final_up<span style="color: #68affc; font-style: italic;">[</span>1:ntop<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    com_final_down <span style="color: #68affc; font-style: italic;"><-</span> com_final_DEG<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>com_final_DEG<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    com_final_down <span style="color: #68affc; font-style: italic;"><-</span> com_final_down<span style="color: #68affc; font-style: italic;">[</span>1:ntop<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
    write_tsv<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #68affc; font-style: italic;">(</span>com_final_up<span style="color: #ebedf0; font-style: italic;">,</span> com_final_down<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/"</span><span style="color: #ebedf0; font-style: italic;">,</span> names<span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_top_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  firstsecond_col <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  remaining <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>all_com<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    firstsecond_col<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>all_com<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1:2<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    remaining<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>all_com<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>3:6<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  firstsecond_col_df <span style="color: #68affc; font-style: italic;"><-</span> do.call<span style="color: #68affc; font-style: italic;">(</span>cbind<span style="color: #ebedf0; font-style: italic;">,</span> firstsecond_col<span style="color: #68affc; font-style: italic;">)</span>
  sz <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"zSco"</span><span style="color: #ebedf0; font-style: italic;">,</span> colnames<span style="color: #68affc; font-style: italic;">(</span>firstsecond_col_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  fdr <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"FDR"</span><span style="color: #ebedf0; font-style: italic;">,</span> colnames<span style="color: #68affc; font-style: italic;">(</span>firstsecond_col_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  sz_mean <span style="color: #68affc; font-style: italic;"><-</span> rowMeans<span style="color: #68affc; font-style: italic;">(</span>firstsecond_col_df<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>sz<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  fdr_mean <span style="color: #68affc; font-style: italic;"><-</span> rowMeans<span style="color: #68affc; font-style: italic;">(</span>firstsecond_col_df<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>fdr<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  sz_fdr_df <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>zSco <span style="color: #68affc; font-style: italic;">=</span> sz_mean<span style="color: #ebedf0; font-style: italic;">,</span> FDR<span style="color: #68affc; font-style: italic;">=</span> fdr_mean<span style="color: #68affc; font-style: italic;">)</span>
  sz_fdr_df <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>sz_fdr_df<span style="color: #ebedf0; font-style: italic;">,</span> remaining<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  write_tsv<span style="color: #68affc; font-style: italic;">(</span>sz_fdr_df<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/common/all_mean_common_DEGs.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  
  
  message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Common genes between all datasets have saved into common folder. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Creating venn diagram
  DEGslist <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>com_table<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    DEGslist<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>common<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> com_table<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span>3<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  venlist <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>DEGslist<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    venlist<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>common<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> DEGslist<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  set.seed<span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
  my_pal <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span>#1B9E77<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span>#7570B3<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E7298A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#66A61E<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E6AB02<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#A6761D<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#666666<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#9A7D0A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  venaa <span style="color: #68affc; font-style: italic;"><-</span> ggvenn<span style="color: #68affc; font-style: italic;">(</span>venlist<span style="color: #ebedf0; font-style: italic;">,</span> 
                  fill_color <span style="color: #68affc; font-style: italic;">=</span> my_pal<span style="color: #ebedf0; font-style: italic;">,</span>
                  stroke_size <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #ebedf0; font-style: italic;">,</span>
                  set_name_size <span style="color: #68affc; font-style: italic;">=</span> 4<span style="color: #68affc; font-style: italic;">)</span>
  return<span style="color: #68affc; font-style: italic;">(</span>venaa<span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

Makenetworkanalyst <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span>
                               projname<span style="color: #ebedf0; font-style: italic;">,</span>
                               compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               groups<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">{</span>
  # Reading files
  <span style="color: #ebedf0; font-style: italic;">dir.create</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/networkanalyst"</span><span style="color: #ebedf0; font-style: italic;">,</span> showWarnings <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  
  pheno <span style="color: #68affc; font-style: italic;"><-</span> read_csv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  pheno <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">)</span>
  paired_pheno <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>Sample <span style="color: #68affc; font-style: italic;">%in%</span> colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  pheno <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>paired_pheno<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  
  annot <span style="color: #68affc; font-style: italic;"><-</span> read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  annot <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">)</span>
  rownames<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
  annot <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
  # Finding matching grades or subtypes
  sampleid <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>groups<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    g_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>grade <span style="color: #68affc; font-style: italic;">%in%</span> groups<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    sampleid<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>g_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  sampleid <span style="color: #68affc; font-style: italic;"><-</span> do.call<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #ebedf0; font-style: italic;">,</span> sampleid<span style="color: #68affc; font-style: italic;">)</span>
  sampleid <span style="color: #68affc; font-style: italic;"><-</span> sampleid<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>sampleid<span style="color: #68affc; font-style: italic;">$</span>Sample<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> sampleid<span style="color: #68affc; font-style: italic;">$</span>Sample<span style="color: #68affc; font-style: italic;">]</span>
  matrix <span style="color: #68affc; font-style: italic;"><-</span> round<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span> 2<span style="color: #68affc; font-style: italic;">)</span>
  identical<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> rownames<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  matrix <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #ebedf0; font-style: italic;">,</span> matrix<span style="color: #68affc; font-style: italic;">)</span>
  colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  genemissing <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>is.na<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span>
  matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span>-genemissing<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>

  grouplis <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>groups<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    name <span style="color: #68affc; font-style: italic;"><-</span> paste0<span style="color: #68affc; font-style: italic;">(</span>groups<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> collapse <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span>
    rownum <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span>name<span style="color: #ebedf0; font-style: italic;">,</span> pheno<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span>
    grouplis<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>names<span style="color: #68affc; font-style: italic;">(</span>groups<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">$</span>Sample<span style="color: #68affc; font-style: italic;">[</span>rownum<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Renaming the matrix file according to the groups name specified by user 
  updown_matrix <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> matrix<span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>grouplis<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    matname <span style="color: #68affc; font-style: italic;"><-</span> paste0<span style="color: #68affc; font-style: italic;">(</span>grouplis<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> collapse <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span>
    matcoln <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span>matname<span style="color: #ebedf0; font-style: italic;">,</span> colnames<span style="color: #68affc; font-style: italic;">(</span>updown_matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    updown_matrix<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">,</span>matcoln<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> names<span style="color: #68affc; font-style: italic;">(</span>grouplis<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Adding col names and second row according to the file for networkanalyst
  changedcol <span style="color: #68affc; font-style: italic;"><-</span> grep<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span>names<span style="color: #68affc; font-style: italic;">(</span>grouplis<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> collapse <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"|"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> updown_matrix<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  updown_matrix <span style="color: #68affc; font-style: italic;"><-</span> updown_matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> c<span style="color: #68affc; font-style: italic;">(</span>1<span style="color: #ebedf0; font-style: italic;">,</span> changedcol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  updown_matrix<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"#CLASS"</span>
  colnames<span style="color: #68affc; font-style: italic;">(</span>updown_matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"#NAME"</span>
  write.table<span style="color: #68affc; font-style: italic;">(</span>updown_matrix<span style="color: #ebedf0; font-style: italic;">,</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/networkanalyst/"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"_network_full.txt"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> quote <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #ebedf0; font-style: italic;">,</span> row.names <span style="color: #68affc; font-style: italic;">=</span> F<span style="color: #ebedf0; font-style: italic;">,</span> sep <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"\t"</span> <span style="color: #68affc; font-style: italic;">)</span>
  message<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"+++++ Your file has saved into networkanalyst folder. +++++"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span> 

MakeHeatmap <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #ebedf0; font-style: italic;">,</span>
                        projname<span style="color: #ebedf0; font-style: italic;">,</span>
                        compare<span style="color: #ebedf0; font-style: italic;">,</span>
                        groups<span style="color: #ebedf0; font-style: italic;">,</span>
                        ntop<span style="color: #ebedf0; font-style: italic;">,</span> 
                        sorted<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  set.seed<span style="color: #68affc; font-style: italic;">(</span>1234<span style="color: #68affc; font-style: italic;">)</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Reading phenotype
  pheno <span style="color: #68affc; font-style: italic;"><-</span> read_csv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Phenotype/phenotype_"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">".csv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  pheno <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">)</span>
  # Reading annotation  
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    annot <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span><span style="color: #68affc; font-style: italic;">{</span>
    annot <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"/"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"annot.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  annot <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span> <span style="color: #ebedf0; font-style: italic;">,</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"ID"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  annot <span style="color: #68affc; font-style: italic;"><-</span> annot<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">$</span>ID<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>identical<span style="color: #68affc; font-style: italic;">(</span>rownames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> annot<span style="color: #68affc; font-style: italic;">$</span>ID<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    matrix <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>annot<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #ebedf0; font-style: italic;">,</span> matrix<span style="color: #68affc; font-style: italic;">)</span>
    colnames<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  # Averaging duplicated genes
  dupgene_freq <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>table<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  only_dupgene <span style="color: #68affc; font-style: italic;"><-</span> dupgene_freq<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>dupgene_freq<span style="color: #68affc; font-style: italic;">$</span>Freq > 1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 1<span style="color: #68affc; font-style: italic;">]</span>
  only_dupgene_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>matrix<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">)</span>
  duplicat_deg <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span>only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  
  averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span>i in 1:length<span style="color: #68affc; font-style: italic;">(</span>only_dupgene<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    d_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> only_dupgene<span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    col_mean <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>colMeans<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #ebedf0; font-style: italic;">,</span> -1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
    col_all <span style="color: #68affc; font-style: italic;"><-</span> cbind<span style="color: #68affc; font-style: italic;">(</span>duplicat_deg<span style="color: #68affc; font-style: italic;">[</span>d_row<span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">]</span><span style="color: #ebedf0; font-style: italic;">,</span> col_mean<span style="color: #68affc; font-style: italic;">)</span>
    averaged_genes<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> col_all
  <span style="color: #68affc; font-style: italic;">}</span>
  averaged_genes <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>do.call<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  colnames<span style="color: #68affc; font-style: italic;">(</span>averaged_genes<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span>1<span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #2ad43b; font-style: italic;">"Gene.symbol"</span>
  unique_deg <span style="color: #68affc; font-style: italic;"><-</span> matrix<span style="color: #68affc; font-style: italic;">[</span>-only_dupgene_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  all_unique_genes <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>unique_deg<span style="color: #ebedf0; font-style: italic;">,</span> averaged_genes<span style="color: #68affc; font-style: italic;">)</span>
  rownames<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> NULL
  # Reading DEG file
  DEG_table <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Finding up and down regulated gene and make original matrix of them
  up <span style="color: #68affc; font-style: italic;"><-</span> DEG_table<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>DEG_table<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  up <span style="color: #68affc; font-style: italic;"><-</span> up<span style="color: #68affc; font-style: italic;">[</span>1:ntop<span style="color: #ebedf0; font-style: italic;">,</span>2:3<span style="color: #68affc; font-style: italic;">]</span>
  down <span style="color: #68affc; font-style: italic;"><-</span> DEG_table<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>DEG_table<span style="color: #68affc; font-style: italic;">$</span>DEG <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  down <span style="color: #68affc; font-style: italic;"><-</span> down<span style="color: #68affc; font-style: italic;">[</span>1:ntop<span style="color: #ebedf0; font-style: italic;">,</span> 2:3<span style="color: #68affc; font-style: italic;">]</span>
  genelist <span style="color: #68affc; font-style: italic;"><-</span> rbind<span style="color: #68affc; font-style: italic;">(</span>up<span style="color: #ebedf0; font-style: italic;">,</span> down<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>2<span style="color: #68affc; font-style: italic;">]</span>
  num <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;">%in%</span> genelist<span style="color: #68affc; font-style: italic;">)</span>
  network_df <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>all_unique_genes<span style="color: #68affc; font-style: italic;">[</span>num<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
  Gene.symbol <span style="color: #68affc; font-style: italic;"><-</span> network_df<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol
  network_df <span style="color: #68affc; font-style: italic;"><-</span> network_df<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>-1<span style="color: #68affc; font-style: italic;">]</span>
  network_df <span style="color: #68affc; font-style: italic;"><-</span> as.matrix<span style="color: #68affc; font-style: italic;">(</span>sapply<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #ebedf0; font-style: italic;">,</span> as.numeric<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  rownames<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> Gene.symbol
  
  # Finding grades and matching with colnames
  sampleid <span style="color: #68affc; font-style: italic;"><-</span> list<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  for<span style="color: #68affc; font-style: italic;">(</span><span style="color: #ebedf0; font-style: italic;">i</span> <span style="color: #f79502; font-style: italic;">in</span> <span style="color: #ebedf0; font-style: italic;">seq_along</span><span style="color: #68affc; font-style: italic;">(</span>groups<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
    g_row <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>pheno<span style="color: #68affc; font-style: italic;">$</span>grade <span style="color: #68affc; font-style: italic;">%in%</span> groups<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">)</span>
    sampleid<span style="color: #68affc; font-style: italic;">[</span><span style="color: #68affc; font-style: italic;">[</span>i<span style="color: #68affc; font-style: italic;">]</span><span style="color: #68affc; font-style: italic;">]</span> <span style="color: #68affc; font-style: italic;"><-</span> pheno<span style="color: #68affc; font-style: italic;">[</span>g_row<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  <span style="color: #68affc; font-style: italic;">}</span>
  sampleid <span style="color: #68affc; font-style: italic;"><-</span> do.call<span style="color: #68affc; font-style: italic;">(</span>rbind<span style="color: #ebedf0; font-style: italic;">,</span> sampleid<span style="color: #68affc; font-style: italic;">)</span>
  sampleid_n <span style="color: #68affc; font-style: italic;"><-</span> which<span style="color: #68affc; font-style: italic;">(</span>sampleid<span style="color: #68affc; font-style: italic;">$</span>Sample <span style="color: #68affc; font-style: italic;">%in%</span> colnames<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  sampleid <span style="color: #68affc; font-style: italic;"><-</span> sampleid<span style="color: #68affc; font-style: italic;">[</span>sampleid_n<span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  sampleid <span style="color: #68affc; font-style: italic;"><-</span> sampleid<span style="color: #68affc; font-style: italic;">[</span>order<span style="color: #68affc; font-style: italic;">(</span>sampleid<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #68affc; font-style: italic;">]</span>
  sampleid<span style="color: #68affc; font-style: italic;">$</span>grade <span style="color: #68affc; font-style: italic;"><-</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"Grade_"</span><span style="color: #ebedf0; font-style: italic;">,</span> sampleid<span style="color: #68affc; font-style: italic;">$</span>grade<span style="color: #68affc; font-style: italic;">)</span> 
  network_df <span style="color: #68affc; font-style: italic;"><-</span> network_df<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span> sampleid<span style="color: #68affc; font-style: italic;">$</span>Sample<span style="color: #68affc; font-style: italic;">]</span>
  colnames<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> sampleid<span style="color: #68affc; font-style: italic;">$</span>grade 
  # Grade info
  type <span style="color: #68affc; font-style: italic;"><-</span> colnames<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span>
  ha <span style="color: #68affc; font-style: italic;">=</span> HeatmapAnnotation<span style="color: #68affc; font-style: italic;">(</span>
    df <span style="color: #68affc; font-style: italic;">=</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>Grade <span style="color: #68affc; font-style: italic;">=</span> type<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
    annotation_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>4<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">)</span>
  # Heatmap plot
 <span style="color: #f79502; font-style: italic;">if</span><span style="color: #68affc; font-style: italic;">(</span>sorted <span style="color: #68affc; font-style: italic;">=</span><span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  Heatmap<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #ebedf0; font-style: italic;">,</span>
          row_names_gp <span style="color: #68affc; font-style: italic;">=</span> gpar<span style="color: #68affc; font-style: italic;">(</span>fontsize <span style="color: #68affc; font-style: italic;">=</span> 7<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          bottom_annotation<span style="color: #68affc; font-style: italic;">=</span> ha<span style="color: #ebedf0; font-style: italic;">,</span>
          column_order <span style="color: #68affc; font-style: italic;">=</span> colnames<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          border_gp <span style="color: #68affc; font-style: italic;">=</span> gpar<span style="color: #68affc; font-style: italic;">(</span>col <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          row_title <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"DEGs"</span><span style="color: #ebedf0; font-style: italic;">,</span>
          row_title_side <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"left"</span><span style="color: #ebedf0; font-style: italic;">,</span>
          show_column_names <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #ebedf0; font-style: italic;">,</span>
          heatmap_legend_param <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>legend_direction <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"vertical"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      legend_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>50<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      grid_width <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>6<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      grid_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>50<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"cm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                      title <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Expression"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span><span style="color: #f79502; font-style: italic;"> else</span> <span style="color: #68affc; font-style: italic;">{</span>
    Heatmap<span style="color: #68affc; font-style: italic;">(</span>network_df<span style="color: #ebedf0; font-style: italic;">,</span>
            row_names_gp <span style="color: #68affc; font-style: italic;">=</span> gpar<span style="color: #68affc; font-style: italic;">(</span>fontsize <span style="color: #68affc; font-style: italic;">=</span> 7<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            bottom_annotation<span style="color: #68affc; font-style: italic;">=</span> ha<span style="color: #ebedf0; font-style: italic;">,</span>
            border_gp <span style="color: #68affc; font-style: italic;">=</span> gpar<span style="color: #68affc; font-style: italic;">(</span>col <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            row_title <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"DEGs"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            row_title_side <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"left"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            show_column_names <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #ebedf0; font-style: italic;">,</span>
            heatmap_legend_param <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>legend_direction <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"vertical"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        legend_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>50<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        grid_width <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>6<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"mm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        grid_height <span style="color: #68affc; font-style: italic;">=</span> unit<span style="color: #68affc; font-style: italic;">(</span>50<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"cm"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                        title <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Expression"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  <span style="color: #68affc; font-style: italic;">}</span>
<span style="color: #68affc; font-style: italic;">}</span>

GSEAAnalysis <span style="color: #68affc; font-style: italic;"><-</span> <span style="color: #f79502; font-style: italic;">function</span><span style="color: #68affc; font-style: italic;">(</span>projname<span style="color: #ebedf0; font-style: italic;">,</span> FDR<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">{</span>
  # Reading file 
  DEG_table <span style="color: #68affc; font-style: italic;"><-</span> data.frame<span style="color: #68affc; font-style: italic;">(</span>read_tsv<span style="color: #68affc; font-style: italic;">(</span>paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"MetaAnalysis/DEG/"</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"_up_down.tsv"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  # Removing /// from some genes
  DEG_table<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol <span style="color: #68affc; font-style: italic;"><-</span> gsub<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"///.*"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> DEG_table<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol<span style="color: #68affc; font-style: italic;">)</span>
  # Extracting Halmark pathway with 50 gene sets 
  H <span style="color: #68affc; font-style: italic;"><-</span> msigdbr<span style="color: #68affc; font-style: italic;">(</span>species <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Homo sapiens"</span><span style="color: #ebedf0; font-style: italic;">,</span> category <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"H"</span><span style="color: #68affc; font-style: italic;">)</span>
  H.symbol.ls <span style="color: #68affc; font-style: italic;"><-</span> H <span style="color: #68affc; font-style: italic;">%>%</span> 
    select<span style="color: #68affc; font-style: italic;">(</span>gs_name<span style="color: #ebedf0; font-style: italic;">,</span> gene_symbol<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    group_by<span style="color: #68affc; font-style: italic;">(</span>gs_name<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    summarise<span style="color: #68affc; font-style: italic;">(</span>all.genes <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>unique<span style="color: #68affc; font-style: italic;">(</span>gene_symbol<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span> 
    deframe<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span>
  # Just gene names and logFC
  FC <span style="color: #68affc; font-style: italic;"><-</span> DEG_table<span style="color: #68affc; font-style: italic;">[</span><span style="color: #ebedf0; font-style: italic;">,</span>c<span style="color: #68affc; font-style: italic;">(</span>3<span style="color: #ebedf0; font-style: italic;">,</span>1<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">]</span>
  
  ##format for gsea 
  FC.vec <span style="color: #68affc; font-style: italic;"><-</span> FC<span style="color: #68affc; font-style: italic;">$</span>zSco
  names<span style="color: #68affc; font-style: italic;">(</span>FC.vec<span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;"><-</span> FC<span style="color: #68affc; font-style: italic;">$</span>Gene.symbol
  #Run GSEA
  gsea.H <span style="color: #68affc; font-style: italic;"><-</span> fgseaSimple<span style="color: #68affc; font-style: italic;">(</span>pathways <span style="color: #68affc; font-style: italic;">=</span> H.symbol.ls<span style="color: #ebedf0; font-style: italic;">,</span>
                        stats <span style="color: #68affc; font-style: italic;">=</span> FC.vec<span style="color: #ebedf0; font-style: italic;">,</span>
                        scoreType <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"std"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                        nperm<span style="color: #68affc; font-style: italic;">=</span>1000<span style="color: #68affc; font-style: italic;">)</span>

  my_pal <span style="color: #68affc; font-style: italic;"><-</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"</span>#1B9E77<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"</span>#7570B3<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E7298A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#66A61E<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#E6AB02<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#A6761D<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#666666<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"</span>#9A7D0A<span style="color: #2ad43b; font-style: italic;">"</span><span style="color: #68affc; font-style: italic;">)</span>
  # Remove prefixes
  gsea.H<span style="color: #68affc; font-style: italic;">$</span>pathway <span style="color: #68affc; font-style: italic;"><-</span> gsub<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"HALLMARK_"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">""</span><span style="color: #ebedf0; font-style: italic;">,</span> gsea.H<span style="color: #68affc; font-style: italic;">$</span>pathway<span style="color: #68affc; font-style: italic;">)</span>
  gsea.H<span style="color: #68affc; font-style: italic;">$</span>pathway <span style="color: #68affc; font-style: italic;"><-</span> gsub<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"_"</span><span style="color: #ebedf0; font-style: italic;">,</span>" "<span style="color: #ebedf0; font-style: italic;">,</span> gsea.H<span style="color: #68affc; font-style: italic;">$</span>pathway<span style="color: #68affc; font-style: italic;">)</span>
  # Calculating the Significance based on FDR and NES
  gsea.H <span style="color: #68affc; font-style: italic;"><-</span> gsea.H <span style="color: #68affc; font-style: italic;">%>%</span>
    mutate<span style="color: #68affc; font-style: italic;">(</span>Significance <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificance"</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    mutate<span style="color: #68affc; font-style: italic;">(</span>Significance <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>padj <<span style="color: #68affc; font-style: italic;">=</span> FDR <span style="color: #68affc; font-style: italic;">&</span> NES > 0<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Upregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> Significance<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> <span style="color: #68affc; font-style: italic;">%>%</span>
    mutate<span style="color: #68affc; font-style: italic;">(</span>Significance <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #f79502; font-style: italic;">ifelse</span><span style="color: #68affc; font-style: italic;">(</span>padj <<span style="color: #68affc; font-style: italic;">=</span> FDR <span style="color: #68affc; font-style: italic;">&</span> NES < 0<span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"Downregulated"</span><span style="color: #ebedf0; font-style: italic;">,</span> Significance<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
  gsea.H <span style="color: #68affc; font-style: italic;"><-</span> gsea.H<span style="color: #68affc; font-style: italic;">[</span>which<span style="color: #68affc; font-style: italic;">(</span>gsea.H<span style="color: #68affc; font-style: italic;">$</span>Significance <span style="color: #68affc; font-style: italic;">!</span><span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"NotSignificance"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #68affc; font-style: italic;">]</span>
  # Plotting the result
  gsea.H <span style="color: #68affc; font-style: italic;">%>%</span> 
    ggplot<span style="color: #68affc; font-style: italic;">(</span>aes<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">=</span>reorder<span style="color: #68affc; font-style: italic;">(</span>pathway<span style="color: #ebedf0; font-style: italic;">,</span> NES<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               y<span style="color: #68affc; font-style: italic;">=</span>NES<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    geom_col<span style="color: #68affc; font-style: italic;">(</span>width <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #ebedf0; font-style: italic;">,</span> aes<span style="color: #68affc; font-style: italic;">(</span>color<span style="color: #68affc; font-style: italic;">=</span> Significance<span style="color: #ebedf0; font-style: italic;">,</span> fill <span style="color: #68affc; font-style: italic;">=</span> Significance<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    labs<span style="color: #68affc; font-style: italic;">(</span>x<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Gene set'</span><span style="color: #ebedf0; font-style: italic;">,</span> y<span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">'Gene set'</span><span style="color: #68affc; font-style: italic;">)</span> +
    theme_classic<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
    scale_color_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>"blue"<span style="color: #ebedf0; font-style: italic;">,</span> "red"<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    scale_fill_manual<span style="color: #68affc; font-style: italic;">(</span>values<span style="color: #68affc; font-style: italic;">=</span>c<span style="color: #68affc; font-style: italic;">(</span>"blue"<span style="color: #ebedf0; font-style: italic;">,</span> "red"<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    coord_flip<span style="color: #68affc; font-style: italic;">(</span><span style="color: #68affc; font-style: italic;">)</span> +
    theme<span style="color: #68affc; font-style: italic;">(</span>axis.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24 <span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.text.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.text.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 9<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          plot.subtitle <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span>size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> colour <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"black"</span><span style="color: #ebedf0; font-style: italic;">,</span> hjust <span style="color: #68affc; font-style: italic;">=</span> 0.5<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.title.y <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 90<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          axis.title.x <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #ebedf0; font-style: italic;">,</span> size <span style="color: #68affc; font-style: italic;">=</span> 24<span style="color: #ebedf0; font-style: italic;">,</span> angle <span style="color: #68affc; font-style: italic;">=</span> 00<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
          legend.text <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span> family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
          legend.title <span style="color: #68affc; font-style: italic;">=</span> element_text<span style="color: #68affc; font-style: italic;">(</span>size <span style="color: #68affc; font-style: italic;">=</span> 20<span style="color: #ebedf0; font-style: italic;">,</span> family <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"Arial"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span> +
    labs<span style="color: #68affc; font-style: italic;">(</span>subtitle <span style="color: #68affc; font-style: italic;">=</span> paste0<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSEA - "</span><span style="color: #ebedf0; font-style: italic;">,</span> projname<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #68affc; font-style: italic;">}</span>

####################################### Running all functions ###############################################

# Downloading GEO 
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
<span style="color: #ebedf0; font-style: italic;">DownloadGEO</span><span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
# Reading GEO matrix into R environment
GSE11121 <span style="color: #68affc; font-style: italic;"><-</span> ReadGEO<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
GSE25055 <span style="color: #68affc; font-style: italic;"><-</span> ReadGEO<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
GSE25065 <span style="color: #68affc; font-style: italic;"><-</span> ReadGEO<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
GSE7390 <span style="color: #68affc; font-style: italic;"><-</span> ReadGEO<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
# Preparing phenotype for all 4 GEO 
MakePhenotype<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
              compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Box plot for each matrix
MakeBoxPlot<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
MakeBoxPlot<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
MakeBoxPlot<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
MakeBoxPlot<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE7390<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA plot for each matrix
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE7390<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Normalization for each matrix
normalized_GSE11121 <span style="color: #68affc; font-style: italic;"><-</span> VSNQuantilNorm<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE11121<span style="color: #68affc; font-style: italic;">)</span>
normalized_GSE25055 <span style="color: #68affc; font-style: italic;"><-</span> VSNQuantilNorm<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE25055<span style="color: #68affc; font-style: italic;">)</span>
normalized_GSE25065 <span style="color: #68affc; font-style: italic;"><-</span> VSNQuantilNorm<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE25065<span style="color: #68affc; font-style: italic;">)</span>
normalized_GSE7390 <span style="color: #68affc; font-style: italic;"><-</span> VSNQuantilNorm<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> GSE7390<span style="color: #68affc; font-style: italic;">)</span>

# Box and PCA after normalization for some matrix
MakeBoxPlot<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #68affc; font-style: italic;">)</span>
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

MakeBoxPlot<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #68affc; font-style: italic;">)</span>
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

MakeBoxPlot<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #68affc; font-style: italic;">)</span>
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

MakeBoxPlot<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE7390<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span>
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE7390<span style="color: #ebedf0; font-style: italic;">,</span> projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Merging studies without batch correction <span style="color: #68affc; font-style: italic;">(</span>just for comparison<span style="color: #68affc; font-style: italic;">)</span>
merge_studies <span style="color: #68affc; font-style: italic;"><-</span> MergeStudies<span style="color: #68affc; font-style: italic;">(</span>list<span style="color: #68affc; font-style: italic;">(</span>normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA before batch effect 
# Important note : studies should match projname 
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> merge_studies<span style="color: #ebedf0; font-style: italic;">,</span> 
        studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        projname <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>

# Batch effect correction
corbatch <span style="color: #68affc; font-style: italic;"><-</span> StudyBatchEffect<span style="color: #68affc; font-style: italic;">(</span>studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# PCA after batch effect 
# Important note : studies should match projname 
MakePCA<span style="color: #68affc; font-style: italic;">(</span>GEOmatrix <span style="color: #68affc; font-style: italic;">=</span> corbatch<span style="color: #ebedf0; font-style: italic;">,</span> 
        studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
        projname <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>




# Density plot before batch effect correction
MakeDensityPlot<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> merge_studies<span style="color: #ebedf0; font-style: italic;">,</span> 
                studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>GSE25055 <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> 
                               GSE11121 <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> 
                               GSE25065 <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span>
                                GSE7390 <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>


# Density plot after batch effect correction
MakeDensityPlot<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> corbatch<span style="color: #ebedf0; font-style: italic;">,</span> 
                studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>GSE25055 <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> 
                               GSE11121 <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> 
                               GSE25065 <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span>
                                GSE7390 <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

# MDS plot before batch effect correction
# Important note : studies should match projname 
MakeMDSPlot<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> merge_studies<span style="color: #ebedf0; font-style: italic;">,</span> 
            studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            projname <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            nstudies <span style="color: #68affc; font-style: italic;">=</span> 4<span style="color: #68affc; font-style: italic;">)</span>


# MDS plot after batch effect correction
# Important note : studies should match projname 
MakeMDSPlot<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> corbatch<span style="color: #ebedf0; font-style: italic;">,</span> 
            studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            projname <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            nstudies <span style="color: #68affc; font-style: italic;">=</span> 4<span style="color: #68affc; font-style: italic;">)</span>

# Cohran Q test 
cohranqtest <span style="color: #68affc; font-style: italic;"><-</span> CochranQTest<span style="color: #68affc; font-style: italic;">(</span>studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            groups <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
                            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #68affc; font-style: italic;">)</span>
# QQ plot of Cohran Q test 
MakeQQPlot<span style="color: #68affc; font-style: italic;">(</span>cohranq <span style="color: #68affc; font-style: italic;">=</span> cohranqtest<span style="color: #ebedf0; font-style: italic;">,</span> nstudies <span style="color: #68affc; font-style: italic;">=</span> 4<span style="color: #68affc; font-style: italic;">)</span>

FEMREMAnalysis<span style="color: #68affc; font-style: italic;">(</span>studies <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span> normalized_GSE7390<span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               projname <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span>
               model <span style="color: #68affc; font-style: italic;">=</span> "REM"<span style="color: #ebedf0; font-style: italic;">,</span>
               groups <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
               FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
               nperm <span style="color: #68affc; font-style: italic;">=</span> 50<span style="color: #68affc; font-style: italic;">)</span>


volcano_GSE11121 <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                                pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                                nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                                ntop <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                                voltype <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

volcano_GSE7390 <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                               padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                               pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                               nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                               ntop <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                               voltype <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

volcano_GSE25065 <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                                pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                                nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                                ntop <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                                voltype <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

volcano_GSE25055 <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                                pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                                nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                                ntop <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                                voltype <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>
# Combination
volcano_combination <span style="color: #68affc; font-style: italic;"><-</span> Makevolcano<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
                                padjlevel <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #ebedf0; font-style: italic;">,</span>
                                pSE_thresh <span style="color: #68affc; font-style: italic;">=</span> 1<span style="color: #ebedf0; font-style: italic;">,</span>
                                nSE_thresh <span style="color: #68affc; font-style: italic;">=</span> -1<span style="color: #ebedf0; font-style: italic;">,</span>
                                ntop <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #ebedf0; font-style: italic;">,</span>
                                voltype <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"ggplot"</span><span style="color: #68affc; font-style: italic;">)</span>

MakeVenna<span style="color: #68affc; font-style: italic;">(</span>common <span style="color: #68affc; font-style: italic;">=</span> c<span style="color: #68affc; font-style: italic;">(</span><span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span><span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span> ntop <span style="color: #68affc; font-style: italic;">=</span> 10<span style="color: #68affc; font-style: italic;">)</span>

MakeHeatmap<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25055<span style="color: #ebedf0; font-style: italic;">,</span>
            projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            ntop <span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            sorted <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>

MakeHeatmap<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE11121<span style="color: #ebedf0; font-style: italic;">,</span>
            projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            ntop <span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            sorted <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>

MakeHeatmap<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE25065<span style="color: #ebedf0; font-style: italic;">,</span>
            projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            ntop <span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            sorted <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>

MakeHeatmap<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> normalized_GSE7390<span style="color: #ebedf0; font-style: italic;">,</span>
            projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            ntop <span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            sorted <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>

# Combination 
MakeHeatmap<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> merge_studies<span style="color: #ebedf0; font-style: italic;">,</span>
            projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            ntop <span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            sorted <span style="color: #68affc; font-style: italic;">=</span> FALSE<span style="color: #68affc; font-style: italic;">)</span>
# Sorted grade
MakeHeatmap<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> merge_studies<span style="color: #ebedf0; font-style: italic;">,</span>
            projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span>
            compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
            groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #ebedf0; font-style: italic;">,</span>
            ntop <span style="color: #68affc; font-style: italic;">=</span> 25<span style="color: #ebedf0; font-style: italic;">,</span>
            sorted <span style="color: #68affc; font-style: italic;">=</span> TRUE<span style="color: #68affc; font-style: italic;">)</span>

GSEAAnalysis<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>
GSEAAnalysis<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>
GSEAAnalysis<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>
GSEAAnalysis<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>

# Combination
GSEAAnalysis<span style="color: #68affc; font-style: italic;">(</span>projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"combination"</span><span style="color: #ebedf0; font-style: italic;">,</span> FDR <span style="color: #68affc; font-style: italic;">=</span> 0.05<span style="color: #68affc; font-style: italic;">)</span>

Makenetworkanalyst<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> GSE11121<span style="color: #ebedf0; font-style: italic;">,</span>
                   projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE11121"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

Makenetworkanalyst<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> GSE25055<span style="color: #ebedf0; font-style: italic;">,</span>
                   projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25055"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

Makenetworkanalyst<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> GSE25065<span style="color: #ebedf0; font-style: italic;">,</span>
                   projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE25065"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>

Makenetworkanalyst<span style="color: #68affc; font-style: italic;">(</span>matrix <span style="color: #68affc; font-style: italic;">=</span> GSE7390<span style="color: #ebedf0; font-style: italic;">,</span>
                   projname <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"GSE7390"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   compare <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"grade"</span><span style="color: #ebedf0; font-style: italic;">,</span> 
                   groups <span style="color: #68affc; font-style: italic;">=</span> list<span style="color: #68affc; font-style: italic;">(</span>grade1 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"1"</span><span style="color: #ebedf0; font-style: italic;">,</span> grade3 <span style="color: #68affc; font-style: italic;">=</span> <span style="color: #2ad43b; font-style: italic;">"3"</span><span style="color: #68affc; font-style: italic;">)</span><span style="color: #68affc; font-style: italic;">)</span>




	    </code></pre>
	</section>

	<footer class="footer">
	    <p>&copy; 2023 Mohammad Reza Mohajeri. All rights reserved.</p>
	</footer>
</body>
</html>
